<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS 基础 | FE Knowledge</title>
    <meta name="description" content="前端知识点梳理">
    
    
    <link rel="preload" href="/assets/css/0.styles.b194f207.css" as="style"><link rel="preload" href="/assets/js/app.94b2f3ef.js" as="script"><link rel="preload" href="/assets/js/2.d467c8ee.js" as="script"><link rel="preload" href="/assets/js/4.e7adceac.js" as="script"><link rel="prefetch" href="/assets/js/10.7358a0a7.js"><link rel="prefetch" href="/assets/js/11.b76e3d06.js"><link rel="prefetch" href="/assets/js/12.a146812a.js"><link rel="prefetch" href="/assets/js/13.cf5c1852.js"><link rel="prefetch" href="/assets/js/14.c5690a9e.js"><link rel="prefetch" href="/assets/js/15.cfd708ec.js"><link rel="prefetch" href="/assets/js/16.667fb96d.js"><link rel="prefetch" href="/assets/js/17.09141bb2.js"><link rel="prefetch" href="/assets/js/18.65cc8cb4.js"><link rel="prefetch" href="/assets/js/19.742f92d8.js"><link rel="prefetch" href="/assets/js/20.93f5ef9b.js"><link rel="prefetch" href="/assets/js/21.bf458488.js"><link rel="prefetch" href="/assets/js/3.64e9b869.js"><link rel="prefetch" href="/assets/js/5.d198a837.js"><link rel="prefetch" href="/assets/js/6.eee8a3aa.js"><link rel="prefetch" href="/assets/js/7.4250d63b.js"><link rel="prefetch" href="/assets/js/8.c395ce89.js"><link rel="prefetch" href="/assets/js/9.10bd2809.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b194f207.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">FE Knowledge</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/lewisYe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/lewisYe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/introduction.html" class="sidebar-link">介绍</a></li><li><a href="/html.html" class="sidebar-link">HTML</a></li><li><a href="/css.html" class="sidebar-link">CSS</a></li><li><a href="/js_base.html" class="active sidebar-link">JS 基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#基本数据类型" class="sidebar-link">基本数据类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#类型数量" class="sidebar-link">类型数量</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#数据类型判断" class="sidebar-link">数据类型判断</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#typeof" class="sidebar-link">typeof</a></li><li class="sidebar-sub-header"><a href="/js_base.html#instanceof" class="sidebar-link">instanceof</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-prototype-tostring-call" class="sidebar-link">Object.prototype.toString.call()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#constructor-属性" class="sidebar-link">constructor 属性</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#类型转换" class="sidebar-link">类型转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#原始值转布尔" class="sidebar-link">原始值转布尔</a></li><li class="sidebar-sub-header"><a href="/js_base.html#原始值转数字" class="sidebar-link">原始值转数字</a></li><li class="sidebar-sub-header"><a href="/js_base.html#原始值转字符" class="sidebar-link">原始值转字符</a></li><li class="sidebar-sub-header"><a href="/js_base.html#原始值转对象" class="sidebar-link">原始值转对象</a></li><li class="sidebar-sub-header"><a href="/js_base.html#对象转布尔值" class="sidebar-link">对象转布尔值</a></li><li class="sidebar-sub-header"><a href="/js_base.html#对象转字符串和数字" class="sidebar-link">对象转字符串和数字</a></li><li class="sidebar-sub-header"><a href="/js_base.html#toprimitive" class="sidebar-link">ToPrimitive</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#操作符" class="sidebar-link">操作符</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#一元操作符" class="sidebar-link">一元操作符</a></li><li class="sidebar-sub-header"><a href="/js_base.html#位操作符" class="sidebar-link">位操作符</a></li><li class="sidebar-sub-header"><a href="/js_base.html#布尔操作符" class="sidebar-link">布尔操作符</a></li><li class="sidebar-sub-header"><a href="/js_base.html#加性操作符" class="sidebar-link">加性操作符</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#类型转换之隐式转换" class="sidebar-link">类型转换之隐式转换</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#定义" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/js_base.html#触发条件" class="sidebar-link">触发条件</a></li><li class="sidebar-sub-header"><a href="/js_base.html#问题解析" class="sidebar-link">问题解析</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#基本类型和引用类型" class="sidebar-link">基本类型和引用类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#动态属性" class="sidebar-link">动态属性</a></li><li class="sidebar-sub-header"><a href="/js_base.html#复制变量值" class="sidebar-link">复制变量值</a></li><li class="sidebar-sub-header"><a href="/js_base.html#传递参数" class="sidebar-link">传递参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#js执行机制" class="sidebar-link">JS执行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#变量提升（hoisting）" class="sidebar-link">变量提升（Hoisting）</a></li><li class="sidebar-sub-header"><a href="/js_base.html#调用栈" class="sidebar-link">调用栈</a></li><li class="sidebar-sub-header"><a href="/js_base.html#作用域" class="sidebar-link">作用域</a></li><li class="sidebar-sub-header"><a href="/js_base.html#作用域链" class="sidebar-link">作用域链</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#this" class="sidebar-link">This</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#默认绑定" class="sidebar-link">默认绑定</a></li><li class="sidebar-sub-header"><a href="/js_base.html#隐式绑定" class="sidebar-link">隐式绑定</a></li><li class="sidebar-sub-header"><a href="/js_base.html#显示绑定" class="sidebar-link">显示绑定</a></li><li class="sidebar-sub-header"><a href="/js_base.html#new-绑定" class="sidebar-link">new 绑定</a></li><li class="sidebar-sub-header"><a href="/js_base.html#绑定优先级" class="sidebar-link">绑定优先级</a></li><li class="sidebar-sub-header"><a href="/js_base.html#绑定例外" class="sidebar-link">绑定例外</a></li><li class="sidebar-sub-header"><a href="/js_base.html#箭头函数" class="sidebar-link">箭头函数</a></li><li class="sidebar-sub-header"><a href="/js_base.html#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#原型和原型链" class="sidebar-link">原型和原型链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#构造函数、实例原型、实例之间的关系" class="sidebar-link">构造函数、实例原型、实例之间的关系</a></li><li class="sidebar-sub-header"><a href="/js_base.html#原型的原型" class="sidebar-link">原型的原型</a></li><li class="sidebar-sub-header"><a href="/js_base.html#原型链" class="sidebar-link">原型链</a></li><li class="sidebar-sub-header"><a href="/js_base.html#函数的原型" class="sidebar-link">函数的原型</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#继承" class="sidebar-link">继承</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#原型链继承" class="sidebar-link">原型链继承</a></li><li class="sidebar-sub-header"><a href="/js_base.html#借用构造函数继承" class="sidebar-link">借用构造函数继承</a></li><li class="sidebar-sub-header"><a href="/js_base.html#组合继承" class="sidebar-link">组合继承</a></li><li class="sidebar-sub-header"><a href="/js_base.html#原型式继承" class="sidebar-link">原型式继承</a></li><li class="sidebar-sub-header"><a href="/js_base.html#寄生式继承" class="sidebar-link">寄生式继承</a></li><li class="sidebar-sub-header"><a href="/js_base.html#寄生组合式继承" class="sidebar-link">寄生组合式继承</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#闭包" class="sidebar-link">闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#定义-2" class="sidebar-link">定义</a></li><li class="sidebar-sub-header"><a href="/js_base.html#案例说明" class="sidebar-link">案例说明</a></li><li class="sidebar-sub-header"><a href="/js_base.html#经典面试题" class="sidebar-link">经典面试题</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#浮点数精度" class="sidebar-link">浮点数精度</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#ieee-754标准" class="sidebar-link">IEEE 754标准</a></li><li class="sidebar-sub-header"><a href="/js_base.html#浮点数转二进制" class="sidebar-link">浮点数转二进制</a></li><li class="sidebar-sub-header"><a href="/js_base.html#浮点数的计算" class="sidebar-link">浮点数的计算</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#类数组对象与arguments" class="sidebar-link">类数组对象与arguments</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#类数组对象" class="sidebar-link">类数组对象</a></li><li class="sidebar-sub-header"><a href="/js_base.html#arguments" class="sidebar-link">arguments</a></li><li class="sidebar-sub-header"><a href="/js_base.html#类数组检测" class="sidebar-link">类数组检测</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#js运行机制" class="sidebar-link">JS运行机制</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#js-单线程" class="sidebar-link">JS 单线程</a></li><li class="sidebar-sub-header"><a href="/js_base.html#任务队列" class="sidebar-link">任务队列</a></li><li class="sidebar-sub-header"><a href="/js_base.html#event-loop" class="sidebar-link">Event Loop</a></li><li class="sidebar-sub-header"><a href="/js_base.html#微任务和宏任务" class="sidebar-link">微任务和宏任务</a></li><li class="sidebar-sub-header"><a href="/js_base.html#node-js的event-loop" class="sidebar-link">Node.js的Event Loop</a></li><li class="sidebar-sub-header"><a href="/js_base.html#知识点实践运用解题" class="sidebar-link">知识点实践运用解题</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#object-常用方法" class="sidebar-link">Object 常用方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#object-assgin" class="sidebar-link">Object.assgin()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-create" class="sidebar-link">Object.create()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-defineproperty" class="sidebar-link">Object.defineProperty()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-defineproperties" class="sidebar-link">Object.defineProperties()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-getownpropertydesriptor" class="sidebar-link">Object.getOwnPropertyDesriptor()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-getownpropertydesriptors" class="sidebar-link">Object.getOwnPropertyDesriptors()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-getownpropertynames" class="sidebar-link">Object.getOwnPropertyNames()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-getpropertyof" class="sidebar-link">Object.getPropertyOf()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-prototype-hasownproperty" class="sidebar-link">Object.prototype.hasOwnProperty()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-setprototypeof" class="sidebar-link">Object.setPrototypeOf()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#object-prototype-isprototypeof" class="sidebar-link">Object.prototype.isPrototypeOf()</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#array的常用方法" class="sidebar-link">Array的常用方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#array-from" class="sidebar-link">Array.from()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-entries" class="sidebar-link">Array.prototype.entries()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-filter" class="sidebar-link">Array.prototype.filter()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-reduce" class="sidebar-link">Array.prototype.reduce()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-flat" class="sidebar-link">Array.prototype.flat()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-sort" class="sidebar-link">Array.prototype.sort()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-splice" class="sidebar-link">Array.prototype.splice()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-slice" class="sidebar-link">Array.prototype.slice()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#array-prototype-includes" class="sidebar-link">Array.prototype.includes()</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#string的常用方法" class="sidebar-link">String的常用方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#string-prototype-match" class="sidebar-link">String.prototype.match()</a></li><li class="sidebar-sub-header"><a href="/js_base.html#string-prototype-replace" class="sidebar-link">String.prototype.replace()</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#dom事件" class="sidebar-link">DOM事件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#事件级别" class="sidebar-link">事件级别</a></li><li class="sidebar-sub-header"><a href="/js_base.html#事件流" class="sidebar-link">事件流</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#js-异常类型" class="sidebar-link">JS 异常类型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#error-基本错误类型" class="sidebar-link">Error 基本错误类型</a></li><li class="sidebar-sub-header"><a href="/js_base.html#syntaxerror-语法错误" class="sidebar-link">SyntaxError 语法错误</a></li><li class="sidebar-sub-header"><a href="/js_base.html#typeerror-类型错误" class="sidebar-link">TypeError 类型错误</a></li><li class="sidebar-sub-header"><a href="/js_base.html#referenceerror-引用错误" class="sidebar-link">ReferenceError 引用错误</a></li><li class="sidebar-sub-header"><a href="/js_base.html#rangeerror-边界错误" class="sidebar-link">RangeError 边界错误</a></li><li class="sidebar-sub-header"><a href="/js_base.html#urierror-url错误" class="sidebar-link">URIError URL错误</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#js-异常处理" class="sidebar-link">JS 异常处理</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#try-catch" class="sidebar-link">try catch</a></li><li class="sidebar-sub-header"><a href="/js_base.html#window-onerror" class="sidebar-link">window.onerror</a></li><li class="sidebar-sub-header"><a href="/js_base.html#window-addeventlistener" class="sidebar-link">window.addEventListener</a></li><li class="sidebar-sub-header"><a href="/js_base.html#promise-catch" class="sidebar-link">Promise Catch</a></li><li class="sidebar-sub-header"><a href="/js_base.html#react-异常捕获" class="sidebar-link">React 异常捕获</a></li><li class="sidebar-sub-header"><a href="/js_base.html#页面崩溃与卡顿" class="sidebar-link">页面崩溃与卡顿</a></li><li class="sidebar-sub-header"><a href="/js_base.html#script-error" class="sidebar-link">Script error</a></li><li class="sidebar-sub-header"><a href="/js_base.html#错误上报" class="sidebar-link">错误上报</a></li><li class="sidebar-sub-header"><a href="/js_base.html#总结-2" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#正则" class="sidebar-link">正则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/js_base.html#常用正则符号" class="sidebar-link">常用正则符号</a></li></ul></li><li class="sidebar-sub-header"><a href="/js_base.html#ajax" class="sidebar-link">Ajax</a></li><li class="sidebar-sub-header"><a href="/js_base.html#创建对象的方式有哪些" class="sidebar-link">创建对象的方式有哪些</a></li><li class="sidebar-sub-header"><a href="/js_base.html#操作符优先级" class="sidebar-link">操作符优先级</a></li></ul></li><li><a href="/js_advanced.html" class="sidebar-link">手写JS</a></li><li><a href="/es6.html" class="sidebar-link">ES6</a></li><li><a href="/browser.html" class="sidebar-link">浏览器系列</a></li><li><a href="/network.html" class="sidebar-link">网络</a></li><li><a href="/react.html" class="sidebar-link">React</a></li><li><a href="/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/ts.html" class="sidebar-link">TypeScript</a></li><li><a href="/performance.html" class="sidebar-link">性能</a></li><li><a href="/algorithm.html" class="sidebar-link">数据结构与算法</a></li><li><a href="/design.html" class="sidebar-link">设计模式</a></li><li><a href="/other.html" class="sidebar-link">其它</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js-基础"><a href="#js-基础" aria-hidden="true" class="header-anchor">#</a> JS 基础</h1> <h2 id="基本数据类型"><a href="#基本数据类型" aria-hidden="true" class="header-anchor">#</a> 基本数据类型</h2> <h3 id="类型数量"><a href="#类型数量" aria-hidden="true" class="header-anchor">#</a> 类型数量</h3> <p>到目前为止 JS 具有8种数据类型。</p> <p>Number、String、Boolean、Null、Undefined、Object、Symbol、BigInt</p> <ol><li>Number</li></ol> <p>Number 类型包含整数和浮点数两种值。</p> <p>NaN 非数字类型</p> <ul><li>涉及到任何关于NaN的操作都会返回NaN</li> <li>NaN 不等于自身</li></ul> <ol start="2"><li>String</li></ol> <p>字符串是存储字符的变量，由双引号或者单引号表示，具有length属性。可使用String()或者toString()方法转换为String类型</p> <ol start="3"><li>Boolean</li></ol> <p>具有 true 和 false 2个值 true 为 1 ; false 为 0</p> <ol start="4"><li>Undefined</li></ol> <p>undefined表示系统级的、出乎意料的或类似错误的值的空缺；表示缺少值，此处应该有值，但没有定义</p> <ol start="5"><li>Null</li></ol> <p>null表示程序级的、正常的或在意料之中的值的空缺</p> <ol start="6"><li>Object</li></ol> <p>ECMAjavascript中的对象其实就是一组数据和功能的集合。对象可以通过执行new操作符后跟要创建的对象类型的名称来创建。创建object类型的实例并为其添加属性（或）方法，就可以自定义创建对象。</p> <p>如：var o = new Object( );</p> <p>object 的每个实例都有下列属性和方法：</p> <p>constructor：保存着用于创建当前对象的函数。（构造函数)constructor就是object();</p> <p>hasOwnProperty(propertyName): 用于检查给定的当前属性在当前对象实例中）而不是在实例原型中）是否存在。</p> <p>isPrototypeOf(object): 用于检查传入的对象是否是传入对象原型。</p> <p>propertyIsEnumerable(propertyName): 用于检查给定属性是否能够用for-in语句。</p> <p>toLocaleString( ): 返回对象的字符串表示，该字符串与执行环境的地区对应。</p> <p>toString( ): 返回对象的字符串表示。</p> <p>valueOf( ): 返回对象的字符串、数值或者布尔值表示。通常与toString( )方法的返回值得相同。</p> <p>ECMAJS中object是所有对象的基础，因些所有对象都具有这些基本的属性和方法。</p> <ol start="7"><li>Symbol</li></ol> <p>Symbol 类型的对象永远不相等，即便创建的时候传入相同的值。因此，可以用解决属性名冲突的问题（适用于多少编码），做为标记。ES6 新增的</p> <ol start="8"><li>BigInt</li></ol> <p>BigInt 提供了一种方法来表示大于  2^53 - 1 的整数。这原本是 Javascript中可以用 Number 表示的最大数字。BigInt 可以表示任意大的整数。</p> <p>可以用在一个整数字面量后面加 n 的方式定义一个 BigInt ，如：10n，或者调用函数BigInt()。</p> <h2 id="数据类型判断"><a href="#数据类型判断" aria-hidden="true" class="header-anchor">#</a> 数据类型判断</h2> <p>JS 数据类型的判断主要有以下几种方法：typeof、instanceof 、Objeact.prototype.toString.call()、constructor</p> <h3 id="typeof"><a href="#typeof" aria-hidden="true" class="header-anchor">#</a> typeof</h3> <p>返回一个表示数据类型的字符串，返回结果包含：number、boolean、string、symbol、object、undefined、function、bigint等</p> <p><font color="red">缺点不能判断null和array</font></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">typeof</span> <span class="token string">''</span> <span class="token comment">// string    有效</span>
<span class="token keyword">typeof</span> <span class="token number">1</span> <span class="token comment">// number    有效</span>
<span class="token keyword">typeof</span> <span class="token number">NaN</span> <span class="token comment">// number    有效</span>
<span class="token keyword">typeof</span> <span class="token boolean">true</span> <span class="token comment">// boolean   有效</span>
<span class="token keyword">typeof</span> <span class="token keyword">undefined</span> <span class="token comment">// undefined 有效</span>
<span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// function  有效</span>
<span class="token keyword">typeof</span> <span class="token number">11n</span> <span class="token comment">// bigint    有效</span>
<span class="token keyword">typeof</span> <span class="token keyword">null</span> <span class="token comment">// object    无效</span>
<span class="token keyword">typeof</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// object    无效</span>
<span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// object    无效</span>
<span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// object    无效</span>
</code></pre></div><h3 id="instanceof"><a href="#instanceof" aria-hidden="true" class="header-anchor">#</a> instanceof</h3> <p>instanceof 是用来判断 A 是否为 B 的实例，表达式为 A instanceof B；如果 A 是 B 的实例，则返回 true，否则返回 false。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span> <span class="token comment">// true</span>
<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// true</span>
<span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">instanceof</span> <span class="token class-name">Date</span> <span class="token comment">// true</span>

<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// true</span>
<span class="token keyword">null</span> <span class="token keyword">instanceof</span> <span class="token class-name">Null</span> <span class="token comment">// 报错</span>
<span class="token keyword">null</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token comment">// false </span>

<span class="token number">2</span> <span class="token keyword">instanceof</span> <span class="token class-name">Number</span> <span class="token comment">//false</span>
<span class="token string">'str'</span> <span class="token keyword">instanceof</span> <span class="token class-name">String</span> <span class="token comment">// false</span>
<span class="token boolean">true</span> <span class="token keyword">instanceof</span> <span class="token class-name">Boolean</span> <span class="token comment">// false</span>
</code></pre></div><p><font color="red">instanceof可以精准判断引用数据类型（Array，Function，Object），而基本数据类型不能被instanceof精准判断。</font></p> <p>会发现 [] 既是 Array的实例，又是Object的实例。因为 instanceOf 检测的是原型。[] 的 <code>__proto__</code> 直接指向 Array.prototype, Array的 <code>__proto__</code> 指向 Object.prototype. 所以 [] 间接指向了 Object.prototype. 所以 instanceof 只能用来判断两个对象是否属于实例关系，而不能判断一个对象实例具体属于哪种类型。</p> <p>在MDN中的解释：instanceof 运算符用来测试一个对象在其原型链中是否存在一个构造函数的 prototype 属性。其意思就是判断对象是否是某一数据类型的实例，请重点关注一下是判断一个对象是否是数据类型的实例。在这里字面量值，2， true ，'str'不是实例，所以判断值为false。</p> <h4 id="instanceof-的实现原理"><a href="#instanceof-的实现原理" aria-hidden="true" class="header-anchor">#</a> instanceof 的实现原理</h4> <p>原理是在实例的 原型对象链 中找到该构造函数的prototype属性所指向的 原型对象，就返回true。</p> <h5 id="简易实现"><a href="#简易实现" aria-hidden="true" class="header-anchor">#</a> 简易实现</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">newInstanceof</span><span class="token punctuation">(</span><span class="token parameter">l<span class="token punctuation">,</span> r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> o <span class="token operator">=</span> r<span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
    l <span class="token operator">=</span> l<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">===</span> l<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
        l <span class="token operator">=</span> l<span class="token punctuation">.</span>__proto__
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="object-prototype-tostring-call"><a href="#object-prototype-tostring-call" aria-hidden="true" class="header-anchor">#</a> Object.prototype.toString.call()</h3> <p>这是最准确的类型判断方法</p> <p>toString() 是 Object 的原型方法，调用该方法，默认返回当前对象的 [[Class]] 。这是一个内部属性，其格式为 [object Xxx] ，其中 Xxx 就是对象的类型。</p> <p>对于 Object 对象，直接调用 toString() 就能返回 [object Object] 。而对于其他对象，则需要通过 call / apply 来调用才能返回正确的类型信息。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object String]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Number]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Boolean]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Symbol]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Undefined]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Null]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Function]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Date]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Array]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object RegExp]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Error]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object HTMLDocument]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object global] window 是全局对象 global 的引用</span>
</code></pre></div><h3 id="constructor-属性"><a href="#constructor-属性" aria-hidden="true" class="header-anchor">#</a> constructor 属性</h3> <p>constructor 属性返回所有 JavaScript 变量的构造函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token string">&quot;John&quot;</span><span class="token punctuation">.</span>constructor <span class="token comment">// 返回函数 String()  { [native code] }</span>
<span class="token punctuation">(</span><span class="token number">3.14</span><span class="token punctuation">)</span><span class="token punctuation">.</span>constructor <span class="token comment">// 返回函数 Number()  { [native code] }</span>
<span class="token boolean">false</span><span class="token punctuation">.</span>constructor <span class="token comment">// 返回函数 Boolean() { [native code] }</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>constructor <span class="token comment">// 返回函数 Array()   { [native code] }</span>
<span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">34</span>
<span class="token punctuation">}</span><span class="token punctuation">.</span>constructor <span class="token comment">// 返回函数 Object()  { [native code] }</span>
<span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>constructor <span class="token comment">// 返回函数 Date()    { [native code] }</span>
<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span>constructor <span class="token comment">// 返回函数 Function(){ [native code] }</span>
</code></pre></div><p>例子： [].constructor.toString().indexOf(&quot;Array&quot;) &gt; -1</p> <h2 id="类型转换"><a href="#类型转换" aria-hidden="true" class="header-anchor">#</a> 类型转换</h2> <h3 id="原始值转布尔"><a href="#原始值转布尔" aria-hidden="true" class="header-anchor">#</a> 原始值转布尔</h3> <p>可以使用 Boolean 函数将类型转换成布尔类型，在js中，只有6种值可以被转换为false，其他都为true</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
</code></pre></div><p>注意 当 Boolean 函数不传入参数时，会返回false</p> <h3 id="原始值转数字"><a href="#原始值转数字" aria-hidden="true" class="header-anchor">#</a> 原始值转数字</h3> <p>可以使用Number 函数将类型转换成数字类型，如果参数无法被转换为数字，则返回NaN.</p> <p>在<a href="http://es5.github.io/#x15.7.1.1" target="_blank" rel="noopener noreferrer">ES5规范15.7.11<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>关于Number 函数的介绍</p> <blockquote><p>15.7.1.1 Number ( [ value ] ) # Ⓣ</p></blockquote> <blockquote><p>Returns a Number value (not a Number object) computed by ToNumber(value) if value was supplied, else returns +0.</p></blockquote> <p>翻译理解一下就是</p> <p>如果Number 函数有参数 则使用 ToNumber(value) 计算，没有参数则返回+0</p> <p>那 ToNumber 又是什么呢 ，在<a href="http://es5.github.io/#x9.3" target="_blank" rel="noopener noreferrer">ES5规范9.3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>有说明。</p> <p>给出了一个对应的结果表</p> <table><thead><tr><th style="text-align:center;">参数类型</th> <th style="text-align:center;">结果</th></tr></thead> <tbody><tr><td style="text-align:center;">Undefiend</td> <td style="text-align:center;">NaN</td></tr> <tr><td style="text-align:center;">Null</td> <td style="text-align:center;">+0</td></tr> <tr><td style="text-align:center;">Boolean</td> <td style="text-align:center;">true 为1, false为+0</td></tr> <tr><td style="text-align:center;">Number</td> <td style="text-align:center;">返回与之相等的值</td></tr> <tr><td style="text-align:center;">String</td> <td style="text-align:center;">请参阅下面的示例。</td></tr> <tr><td style="text-align:center;">Object</td> <td style="text-align:center;">1. 先使用 ToPrimitive(input argument, hint Number) 得到 primValue.     2. 返回 ToNumber(primValue).</td></tr></tbody></table> <p>这又涉及了 ToPrimitive 方法 在后面做介绍。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// +0</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// NaN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// +0</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// +0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// +0</span>

<span class="token comment">// 字符串</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 123</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;-123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -123</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;-1.2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -1.2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;-0012&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// -12</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;123 123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// NaN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// NaN</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">&quot;12a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// NaN</span>
</code></pre></div><p>如果通过 Number 转换函数传入一个字符串，它会试图将其转换成一个整数或浮点数，而且会忽略所有前导的 0，如果有一个字符不是数字，结果都会返回 NaN，鉴于这种严格的判断，我们一般还会使用更加灵活的 parseInt 和 parseFloat 进行转换。</p> <h3 id="原始值转字符"><a href="#原始值转字符" aria-hidden="true" class="header-anchor">#</a> 原始值转字符</h3> <p>可以使用String 函数将类型转换成字符串类型。</p> <p>在<a href="http://es5.github.io/#x15.5.1.1" target="_blank" rel="noopener noreferrer">ES5规范15.7.11<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>关于String 函数的介绍</p> <blockquote><p>15.5.1.1 String ( [ value ] ) # Ⓣ</p></blockquote> <blockquote><p>Returns a String value (not a String object) computed by ToString(value). If value is not supplied, the empty String &quot;&quot; is returned.</p></blockquote> <p>如果 String 函数不传参数，返回空字符串，如果有参数，调用 ToString(value)，而 ToString 也给了一个对应的结果表</p> <table><thead><tr><th style="text-align:center;">参数类型</th> <th style="text-align:center;">结果</th></tr></thead> <tbody><tr><td style="text-align:center;">Undefiend</td> <td style="text-align:center;">&quot;undefined&quot;</td></tr> <tr><td style="text-align:center;">Null</td> <td style="text-align:center;">&quot;null&quot;</td></tr> <tr><td style="text-align:center;">Boolean</td> <td style="text-align:center;">true 为&quot;true&quot;, false为&quot;false&quot;</td></tr> <tr><td style="text-align:center;">Number</td> <td style="text-align:center;"><a href="http://es5.github.io/#x9.8.1" target="_blank" rel="noopener noreferrer">规范9.8.1节<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 下面用例子说明</td></tr> <tr><td style="text-align:center;">String</td> <td style="text-align:center;">返回与之相等的值</td></tr> <tr><td style="text-align:center;">Object</td> <td style="text-align:center;">1. 先使用 ToPrimitive(input argument, hint String) 得到 primValue 2. 返回 ToString(primValue).</td></tr></tbody></table> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;&quot;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;undefined&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;null&quot;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;false&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;true&quot;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;0&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;NaN&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;Infinity&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//&quot;1&quot;</span>
</code></pre></div><p>注意这里的 ToString 和上一节的 ToNumber 都是底层规范实现的方法，并没有直接暴露出来</p> <h3 id="原始值转对象"><a href="#原始值转对象" aria-hidden="true" class="header-anchor">#</a> 原始值转对象</h3> <p>原始值到对象的转换非常简单，原始值通过调用 String()、Number() 或者 Boolean() 构造函数，转换为它们各自的包装对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// number</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// object</span>
</code></pre></div><p>null 和 undefined 属于例外，当将它们用在期望是一个对象的地方都会造成一个类型错误 (TypeError) 异常，而不会执行正常的转换。</p> <h3 id="对象转布尔值"><a href="#对象转布尔值" aria-hidden="true" class="header-anchor">#</a> 对象转布尔值</h3> <p>对象到布尔值的转换非常简单：所有对象(包括数组和函数)都转换为 true。</p> <h3 id="对象转字符串和数字"><a href="#对象转字符串和数字" aria-hidden="true" class="header-anchor">#</a> 对象转字符串和数字</h3> <p>对象到字符串和对象到数字的转换都是通过调用待转换对象的一个方法来完成的。而 JavaScript 对象有两个不同的方法来执行转换，一个是 toString，一个是 valueOf。注意这个跟上面所说的 ToString 和 ToNumber 是不同的，这两个方法是真实暴露出来的方法。</p> <h4 id="tostring"><a href="#tostring" aria-hidden="true" class="header-anchor">#</a> toString</h4> <p>所有的对象除了 null 和 undefined 之外的任何值都具有 toString 方法，通常情况下，它和使用 String 方法返回的结果一致。</p> <p>在<a href="#object-prototype-tostring-call">数据类型判断</a>中有说到过toString的用法.</p> <p>对于 Object 对象，直接调用 toString() 就能返回 [object Object] 。而对于其他对象，则需要通过 call / apply 来调用才能返回正确的类型信息。如果直接调用会得到不同的结果 如下所示：</p> <ol><li>数组的 toString 方法将每个数组元素转换成一个字符串，并在元素之间添加逗号后合并成结果字符串。</li> <li>函数的 toString 方法返回源代码字符串。</li> <li>日期的 toString 方法返回一个可读的日期和时间字符串。</li> <li>RegExp 的 toString 方法返回一个表示正则表达式直接量的字符串。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [object Object]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// &quot;&quot;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 0</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 1,2,3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// function (){var a = 1;}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token regex">/\d+/g</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// /\d+/g</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Wed May 27 2020 15:03:50 GMT+0800 (中国标准时间)</span>
</code></pre></div><h4 id="valueof"><a href="#valueof" aria-hidden="true" class="header-anchor">#</a> valueOf</h4> <p>valueOf 表示对象的原始值。默认的 valueOf 方法返回这个对象本身，数组、函数、正则简单的继承了这个默认方法，也会返回对象本身。日期是一个例外，它会返回它的一个内容表示: 1970 年 1 月 1 日以来的毫秒数。</p> <h3 id="toprimitive"><a href="#toprimitive" aria-hidden="true" class="header-anchor">#</a> ToPrimitive</h3> <p>语法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">ToPrimitive</span><span class="token punctuation">(</span>input<span class="token punctuation">[</span><span class="token punctuation">,</span> PreferredType<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>参数：
第一个参数是input，表示要处理的输入值
第二个参数是PreferredType, 非必填，表示希望转换成的类型，有两个值可以选，Number或者String</p> <p>当不传入 PreferredType 时，如果 input 是日期类型，相当于传入 String，否则，都相当于传入 Number。</p> <p>如果传入的 input 是 Undefined、Null、Boolean、Number、String 类型，直接返回该值。</p> <p>如果是 ToPrimitive(obj, Number)，处理步骤如下：</p> <p>如果 obj 为 基本类型，直接返回
否则，调用 valueOf 方法，如果返回一个原始值，则 JavaScript 将其返回。
否则，调用 toString 方法，如果返回一个原始值，则 JavaScript 将其返回。
否则，JavaScript 抛出一个类型错误异常。</p> <p>如果是 ToPrimitive(obj, String)，处理步骤如下：</p> <p>如果 obj为 基本类型，直接返回
否则，调用 toString 方法，如果返回一个原始值，则 JavaScript 将其返回。
否则，调用 valueOf 方法，如果返回一个原始值，则 JavaScript 将其返回。
否则，JavaScript 抛出一个类型错误异常。</p> <p>看到这里上文的原始值转换中 对象转字符串、对象转数字的规则已经出来了。</p> <h2 id="操作符"><a href="#操作符" aria-hidden="true" class="header-anchor">#</a> 操作符</h2> <h3 id="一元操作符"><a href="#一元操作符" aria-hidden="true" class="header-anchor">#</a> 一元操作符</h3> <p>只能操作一个值的操作符叫做一元操作符</p> <h4 id="递增-和-递减-（-）操作符"><a href="#递增-和-递减-（-）操作符" aria-hidden="true" class="header-anchor">#</a> 递增 (++) 和 递减 （--）操作符</h4> <p>具有前置型和后置型</p> <p><strong>前置型</strong></p> <p><code>++num、--num</code></p> <p>执行前置递增和递减操作时，变量的值都是在语句被求值以前改变的</p> <p><strong>后置型</strong></p> <p><code>num++、num--</code></p> <p>执行后置递增和递减操作是在包含它们的语句被求 值之后才执行的</p> <p>区别示例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> num1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> num2 <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> _num1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> num3 <span class="token operator">=</span> <span class="token operator">--</span>num1 <span class="token operator">+</span> num2 <span class="token comment">// 21</span>
<span class="token keyword">var</span> num4 <span class="token operator">=</span> num1 <span class="token operator">+</span> num2 <span class="token comment">// 21</span>
<span class="token keyword">var</span> num5 <span class="token operator">=</span> _num1<span class="token operator">--</span> <span class="token operator">+</span> num2 <span class="token comment">// 22</span>
<span class="token keyword">var</span> num6 <span class="token operator">=</span> _num1 <span class="token operator">+</span> num2 <span class="token comment">// 21</span>
</code></pre></div><h4 id="一元加-和减（-）操作符"><a href="#一元加-和减（-）操作符" aria-hidden="true" class="header-anchor">#</a> 一元加(+)和减（-）操作符</h4> <p>一元加操作符以一个加号 <code>+</code> 表示，放在数值前面，对数值不会产生任何影响。但是对于非数值应用一元操作符，该操作符会像Number()转型函数一样，对这个值执行转换</p> <p>示例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> s1 <span class="token operator">=</span> <span class="token string">&quot;01&quot;</span>
<span class="token keyword">var</span> s2 <span class="token operator">=</span> <span class="token string">&quot;1.1&quot;</span>
<span class="token keyword">var</span> s3 <span class="token operator">=</span> <span class="token string">&quot;z&quot;</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">valueOf</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token operator">+</span>s1 <span class="token comment">// 1</span>
    <span class="token operator">+</span>s2 <span class="token comment">// 1.1</span>
    <span class="token operator">+</span>s3 <span class="token comment">// NaN</span>
    <span class="token operator">+</span>b <span class="token comment">// 0</span>
    <span class="token operator">+</span>f <span class="token comment">// 1.1</span>
    <span class="token operator">+</span>o <span class="token comment">// -1</span>
</code></pre></div><p>一元减操作符主要用于表示负数，当应用于数值时，数值变为负数；当应用于非数值时，与一元加具有相同的规则，最后将得到的数值变为负数。</p> <h3 id="位操作符"><a href="#位操作符" aria-hidden="true" class="header-anchor">#</a> 位操作符</h3> <p>位操作符用于在最基本的层次上，即按内存中表示数值的位来操作数值。ECMAScript 中的所有数值都以IEEE-754 64位格式存储，但是位操作符不直接操作64位的值，而是先将64位转换为32位，执行操作，然后在转换为64位</p> <p><strong>二进制码、反码、补码</strong></p> <p>二进制码 就是每一位表示2的幂。例如 18 二级制表示 10010</p> <p>负数用二进制补码表示。</p> <p>反码：将二进制每一位 0 替换为 1， 1 替换为 0</p> <p>补码：反码加1</p> <p><strong>位操作符包含</strong></p> <ol><li>按位非（~）返回数值的反码</li></ol> <p>将操作数所有位取反。根据js中带符号的整数的表示方法，对一个值使用~运算符相当于它的相反数减1</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> b<span class="token operator">=</span><span class="token operator">-</span><span class="token number">7</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">~</span>b<span class="token punctuation">)</span><span class="token comment">//输出6</span>
</code></pre></div><ol start="2"><li>按位与（&amp;）</li></ol> <p>两个操作数中相对应的位都是1时，这位为1，否则都为零</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token comment">//011</span>
<span class="token keyword">var</span> b<span class="token operator">=</span><span class="token number">7</span><span class="token comment">//111</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token comment">// 输出3 =&gt; 011</span>
</code></pre></div><ol start="3"><li>按位或 (|)</li></ol> <p>如果两个数对应为都不为0，这位才是1</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token comment">//011</span>
<span class="token keyword">var</span> b<span class="token operator">=</span><span class="token number">7</span><span class="token comment">//111</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">|</span>b<span class="token punctuation">)</span><span class="token comment">// 输出7 =&gt; 111</span>
</code></pre></div><ol start="4"><li>按位异或（^）
两个数对应位不同，这位才为1，否则为0</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">3</span><span class="token comment">//011</span>
<span class="token keyword">var</span> b<span class="token operator">=</span><span class="token number">7</span><span class="token comment">//111</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token operator">^</span>b<span class="token punctuation">)</span><span class="token comment">// 输出4 =&gt; 100</span>
</code></pre></div><ol start="5"><li>左移（&lt;&lt;）</li></ol> <p>将第一个操作数进行左移，移动的位数为第二个操作数(0~31之间的一个整数)，新的位由0补齐。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">3</span>
<span class="token keyword">var</span> b<span class="token operator">=</span><span class="token number">7</span><span class="token comment">//000111</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token operator">&lt;&lt;</span>a<span class="token punctuation">)</span><span class="token comment">//111000 =&gt; 输出56</span>
</code></pre></div><ol start="6"><li>有符号右移（&gt;&gt;）</li></ol> <p>将第一个操作数进行右移，移动的位数为第二个操作数(0~31之间的一个整数)，右边的溢出位被忽略，填补在左边的位由原操作数符号决定，以便保持结果的符号与原操作数一致。如果第一个操作数是正数，移位后用0填补最高位；如果为负，用1填补最高位。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">2</span>
<span class="token keyword">var</span> b<span class="token operator">=</span><span class="token operator">-</span><span class="token number">7</span><span class="token comment">//1 111111001  </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token operator">&gt;&gt;</span>a<span class="token punctuation">)</span><span class="token comment">//1 11111110 =&gt; -2  </span>
</code></pre></div><ol start="7"><li>无符号右移（&gt;&gt;&gt;）</li></ol> <p>同样右移，最高位补0，忽略符号位</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token operator">=</span><span class="token number">4</span>
<span class="token keyword">var</span> b<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token comment">// 1 11111111</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token operator">&gt;&gt;&gt;</span>a<span class="token punctuation">)</span><span class="token comment">//0 0000 1111 1111 1111 1111 1111 1111 1111 =&gt; 输出268435455</span>
</code></pre></div><h3 id="布尔操作符"><a href="#布尔操作符" aria-hidden="true" class="header-anchor">#</a> 布尔操作符</h3> <p>布尔操作符公有3个：非、与、或</p> <h4 id="逻辑非"><a href="#逻辑非" aria-hidden="true" class="header-anchor">#</a> 逻辑非</h4> <p>逻辑非操作符由一个 <code>!</code> 表示，可以应用于任何值，返回一个布尔值。先将操作数转换为布尔值，然后求反</p> <ul><li>操作数是对象，返回 false</li> <li>操作数是空字符串，返回ture</li> <li>操作数是非空字符串，返回false</li> <li>操作数是数值0，返回ture</li> <li>操作数是null，返回true</li> <li>操作数是NaN，返回true</li> <li>操作数是undefined，返回true</li></ul> <h4 id="逻辑与"><a href="#逻辑与" aria-hidden="true" class="header-anchor">#</a> 逻辑与</h4> <p>逻辑与操作符由 <code>&amp;&amp;</code> 表示，可以应用于任何类型的操作数，但是不一定返回布尔值。</p> <p>在一个操作数不是布尔的情况下，遵循如下规则：</p> <ul><li>如果第一个操作数是对象，则返回第二个操作数</li> <li>如果第二个操作数是对象，则在第一个操作数结果为true的情况下返回</li> <li>如果两个操作数都是对象，返回第二个</li> <li>如果有一个操作数为null，返回null</li> <li>如果有一个操作数为NaN，返回NaN</li> <li>如果有一个操作数为undefined，返回undefined</li></ul> <p>逻辑与操作属于短路操作，如果第一个操作数能够决定结果，则不会对第二个操作数<strong>求值</strong>。这一点很重要。示例说明</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token punctuation">(</span>a <span class="token operator">||</span> b<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 报错</span>

如果
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    则会输出<span class="token boolean">false</span>， 因为进行了求值操作
</code></pre></div><h4 id="逻辑或"><a href="#逻辑或" aria-hidden="true" class="header-anchor">#</a> 逻辑或</h4> <p>逻辑或操作符由 <code>||</code> 表示，与逻辑与相似，也不一定返回布尔值。遵循如下规则：</p> <ul><li>如果第一个操作数是对象，则返回第一个操作数</li> <li>如果第一个个操作数的求值结果为false，返回第二个</li> <li>如果两个操作数都是对象，返回第一个个</li> <li>如果有一个操作数为null，返回null</li> <li>如果有一个操作数为NaN，返回NaN</li> <li>如果有一个操作数为undefined，返回undefined</li></ul> <p>逻辑或操作也属于短路操作，如果第一个操作数能够决定结果，则不会对第二个操作数<strong>求值</strong>。</p> <h3 id="加性操作符"><a href="#加性操作符" aria-hidden="true" class="header-anchor">#</a> 加性操作符</h3> <p>具有加法（+） 和 减法（-）2个操作符</p> <h4 id="加法（-）"><a href="#加法（-）" aria-hidden="true" class="header-anchor">#</a> 加法（+）</h4> <p>遵循如下规则：</p> <ul><li>两个都是数值，常规计算</li> <li>有一个为NaN, 然后NaN</li> <li>两个都是字符串时，则进行拼接</li> <li>其中一个为字符串，则将另一个转换为字符串，进行拼接</li> <li>有一个为对象、数组、布尔值，则调用它们的toSting()方法取相应字符串值，然后应用上述关于字符串的规则。</li> <li>对应null和undefined，则调用String()取得&quot;undefined&quot;和&quot;null&quot;</li></ul> <p>只要 <code>+</code> 号两边有一边是字符串 作为字符串连接理解，反之作为算术运算符理解。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 1true</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// NaN</span>
<span class="token number">4.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>

问题对应转换理解

<span class="token number">1.</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'true'</span> <span class="token operator">=</span> <span class="token string">'1true'</span>
<span class="token number">2.</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token number">3.</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">NaN</span> <span class="token operator">=</span> <span class="token number">NaN</span>
<span class="token number">4.</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">1</span>

</code></pre></div><h4 id="关系运算符"><a href="#关系运算符" aria-hidden="true" class="header-anchor">#</a> 关系运算符</h4> <p>小于（&lt;）、大于（&gt;）、小于等于（&gt;=）、大于等于（&gt;=）等关系操作符对两个值进行比较，返回一个布尔值。</p> <p>当关系操作符的操作数为非数值时，也需要进行数据转换。遵循如下相应规则：</p> <ul><li>两个都为数值时，进行数值比较</li> <li>两个都为字符串时，比较两个字符串对应的字符编码值</li> <li>一个为数值时，则将另一个转换为数值进行数值比较</li> <li>如果一个为布尔值时，则转换为数值, 进行比较</li> <li>如果一个是对象，则调用这个对象的valueOf(), 用得到的结果按照前面的规则执行比较，如果没有valueOf方法，则调用toString().</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token string">'10'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token number">4.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'aad'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

<span class="token comment">// 解析</span>

<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token string">'10'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">'2'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token string">'10'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">59</span> <span class="token operator">&gt;</span> <span class="token number">49</span>
<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token string">'b'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">97</span> <span class="token operator">&gt;</span> <span class="token number">98</span>
<span class="token number">4.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'aad'</span><span class="token punctuation">)</span> 先是比较 <span class="token string">'a'</span>

和 <span class="token string">'a'</span>
比较 然后是第二个字符 <span class="token comment">// 将2个数都是多位字符串时从左往右依次对位比较</span>
</code></pre></div><h4 id="相等操作符"><a href="#相等操作符" aria-hidden="true" class="header-anchor">#</a> 相等操作符</h4> <p>具有 相等和不相等、全等和不全等；相等和不相等先转换再比较，全等和不全等仅比较不转换</p> <h5 id="相等和不相等"><a href="#相等和不相等" aria-hidden="true" class="header-anchor">#</a> 相等和不相等</h5> <p>相等（==） 和 不相等（!=）两个操作符都会先转换操作数(强制转换), 然后再比较他们的相等性。</p> <p>在转换不同的数据类型时，遵循如下规则</p> <ul><li>如果有一个为布尔值，先转换为数值，再比较</li> <li>如果有一个为字符串，另一个为数值，则将字符串转数值比较</li> <li>如果一个操作数是对象，另一个不是，则调用对象的valueOf(), 得到基本类型值再按照前面的规则比较</li> <li>null 和 undefined 相等</li> <li>要比较相等性之前，不能讲null和undefined转换成其他任何值</li> <li>NaN == NaN // false ; NaN != NaN // true</li> <li>如果两个操作数都是对象，则比较它们是不是同一个对象，指向同一个对象返回true</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">null</span> <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token comment">// true</span>
<span class="token number">5</span> <span class="token operator">==</span> <span class="token number">NaN</span> <span class="token comment">// false</span>
<span class="token boolean">true</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token comment">// true</span>
<span class="token boolean">true</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token comment">// false</span>
<span class="token number">0</span> <span class="token operator">==</span> <span class="token keyword">undefined</span> <span class="token comment">// false</span>
<span class="token number">0</span> <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token comment">// false</span>
<span class="token string">'5'</span> <span class="token operator">==</span> <span class="token number">5</span> <span class="token comment">// true</span>
</code></pre></div><h5 id="全等和不全等"><a href="#全等和不全等" aria-hidden="true" class="header-anchor">#</a> 全等和不全等</h5> <p>使用全等符号时，不会自动转换数据类型，所有该符号也对数据类型进行了比较。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">null</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token comment">// false</span>
<span class="token keyword">null</span> <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token comment">// true</span>
<span class="token keyword">undefined</span> <span class="token operator">===</span> <span class="token keyword">undefined</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="类型转换之隐式转换"><a href="#类型转换之隐式转换" aria-hidden="true" class="header-anchor">#</a> 类型转换之隐式转换</h2> <h3 id="定义"><a href="#定义" aria-hidden="true" class="header-anchor">#</a> 定义</h3> <p>在js中，当运算符在运算时，如果两边数据不统一，cpu就无法计算，这时编辑器会自动将运算符两边的数据进行类型转换，转换成一样的类型进行计算。
这种编辑器自动转换的操作被称为隐式转换。</p> <h3 id="触发条件"><a href="#触发条件" aria-hidden="true" class="header-anchor">#</a> 触发条件</h3> <ul><li>转成String 类型 <code>+</code> (字符串连接符)</li> <li>转成Number 类型 <code>++/--</code> (自增自减运算符) <code>+ - * / %</code> (算法运算符) <code>&gt; &lt; &gt;= &lt;= == !=</code> (关系运算符)</li> <li>转成Boolean 类型 <code>!</code> （逻辑非运算符）</li></ul> <h3 id="问题解析"><a href="#问题解析" aria-hidden="true" class="header-anchor">#</a> 问题解析</h3> <h4 id="字符串连接符与算术运算符"><a href="#字符串连接符与算术运算符" aria-hidden="true" class="header-anchor">#</a> 字符串连接符与算术运算符</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token string">&quot;true&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 1true</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token comment">// 2</span>
<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// NaN</span>
<span class="token number">4.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 1</span>

</code></pre></div><p><strong>解析</strong></p> <p>只要 <code>+</code> 号两边有一边是字符串 作为字符串连接理解，反之作为算术运算符理解。</p> <ol><li>作为字符串连接符时，会将其他数据类型调用String()方法转为字符串然后拼接</li> <li>作为算法运算符时，会将其他数据调用Number()方法转为数字然后加法运算</li></ol> <p>问题对应转换理解</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'true'</span> <span class="token operator">=</span> <span class="token string">'1true'</span>
<span class="token number">2.</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token number">3.</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">NaN</span> <span class="token operator">=</span> <span class="token number">NaN</span>
<span class="token number">4.</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">+</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">1</span>

</code></pre></div><h4 id="关系运算符-2"><a href="#关系运算符-2" aria-hidden="true" class="header-anchor">#</a> 关系运算符</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token string">'10'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token number">4.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token number">5.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'aad'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token number">6.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">undefined</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
<span class="token number">7.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">NaN</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

</code></pre></div><p><strong>解析</strong></p> <ol><li>当关系运算符两边有一边是字符串时，会将其他数据类型使用Number()转换后比较。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">10</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>

</code></pre></div><ol start="2"><li>当关系运算符两边都是字符串的时候，此时同时转成Number然后比较关系，但此时不用Number()方法来转换，而是按照字符串的unicode编码来转换为数字</li></ol> <p>charCodeAt 方法可以查看字符的unicode编码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'2'</span> <span class="token operator">&gt;</span> <span class="token string">'10'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">'2'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token string">'10'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">59</span> <span class="token operator">&gt;</span> <span class="token number">49</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'b'</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token string">'b'</span><span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">97</span> <span class="token operator">&gt;</span> <span class="token number">98</span>

<span class="token comment">// 将2个数都是多位字符串时从左往右依次对位比较</span>

<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'abc'</span> <span class="token operator">&gt;</span> <span class="token string">'aad'</span><span class="token punctuation">)</span> 先是比较 <span class="token string">'a'</span>和 <span class="token string">'a'</span> 比较 然后是第二个字符
</code></pre></div><ol start="3"><li>特殊情况 如果数据类型是 Undefined 和 Null 得出固定结果；NaN与任何数据类型比较都是NaN</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">undefined</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">undefined</span> <span class="token operator">==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nul <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token number">4.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">NaN</span> <span class="token operator">==</span> <span class="token number">NaN</span><span class="token punctuation">)</span> <span class="token comment">// false</span>

</code></pre></div><h4 id="复杂数据类型隐式转换"><a href="#复杂数据类型隐式转换" aria-hidden="true" class="header-anchor">#</a> 复杂数据类型隐式转换</h4> <p>复杂数据类型在隐式转换时会先使用valueOf()方法获取原始值如果原始值不是Number类型，则使用toString()转成String，然后再将String转成Number运算</p> <p>例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'1,2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">'1,2'</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token string">&quot;[object Object]&quot;</span><span class="token punctuation">)</span>

a<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> a<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">&quot;[object Object]&quot;</span>
</code></pre></div><p><strong>经典试题</strong></p> <p>如何完善a，使得能正确输出</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token operator">?</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>分析题目得出要有输出结果 那么需要满足a等于1且等于2且等于3，在数学逻辑上一个简单类型的常量是不能实现的，那么转变思维，那是一个复杂数据类型呢。当a是一个对象时是不是可以满足。这就满足了上面讲述的复杂数据类型隐式转换.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
    i<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
    <span class="token function-variable function">valueOf</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">++</span>a<span class="token punctuation">.</span>i
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们重写valueOf 方法 便可以满足条件成功输出，因为每一次 比较 '==' 时 都会调用一次valueOf 方法</p> <h4 id="逻辑非隐式转换-与-关系运算符结合"><a href="#逻辑非隐式转换-与-关系运算符结合" aria-hidden="true" class="header-anchor">#</a> 逻辑非隐式转换 与 关系运算符结合</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">''</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">toSrring</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">&gt;</span> <span class="token string">'[object Object]'</span>
</code></pre></div><p>注意：空数组的toString()得到的是空字符串，空对象得到的是'[object, Object]'</p> <p><strong>例题</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token number">1.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//true</span>
<span class="token number">2.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//true</span>
<span class="token number">3.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token operator">!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//true</span>
<span class="token number">4.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
<span class="token number">5.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">==</span> <span class="token operator">!</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//false</span>
<span class="token number">6.</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token operator">==</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">//false</span>

</code></pre></div><ol><li>关系运算符：将其他数据类型转换成数字</li> <li>逻辑非：将其他数据类型使用Boolean()转换成布尔类型</li></ol> <p>以下情况转换为布尔值为false, 反则为true</p> <ul><li>0 或 -0</li> <li>NaN</li> <li>undefined</li> <li>null</li> <li>空字符串</li></ul> <p><strong>问题分析</strong></p> <p>问题1：该问题是复杂数据类型和关系运算符的结合，[].valueOf().toString()得到空字符串，空字符串使用Number()转换得到的是0 所以输出true</p> <p>问题2：逻辑非优先级高于关系运算符，所以问题变为![] 和 0 比较，[]转换为布尔值为ture，取非为false，0为false 所以输出ture</p> <p>问题3：问题本质是[] 与 ![] 但是不是转换为布尔值比较而是转变为数字比较 []转为数字 [].valueOf().toString() -&gt; '' -&gt; Number('') -&gt; 0, ![]转化为数字 ![] -&gt; false -&gt; 0 所以输出为true</p> <p>问题4：[]为引用类型, 数据存在堆中, 栈中存储的是地址，所以结果是false</p> <p>问题5：问题本质是{} 与 !{} 也是转换为数字比较不是布尔值比较。{}.valueOf().toString() -&gt; '[object Object]' -&gt; Number('[object Object]') -&gt; NaN, !{} -&gt; false -&gt; 0 所以结果是 false</p> <p>问题6：该问题同问题4 都是引用类型数据的比较问题。</p> <h2 id="基本类型和引用类型"><a href="#基本类型和引用类型" aria-hidden="true" class="header-anchor">#</a> 基本类型和引用类型</h2> <p>基本类型值指的是简单的数据段；引用类型值指那些可能由多个值构成的对象</p> <p>基本类型：Number、String、Null、Undefined、Boolean</p> <p>引用类型：Object、Fuction、Array、Date等</p> <p>js的变量的存储方式--栈（stack）和堆（heap）</p> <p>栈：自动分配内存空间，系统自动释放，里面存放的是基本类型的值和引用类型的地址</p> <p>堆：动态分配的内存，大小不定，也不会自动释放。里面存放引用类型的值。</p> <p>基本类型的比较是值比较；引用类型的比较是引用的比较。</p> <h3 id="动态属性"><a href="#动态属性" aria-hidden="true" class="header-anchor">#</a> 动态属性</h3> <p>对于引用类型的值，可以添加属性和方法，也可以改变和删除其属性和方法, 基本类型不行。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Objeact</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
o<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'name'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">0.</span>name<span class="token punctuation">)</span> <span class="token comment">// 'name'</span>

<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'name'</span>
name<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">1</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>age<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre></div><h3 id="复制变量值"><a href="#复制变量值" aria-hidden="true" class="header-anchor">#</a> 复制变量值</h3> <p>基本类型复制的是值，引用类型复制的是地址。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> num1 <span class="token operator">=</span> <span class="token number">5</span>
<span class="token keyword">var</span> num2 <span class="token operator">=</span> num1<span class="token punctuation">;</span>

num1 <span class="token operator">=</span> <span class="token number">6</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num1<span class="token punctuation">)</span> <span class="token comment">// 6</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span> <span class="token comment">// 5</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> obj2 <span class="token operator">=</span> obj1<span class="token punctuation">;</span>
obj1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'name'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// name</span>

obj1、 obj2 指向的是同一片内存
</code></pre></div><h3 id="传递参数"><a href="#传递参数" aria-hidden="true" class="header-anchor">#</a> 传递参数</h3> <p>函数的参数都是按值传递的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token number">1.</span>

<span class="token keyword">function</span> <span class="token function">addTen</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> num <span class="token operator">+=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token function">addTen</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token comment">// 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token comment">// 30</span>

<span class="token number">2.</span>

<span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ye'</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setName</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// ye</span>

<span class="token number">3.</span>

<span class="token keyword">function</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ye'</span>
    obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'a'</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">setName</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// ye</span>
</code></pre></div><p>示例3与示例2的比较在于重新定义了一个对象，如果是按传地址的方式话  name 会被修改的</p> <h2 id="js执行机制"><a href="#js执行机制" aria-hidden="true" class="header-anchor">#</a> JS执行机制</h2> <h3 id="变量提升（hoisting）"><a href="#变量提升（hoisting）" aria-hidden="true" class="header-anchor">#</a> 变量提升（Hoisting）</h3> <p>在了解变量提升之前，先需要了解JS中的<strong>声明</strong>与<strong>赋值</strong>.下面用例子说明：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> myname <span class="token operator">=</span> <span class="token string">'Ye'</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将上面代码转换成下面的样子</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> myname <span class="token operator">=</span> undefiend <span class="token comment">// 声明</span>
myname <span class="token operator">=</span> <span class="token string">'ye'</span> <span class="token comment">// 赋值</span>

<span class="token keyword">function</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//声明</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">undefined</span>  <span class="token comment">// 声明</span>
<span class="token function-variable function">bar</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 赋值</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>转换之后应该理解什么是<strong>声明</strong>与<strong>赋值</strong>了吧。</p> <p><strong>那么所谓的变量提升，是指在 JavaScript 代码执行过程中，JavaScript 引擎把变量的声明部分和函数的声明部分提升到代码开头的“行为”。变量被提升后，会给变量设置默认值，这个默认值就是我们熟悉的 undefined。</strong></p> <p>从概念的字面意义上来看，“变量提升”意味着变量和函数的声明会在物理层面移动到代码的最前面，正如我们所模拟的那样。但，这并不准确。实际上变量和函数声明在代码里的位置是不会改变的，而且是在编译阶段被 JavaScript 引擎放入内存中。如图所示</p> <p><img src="/assets/img/jsrunflow.649c6e3b.png" alt=""></p> <ol><li>编译阶段</li></ol> <p>当输入一段代码，经过编译之后，会生成两部分内容：<strong>执行上下文Execution context）<strong>和</strong>可执行代码</strong></p> <p>执行上下文是 JavaScript 执行一段代码时的运行环境，比如调用一个函数，就会进入这个函数的执行上下文，确定该函数在执行期间用到的诸如 this、变量、对象以及函数等。</p> <p>如果在编译阶段，存在两个相同的函数，那么最终存放在变量环境中的是最后定义的那个，这是因为后定义的会覆盖掉之前定义的。例子说明</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ye1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ye2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>两次输出都是ye2</p> <ol start="2"><li>执行阶段</li></ol> <p>JavaScript 引擎开始执行“可执行代码”，按照顺序一行一行地执行。该阶段 JavaScript 引擎会从变量环境中去查找自定义的变量和函数。</p> <h3 id="调用栈"><a href="#调用栈" aria-hidden="true" class="header-anchor">#</a> 调用栈</h3> <p>上文说过，当一段代码被执行时，JavaScript 引擎先会对其进行编译，并创建执行上下文。那什么情况下都会被创建吗，并不是的。</p> <p>创建执行上下文。一般说来，有这么三种情况：</p> <ol><li>当 JavaScript 执行全局代码的时候，会编译全局代码并创建全局执行上下文，而且在整个页面的生存周期内，全局执行上下文只有一份。</li> <li>当调用一个函数的时候，函数体内的代码会被编译，并创建函数执行上下文，一般情况下，函数执行结束之后，创建的函数执行上下文会被销毁。</li> <li>当使用 eval 函数的时候，eval 的代码也会被编译，并创建执行上下文</li></ol> <p>在一个js文件中肯定有很多个函数，那这些函数上下文是怎么被管理的呢？</p> <p>Javascript引擎利用栈的结果来管理执行上下文。在执行上下文创建好后，JavaScript 引擎会将执行上下文压入栈中，通常把这种用来管理执行上下文的栈称为<strong>执行上下文栈</strong>，又称<strong>调用栈</strong>。</p> <p>接下来用一段示例代码和图片来说明栈的工作机制：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> b<span class="token operator">+</span>c
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token parameter">b<span class="token punctuation">,</span>c</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">var</span> d <span class="token operator">=</span> <span class="token number">10</span>
result <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span>
<span class="token keyword">return</span>  a<span class="token operator">+</span>result<span class="token operator">+</span>d
<span class="token punctuation">}</span>
<span class="token function">addAll</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>
</code></pre></div><ol><li><p>第一步，创建全局上下文，并将其压入栈底。如下图所示：
<img src="/assets/img/stack1-1.a5d7ec1f.png" alt="">
全局执行上下文压入到调用栈后，JavaScript 引擎便开始执行全局代码了。首先会执行 a=2 的赋值操作，执行该语句会将全局上下文变量环境中 a 的值设置为 2。设置后的全局上下文的状态如下图所示：
<img src="/assets/img/stack1-2.1d50269d.png" alt=""></p></li> <li><p>第二步 调用 addAll 函数 JavaScript 引擎会编译该函数，并为其创建一个执行上下文，最后还将该函数的执行上下文压入栈中，如下图所示：
<img src="/assets/img/stack2-1.7d6c4c45.png" alt="">
addAll 函数的执行上下文创建好之后，便进入了函数代码的执行阶段了，这里先执行的是 d=10 的赋值操作，执行语句会将 addAll 函数执行上下文中的 d 由 undefined 变成了 10。</p></li> <li><p>第三步，当执行到 add 函数 当调用该函数时,同样会为其创建执行上下文，并将其压入调用栈，如下图所示：
<img src="/assets/img/stack3-1.ccfe41d9.png" alt=""></p></li> <li><p>当 add 函数返回时，该函数的执行上下文就会从栈顶弹出，并将 result 的值设置为 add 函数的返回值，也就是 9。如下图所示：</p></li></ol> <p><img src="/assets/img/stack4-1.03ca801a.png" alt="">
5. 紧接着 addAll 执行最后一个相加操作后并返回，addAll 的执行上下文也会从栈顶部弹出，此时调用栈中就只剩下全局上下文了。最终如下图所示：
<img src="/assets/img/stack5-1.d0ac1d6e.png" alt=""></p> <p>至此，整个 JavaScript 流程执行结束了。</p> <h4 id="如何利用浏览器查看调用栈的信息"><a href="#如何利用浏览器查看调用栈的信息" aria-hidden="true" class="header-anchor">#</a> 如何利用浏览器查看调用栈的信息</h4> <p>这里我们拿上面的那段代码做个演示，你可以打开“开发者工具”，点击“Source”标签，选择 JavaScript 代码的页面，然后在第 3 行加上断点，并刷新页面。你可以看到执行到 add 函数时，执行流程就暂停了，这时可以通过右边“call stack”来查看当前的调用栈的情况，如下图：
<img src="/assets/img/stacklook.c0d303a2.png" alt=""></p> <p>从图中可以看出，右边的“call stack”下面显示出来了函数的调用关系：栈的最底部是 anonymous，也就是全局的函数入口；中间是 addAll 函数；顶部是 add 函数。这就清晰地反映了函数的调用关系，所以在分析复杂结构代码，或者检查 Bug 时，调用栈都是非常有用的</p> <p>除了通过断点来查看调用栈，你还可以使用 console.trace() 来输出当前的函数调用关系.</p> <h4 id="栈溢出（stack-overflow）"><a href="#栈溢出（stack-overflow）" aria-hidden="true" class="header-anchor">#</a> 栈溢出（Stack Overflow）</h4> <p>现在你知道了调用栈是一种用来管理执行上下文的数据结构，符合后进先出的规则。不过还有一点你要注意，<strong>调用栈是有大小的</strong>，当入栈的执行上下文超过一定数目，JavaScript 引擎就会报错，我们把这种错误叫做<strong>栈溢出</strong>。</p> <p>栈溢出抛出的错误信息为：超过了最大栈调用大小（Maximum call stack size exceeded）</p> <h3 id="作用域"><a href="#作用域" aria-hidden="true" class="header-anchor">#</a> 作用域</h3> <p>作用域是指程序源代码中定义变量的区域，规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。</p> <p>在 ES6 之前，ES 的作用域只有两种：<strong>全局作用域</strong>和<strong>函数作用域</strong>。</p> <ul><li>全局作用域中的对象在代码中的任何地方都能访问，其生命周期伴随着页面的生命周期。</li> <li>函数作用域就是在函数内部定义的变量或者函数，并且定义的变量或者函数只能在函数内部被访问。函数执行结束之后，函数内部定义的变量会被销毁。</li></ul> <p>ES6中引入了<strong>块级作用域</strong></p> <p>那么为什么ES6需要支持块级作用域呢，主要是为了解决变量提升所带来的问题。</p> <ol><li>变量容易在不被察觉的情况下被覆盖掉</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> myname <span class="token operator">=</span> <span class="token string">&quot;ye&quot;</span>
<span class="token keyword">function</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">var</span> myname <span class="token operator">=</span> <span class="token string">&quot;ye1&quot;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>当你看上之前的文章，想必你肯定知道答案输出的是undefined。这输出的结果和其他大部分支持块级作用域的语言都不一样。如果你大学学过c语言，就会觉得这段好变扭</p> <ol start="2"><li>本应销毁的变量没有被销毁</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>如果你使用 C 语言或者其他的大部分语言实现类似代码，在 for 循环结束之后，i 就已经被销毁了，但是在 JavaScript 代码中，i 的值并未被销毁，所以最后打印出来的是 7。</p> <p>那ES6是怎么解决这个问题的呢？为了解决这些问题，ES6 引入了 <strong>let 和 const</strong>关键字，从而使 JavaScript 也能像其他语言一样拥有了块级作用域。ES6具体的知识点<a href="/es6.html">请点击此处</a></p> <h4 id="javascript-是如何支持块级作用域的"><a href="#javascript-是如何支持块级作用域的" aria-hidden="true" class="header-anchor">#</a> JavaScript 是如何支持块级作用域的</h4> <p>现在你知道了 ES6 可以通过使用 let 或者 const 关键字来实现块级作用域，不过你是否有过这样的疑问：“在同一段代码中，ES6 是如何做到既要支持变量提升的特性，又要支持块级作用域的呢？”</p> <p>那么接下来，我们就要站在<strong>执行上下文</strong>的角度来揭开答案。先带下面这段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">3</span>
      <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">4</span>
      <span class="token keyword">let</span> d <span class="token operator">=</span> <span class="token number">5</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> 
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token punctuation">}</span>   
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>在没有引入let关键字之前，怎么创建执行上下文，前文已经介绍过了，现在我们引入了 let 关键字，let 关键字会创建块级作用域，那么 let 关键字是如何影响执行上下文的呢？</p> <ol><li>第一步是编译并创建执行上下文
<img src="/assets/img/letstack1.f9f67f2f.png" alt=""></li></ol> <ul><li>函数内部通过 var 声明的变量，在编译阶段全都被存放到变量环境里面了。</li> <li>通过 let 声明的变量，在编译阶段会被存放到词法环境（Lexical Environment）中。</li> <li>在函数的作用域块内部，通过 let 声明的变量并没有被存放到词法环境中。</li></ul> <ol start="2"><li>第二步继续执行代码，当执行到代码块里面时，变量环境中 a 的值已经被设置成了 1，词法环境中 b 的值已经被设置成了 2.
<img src="/assets/img/letstack2.7e0f7bc3.png" alt="">
从图中可以看出，当进入函数的作用域块时，作用域块中通过 let 声明的变量，会被存放在词法环境的一个单独的区域中，这个区域中的变量并不影响作用域块外面的变量，比如在作用域外面声明了变量 b，在该作用域块内部也声明了变量 b，当执行到作用域内部时，它们都是独立的存在。</li></ol> <p>其实，在词法环境内部，维护了一个小型栈结构，栈底是函数最外层的变量，进入一个作用域块后，就会把该作用域块内部的变量压到栈顶；当作用域执行完成之后，该作用域的信息就会从栈顶弹出，这就是词法环境的结构。需要注意下，我这里所讲的变量是指通过 let 或者 const 声明的变量。</p> <ol start="3"><li>再接下来，当执行到作用域块中的console.log(a)这行代码时，就需要在词法环境和变量环境中查找变量 a 的值了，具体查找方式是：沿着词法环境的栈顶向下查询，如果在词法环境中的某个块中查找到了，就直接返回给 JavaScript 引擎，如果没有查找到，那么继续在变量环境中查找</li></ol> <p>完整的流程图如下：
<img src="/assets/img/letstack3.06c06a75.png" alt=""></p> <h3 id="作用域链"><a href="#作用域链" aria-hidden="true" class="header-anchor">#</a> 作用域链</h3> <blockquote><p>当代码在一个环境中执行时，会创建变量对象的一个作用域链。作用域的用途，是保证对执行环境有权访问的所有变量和函数的有序访问。作用域的前端，始终都是当前执行的代码所在环境的变量对象。作用域链中的下一个变量对象来自包含（外部）环境，则再一个变量对象则来自下一个包含环境。这样，一直延续到全局执行环境；全局执行环境的变量对象始终都是作用域链中的最后一个对象</p></blockquote> <p>这样由多个执行上下文的变量对象构成的链表就叫做作用域链。</p> <p>JS 采用的是词法作用域，也就是静态作用域。</p> <h4 id="静态作用域和动态作用域"><a href="#静态作用域和动态作用域" aria-hidden="true" class="header-anchor">#</a> 静态作用域和动态作用域</h4> <p>静态作用域，<strong>函数的作用域在函数定义的时候就决定了</strong>；动态作用域，函数的作用域在函数调用的时候才决定。</p> <p>示例分析：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 输出结果是什么</span>
</code></pre></div><p>输出的结果是1，代表是静态作用域；输出结果是2，代表是动态作用域。</p> <p>当foo函数执行时，当访问value变量时，现在定义函数内查找 ，没有查找到向上一层查找。如果是静态作用域的例子中的上一层就是全局，动态作用域就是bar函数</p> <p>以一个函数的创建和激活两个时期来讲解作用域链是如何创建和变化的</p> <p><strong>函数创建</strong></p> <p>JS采用的是词法作用域，所以函数的作用域在函数定义的时候就决定了。这是因为函数有一个内部属性[[scope]], 当函数创建的时候，就会保存所有父变量对象到其中，你可以理解[[scope]]就是所有父变量对象的层级链，但注意[[scope]]并不代表完整的作用域链</p> <p>实例:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数创建时，各自的[[scope]]为:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>foo<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">]</span>

bar<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    fooContext<span class="token punctuation">.</span><span class="token constant">AO</span><span class="token punctuation">,</span>
    globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">]</span>
</code></pre></div><p><strong>函数激活</strong>
当函数激活时，进入函数上下文，创建VO/AO后，就会将活动对象添加到作用域链的前端。这时候执行上下文的作用域链，我们命名为Scope：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Scope <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span>Scope<span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>至此，作用域链创建完毕</p> <h2 id="this"><a href="#this" aria-hidden="true" class="header-anchor">#</a> This</h2> <p>this的绑定规则有以下5种</p> <ol><li>默认绑定</li> <li>隐式绑定</li> <li>显示绑定</li> <li>new绑定</li> <li>箭头函数绑定</li></ol> <h3 id="默认绑定"><a href="#默认绑定" aria-hidden="true" class="header-anchor">#</a> 默认绑定</h3> <p>默认绑定，<code>在不能应用其它绑定规则时使用的默认规则</code>，通常是<code>独立函数调用</code>。</p> <p>严格模式下，不能将全局对象用于默认绑定，this会绑定到undefined。只有函数运行在非严格模式下，默认绑定才能绑定到全局对象。在严格模式下调用函数则不影响默认绑定。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Ye'</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'Hello Ye'</span>
</code></pre></div><h3 id="隐式绑定"><a href="#隐式绑定" aria-hidden="true" class="header-anchor">#</a> 隐式绑定</h3> <ol><li>函数的调用是在某个对象上触发的，即调用位置上存在上下文对象。典型的形式为 XXX.fun()</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'Ye'</span><span class="token punctuation">,</span>
  sayHi<span class="token punctuation">:</span> sayHi
<span class="token punctuation">}</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Hong'</span>
person<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Hello Ye</span>
</code></pre></div><ol start="2"><li>对象属性引用链中只有上一层或者说最后一层在调用中起作用。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Hong'</span><span class="token punctuation">,</span>
    friend<span class="token punctuation">:</span> person2
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Ye'</span><span class="token punctuation">,</span>
    sayHi<span class="token punctuation">:</span> sayHi
<span class="token punctuation">}</span>
person1<span class="token punctuation">.</span>friend<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello Ye</span>
</code></pre></div><ol start="3"><li>[]语法</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span>fn<span class="token punctuation">,</span>fn2<span class="token punctuation">]</span>
arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this的结果又是什么呢</span>
</code></pre></div><p>可以换算理解<code>arr[0]()</code>理解为<code>arr.0()</code> 因为<code>[]</code>等价于<code>.</code>。但是从语法来说是错误的 但是你可以这样换算理解。那么那上述的例子this的指向显然是arr啦</p> <ol start="4"><li>隐式绑定有一个坑，隐式绑定丢失</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Ye'</span><span class="token punctuation">,</span>
    sayHi<span class="token punctuation">:</span> sayHi
<span class="token punctuation">}</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Hong'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Hi <span class="token operator">=</span> person<span class="token punctuation">.</span>sayHi<span class="token punctuation">;</span>
<span class="token function">Hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello Hong</span>
</code></pre></div><p>赋值操作会倒是隐式绑定丢失。参数传递就是一种隐式赋值，传入函数时也会被隐式赋值。回调函数丢失this绑定是非常常见的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'YvetteLau'</span><span class="token punctuation">,</span>
    <span class="token function-variable function">sayHi</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Christina'</span><span class="token punctuation">,</span>
    sayHi<span class="token punctuation">:</span> sayHi
<span class="token punctuation">}</span>
<span class="token keyword">var</span> name<span class="token operator">=</span><span class="token string">'Wiliam'</span><span class="token punctuation">;</span>
person1<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>sayHi<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    person2<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>结果为</p> <div class="language- extra-class"><pre class="language-text"><code>Hello, Wiliam
Hello, Wiliam
Hello, Christina
</code></pre></div><ol><li><p>第一条输出很容易理解，setTimeout的回调函数中，this使用的是默认绑定，非严格模式下，执行的是全局对象</p></li> <li><p>第二条输出是不是有点迷惑了？说好XXX.fun()的时候，fun中的this指向的是XXX呢，为什么这次却不是这样了！Why?</p></li></ol> <p>其实这里我们可以这样理解: setTimeout(fn,delay){ fn(); },相当于是将person2.sayHi赋值给了一个变量，最后执行了变量，这个时候，sayHi中的this显然和person2就没有关系了。</p> <ol start="3"><li>第三条虽然也是在setTimeout的回调中，但是我们可以看出，这是执行的是person2.sayHi()使用的是隐式绑定，因此这是this指向的是person2，跟当前的作用域没有任何关系。</li></ol> <h3 id="显示绑定"><a href="#显示绑定" aria-hidden="true" class="header-anchor">#</a> 显示绑定</h3> <p>显式绑定比较好理解，就是通过call,apply,bind的方式，显式的指定this所指向的对象</p> <p>call,apply和bind的第一个参数，就是对应函数的this所指向的对象。call和apply的作用一样，只是传参方式不同。call和apply都会执行对应的函数，而bind方法不会。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Ye'</span><span class="token punctuation">,</span>
    sayHi<span class="token punctuation">:</span> sayHi
<span class="token punctuation">}</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Hong'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Hi <span class="token operator">=</span> person<span class="token punctuation">.</span>sayHi<span class="token punctuation">;</span>
<span class="token function">Hi</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>输出的结果为: Hello, Ye. 因为使用硬绑定明确将this绑定在了person上</p> <h3 id="new-绑定"><a href="#new-绑定" aria-hidden="true" class="header-anchor">#</a> new 绑定</h3> <ul><li>在JS中，构造函数只是使用new操作符时被调用的普通函数，他们不属于某个类，也不会实例化一个类。</li> <li>包括内置对象函数（比如Number(..)）在内的所有函数都可以用new来调用，这种函数调用被称为构造函数调用。</li> <li>实际上并不存在所谓的“构造函数”，只有对于函数的“构造调用”。</li></ul> <p>使用new来调用函数，会自动执行下面的操作：</p> <ol><li>创建（或者说构造）一个新对象。</li> <li>这个新对象会被执行[[Prototype]]连接。</li> <li>这个新对象会绑定到函数调用的this。</li> <li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象。</li></ol> <p>具体实现可以查看<a href="/js_advanced.html#new-操作符">new-操作符</a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
	
<span class="token punctuation">}</span>
<span class="token keyword">var</span> Hi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">sayHi</span><span class="token punctuation">(</span><span class="token string">'Ye'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello,'</span><span class="token punctuation">,</span> Hi<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>输出结果为 Hello, Ye, 原因是因为在var Hi = new sayHi('Ye');这一步，会将sayHi中的this绑定到Hi对象上。</p> <h3 id="绑定优先级"><a href="#绑定优先级" aria-hidden="true" class="header-anchor">#</a> 绑定优先级</h3> <p><code>new绑定 &gt; 显式绑定 &gt; 隐式绑定 &gt; 默认绑定</code></p> <h3 id="绑定例外"><a href="#绑定例外" aria-hidden="true" class="header-anchor">#</a> 绑定例外</h3> <p>如果我们将null或者是undefined作为this的绑定对象传入call、apply或者是bind,这些值在调用时会被忽略，实际应用的是默认绑定规则。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Selina'</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'Chirs'</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Chirs </span>
</code></pre></div><p>输出的结果是 Chirs，因为这时实际应用的是默认绑定规则。</p> <h3 id="箭头函数"><a href="#箭头函数" aria-hidden="true" class="header-anchor">#</a> 箭头函数</h3> <p>ES6新增一种特殊函数类型：箭头函数，箭头函数无法使用上述四条规则，而是根据外层（函数或者全局）作用域（词法作用域）来决定this。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 返回一个箭头函数</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// this继承自foo()</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> obj1 <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span> obj2 <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，不是3！</span>
</code></pre></div><p>foo()内部创建的箭头函数会捕获调用时foo()的this。由于foo()的this绑定到obj1，bar(引用箭头函数)的this也会绑定到obj1，箭头函数的绑定无法被修改(new也不行)。</p> <h3 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <ol><li>函数是否在new中调用(new绑定)，如果是，那么this绑定的是新创建的对象。</li> <li>函数是否通过call,apply调用，或者使用了bind(即硬绑定)，如果是，那么this绑定的就是指定的对象。</li> <li>函数是否在某个上下文对象中调用(隐式绑定)，如果是的话，this绑定的是那个上下文对象。一般是obj.foo()</li> <li>如果以上都不是，那么使用默认绑定。如果在严格模式下，则绑定到undefined，否则绑定到全局对象。</li> <li>如果把Null或者undefined作为this的绑定对象传入call、apply或者bind，这些值在调用时会被忽略，实际应用的是默认绑定规则。</li> <li>如果是箭头函数，箭头函数的this继承的是外层代码块的this。</li></ol> <h2 id="原型和原型链"><a href="#原型和原型链" aria-hidden="true" class="header-anchor">#</a> 原型和原型链</h2> <ul><li>所有引用类型（函数、数组、对象）都拥有<code>__proto__</code>属性（隐式原型）</li> <li>所有函数拥有<code>prototype</code>属性（显式原型）（仅限构造函数）</li> <li>原型对象：拥有prototype属性的对象，在定义函数时被创建</li></ul> <h3 id="构造函数、实例原型、实例之间的关系"><a href="#构造函数、实例原型、实例之间的关系" aria-hidden="true" class="header-anchor">#</a> 构造函数、实例原型、实例之间的关系</h3> <p>每个构造函数(constructor)都有一个原型对象(prototype), 原型对象都包含一个指向构造函数的指针, 而实例(instance)都包含一个指向原型对象的内部指针( <code>__proto__</code> ).</p> <p><img src="/assets/img/prototype1.5fa1915a.png" alt="An image"></p> <h3 id="原型的原型"><a href="#原型的原型" aria-hidden="true" class="header-anchor">#</a> 原型的原型</h3> <p>每个对象都有__proto__ 属性，指向创建该对象的构造函数的原型。大多数情况下 <code>__proto__</code> 可以理解为 构造器的原型，即： <code>__proto__ === constructor.prototype</code></p> <p>那么原型也是对象，那它的原型是什么呢。既然是对象，那么最原始的创建方式就是 <code>new Object（）</code> ，那它的构造函数就是Object 构造函数，结合上述知识点那原型的原型就是 <code>Object.prototype</code></p> <p><img src="/assets/img/prototype2.33e81924.png" alt="An image"></p> <h3 id="原型链"><a href="#原型链" aria-hidden="true" class="header-anchor">#</a> 原型链</h3> <p>引用JavaScript高级程序设计中的话</p> <blockquote><p>ECMAScript 中描述了原型链的概念，并将原型链作为实现继承的主要方法。其基本思想是利用原型让一个引用类型继承另一个引用类型的属性和方法</p></blockquote> <blockquote><p>那么，假如我们让原型对象等于另一个类型的实例，结果会怎么样呢? 显然，此时的 原型对象将包含一个指向另一个原型的指针，相应地，另一个原型中也包含着一个指向另一个构造函数 的指针。假如另一个原型又是另一个类型的实例，那么上述关系依然成立，如此层层递进，就构成了实 例与原型的链条。这就是所谓原型链的基本概念。</p></blockquote> <p>你可能会觉得那么Object.prototype 的原型又是什么呢。</p> <p>Object.prototype的原型其实是null。null表示程序级的、正常的或在意料之中的值的空缺。所以 <code>Object.prototype.__proto__</code> 的值为 null 跟 Object.prototype 没有原型，其实表达了一个意思。也可以理解为系统内置的一个值。所以查找属性的时候查到原型为null就可以停止查找了。</p> <p><img src="/assets/img/prototype3.0eda1a47.png" alt="An image"></p> <p>图中由相互关联的原型组成的链状结构就是原型链，也就是蓝色的这条线。</p> <p>简而言之 一条<code>__proto__</code>连起来的链条，递归访问<code>__proto__</code>必须最终到头，并且值是null。</p> <h3 id="函数的原型"><a href="#函数的原型" aria-hidden="true" class="header-anchor">#</a> 函数的原型</h3> <p>函数也是一种对象，那么它也有原型，那它的原型是什么呢。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> foo1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;y&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;return x + y&quot;</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">foo1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>示例代码中有两种创建函数的方法，第一种是常用的，第二种通过 new Function创建，但是这种不推荐；只是为了说明函数的构造函数是<strong>Function</strong></p> <p>那么可以得出 <code>foo.__proto__ === Function.prototype</code></p> <p>其实 <code>Object.__proto__ === Function.prototype</code> , Object 函数 个人理解作为内置对象在环境创建的时候就被内置，因为它们也是函数，也需要继承来自 Function.prototype 的方法，所以又将它们的 <code>__proto__</code> 指向了 Function.prototype，</p> <p>你可能又会有疑问 那 <code>Function.__proto__</code> 等于什么呢 ?</p> <p>因为Funtion 函数也是系统内置的，默认的指向了Function.prototype.</p> <p><code>Function.__proto__ === Function.prototype</code></p> <p>那Function.prototype 的 <code>__proto__</code> 又是什么呢?</p> <p>因为Function.prototype也是一个对象，所以 <code>Function.prototype.__proto__ == Object.prototype</code></p> <p>完成的图如下：</p> <p><img src="/assets/img/prototype4.f34c4d55.jpg" alt="An image"></p> <p>如下几点需要注意加深记忆理解：</p> <ol><li><p><code>Object.__proto__ === Function.prototype</code></p></li> <li><p><code>Object.prototype.__proto__ === null</code></p></li> <li><p><code>Function.prototype.__proto__ === Object.prototype</code></p></li> <li><p><code>Function.__proto__ === Function.prototype</code></p></li></ol> <h2 id="继承"><a href="#继承" aria-hidden="true" class="header-anchor">#</a> 继承</h2> <p>下面将讲述实现继承的几种方式, 以及其的优缺点。</p> <h3 id="原型链继承"><a href="#原型链继承" aria-hidden="true" class="header-anchor">#</a> 原型链继承</h3> <p>核心：父类的实例作为子类的原型</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'Tom'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'bule'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">food</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 关键</span>

<span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span>sayName<span class="token punctuation">)</span> <span class="token comment">// Tom</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat <span class="token keyword">instanceof</span> <span class="token class-name">Animal</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat <span class="token keyword">instanceof</span> <span class="token class-name">Cat</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h4 id="特点"><a href="#特点" aria-hidden="true" class="header-anchor">#</a> 特点</h4> <ul><li>非常简单的继承关系，实例是子类的实例，也是父类的实例</li> <li>父类新增原型方法/属性，子类都能访问到</li></ul> <h4 id="缺点"><a href="#缺点" aria-hidden="true" class="header-anchor">#</a> 缺点</h4> <ol><li>子类型重写超类型中的方法，或者添加超类型中不存在的方法。给原型添加/重写方法的代码一定要放在替换原型的语句之后。</li></ol> <p>示例说明</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'Tom'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'bule'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 1</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHeight</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//</span>

<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayHeight</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//</span>

<span class="token keyword">var</span> cat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1号位输出. undefined    2号位输出. 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat<span class="token punctuation">.</span><span class="token function">sayHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//1号位输出. not a function     2号位输出. 20</span>
</code></pre></div><p>如果代码放在1号位则输出的undfined，放在2号位则能正常输出数值20</p> <ol start="2"><li>引用类型的属性被所有实例共享</li></ol> <p>示例说明</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'Tom'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'bule'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">var</span> cat1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
cat1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// ['red','bule','white']</span>

<span class="token keyword">var</span> cat2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// ['red','bule','white']</span>
</code></pre></div><ol start="3"><li>创建子类实例时，无法向父类构造函数传参</li> <li>无法实现多继承</li></ol> <h3 id="借用构造函数继承"><a href="#借用构造函数继承" aria-hidden="true" class="header-anchor">#</a> 借用构造函数继承</h3> <p>在解决原型中包含引用类型值所带来问题的过程中开始使用一种叫做借用构造函数 (constructor stealing)的技术(有时候也叫做伪造对象或经典继承)。这种技术的基本思想相当简单，即在子类型构造函数的内部调用超类型构造函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'Tom'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'bule'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Cat</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span> <span class="token comment">// 可以向父类传参</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> cat1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token string">'Tom'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> cat2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">)</span>

cat1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// ['red','bule','white']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// ['red','bule']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Tom</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Jack</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1 <span class="token keyword">instanceof</span> <span class="token class-name">Animal</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: cat1.sayName is not a function</span>
</code></pre></div><h4 id="特点-2"><a href="#特点-2" aria-hidden="true" class="header-anchor">#</a> 特点</h4> <ol><li>解决了原型链继承中，子类实例共享父类引用属性的问题</li> <li>创造子类实例时，可以向父类传递参数</li> <li>可以实现多继承 call 多个父类</li></ol> <h4 id="缺点-2"><a href="#缺点-2" aria-hidden="true" class="header-anchor">#</a> 缺点</h4> <ol><li>实例是子类实例，不是父类实例 <code>console.log(cat1 instanceof Animal); // false</code></li> <li>并没有继承父类原型上的方法 <code>console.log(cat1.sayName()) // Uncaught TypeError: cat1.sayName is not a function</code></li></ol> <h3 id="组合继承"><a href="#组合继承" aria-hidden="true" class="header-anchor">#</a> 组合继承</h3> <p>组合继承，有时也叫做伪经典继承，指的是将原型链和借用构造函数的技术组合到一块，从而发挥二者之长的一种继承模式。其背后的思路是使用原型链实现对原型属性和方法的继承，而通过借用构造函数来实现对实例属性的继承。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'Tom'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'bule'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Cat</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 继承属性</span>
  <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span> <span class="token comment">//第二次调用Animal() 父类构造器</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//第一次调用Animal() 父类构造器</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Cat 

<span class="token comment">// 继承属性</span>
<span class="token class-name">Cat</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayAge</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>age
<span class="token punctuation">}</span>


<span class="token keyword">var</span> cat1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> cat2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token string">'Rose'</span><span class="token punctuation">,</span><span class="token number">19</span><span class="token punctuation">)</span>

cat1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// ['red','blue','white']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span> <span class="token comment">// ['red','blue']</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 'Jack'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat2<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// Rose</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat1<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 18</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cat2<span class="token punctuation">.</span><span class="token function">sayAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 19</span>
</code></pre></div><p>组合继承避免了原型链和借用构造函数的缺陷，融合了它们的优点，成为 JavaScript 中最常用的继 承模式。而且，instanceof 和 isPrototypeOf()也能够用于识别基于组合继承创建的对象。</p> <p>缺点：</p> <ol><li>调用两次超类型构造函数: 一次是在创建子类型原型的时候，另一次是 在子类型构造函数内部</li></ol> <h3 id="原型式继承"><a href="#原型式继承" aria-hidden="true" class="header-anchor">#</a> 原型式继承</h3> <p>该方法是由道格拉斯·克罗克福德所提出，他的想法是借助原型可以基于已有的对象创建新的对象，同时还不必因此创建自定义类型。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">object</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这其实就是 ECMAScript 5 的 Object.create()方法的实现。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'Tom'</span><span class="token punctuation">,</span>
    friends<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> <span class="token string">'Rose'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token function">object</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span>

person1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'person1'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Tom</span>

person1<span class="token punctuation">.</span>firends<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'Tisa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>friends<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;Jack&quot;, &quot;Rose&quot;, &quot;Tisa&quot;]</span>
</code></pre></div><p>缺点：</p> <p>包含引用类型的属性值始终都会共享相应的值，这点跟原型链继承一样。</p> <h3 id="寄生式继承"><a href="#寄生式继承" aria-hidden="true" class="header-anchor">#</a> 寄生式继承</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createObj</span> <span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> clone <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    clone<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> clone<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>缺点：跟借用构造函数模式一样，每次创建对象都会创建一遍方法。</p> <h3 id="寄生组合式继承"><a href="#寄生组合式继承" aria-hidden="true" class="header-anchor">#</a> 寄生组合式继承</h3> <p>所谓寄生组合式继承，即通过借用构造函数来继承属性，通过原型链的混成形式来继承方法。其背 后的基本思路是: 不必为了指定子类型的原型而调用超类型的构造函数，我们所需要的无非就是超类型 原型的一个副本而已。本质上，就是使用寄生式继承来继承超类型的原型，然后再将结果指定给子类型 的原型。</p> <p>核心:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//寄生组合式继承的核心方法s</span>
<span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">subType<span class="token punctuation">,</span>superType</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 继承父类的原型</span>
  <span class="token keyword">var</span> prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>superType<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
  <span class="token comment">// 重写被污染的子类的constructor</span>
  prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> subType
  <span class="token comment">// 重写子类的原型</span>
  supType<span class="token punctuation">.</span>prototype <span class="token operator">=</span> prototype
 
<span class="token punctuation">}</span>

</code></pre></div><p>这个函数接收两个参数: 子类型构造函数和超类型构造函数。在函数内部，</p> <p>第一步是创建超类型原型的一个副本。</p> <p>第二步是为创建的副本添加 constructor 属性，从而弥补因重写原型而失去的默认的 constructor 属性。</p> <p>最后一步，将新创建的对象(即副本)赋值给子类型的原型</p> <p>（简单理解就是找个中间商转接一下原型，为了不被看出来有中间商，指向一下constructor. 哈哈哈哈哈）</p> <p>如何使用：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">||</span> <span class="token string">'Tom'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'bule'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token class-name">Animal</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">food</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Cat</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">Animal</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
<span class="token punctuation">}</span>

<span class="token function">inheritPrototype</span><span class="token punctuation">(</span>Cat<span class="token punctuation">,</span>Animal<span class="token punctuation">)</span>

<span class="token keyword">var</span> cat1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'Jack'</span><span class="token punctuation">,</span> <span class="token string">'18'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>该方法：</p> <ol><li>子类继承了父类的属性和方法，同时，属性没有被创建在原型链上，因此多个子类不会共享同一个属性；</li> <li>子类可以传递动态参数给父类；</li> <li>父类的构造函数只执行了一次。</li> <li>能正常使用 instanceof 和 isPrototypeOf()</li></ol> <p>然而，仍然存在一个美中不足的问题：</p> <p>子类想要在原型上添加方法，必须在继承之后添加，否则将覆盖掉原有原型上的方法。这样的话若是已经存在的两个类，就不好办了。
所以，我们可以将核心代码优化一下</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">inheritPrototype</span><span class="token punctuation">(</span><span class="token parameter">subType<span class="token punctuation">,</span>superType</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 继承父类的原型</span>
  <span class="token keyword">var</span> prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>superType<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
  <span class="token comment">// 重写被污染的子类的constructor</span>
  prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> subType
 <span class="token comment">// 将父类原型和子类原型合并，并赋值给子类的原型</span>
  supType<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>prototype<span class="token punctuation">,</span> subType<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
 
<span class="token punctuation">}</span>
</code></pre></div><p>但实际上，使用Object.assign 来进行 copy 仍然不是最好的方法。因为Object.assign 方法只会拷贝源对象自身的并且可枚举的属性到目标对象。而ES6中，类的方法默认都是不可枚举的。此外，如果子类本身已经继承自某个类，以上的继承将不能满足要求。</p> <h2 id="闭包"><a href="#闭包" aria-hidden="true" class="header-anchor">#</a> 闭包</h2> <h3 id="定义-2"><a href="#定义-2" aria-hidden="true" class="header-anchor">#</a> 定义</h3> <p>《JavaScript高级程序设计》中指出 闭包是指有权访问另一个函数作用域中的变量的函数。</p> <p>《JavaScript权威指南》中就讲到：从技术的角度讲，所有的JavaScript函数都是闭包。</p> <p>ECMAScript中，闭包指的是：</p> <ol><li>从理论角度：所有的函数。因为它们都在创建的时候就将上层上下文的数据保存起来了。哪怕是简单的全局变量也是如此，因为函数中访问全局变量就相当于是在访问自由变量，这个时候使用最外层的作用域。</li> <li>从实践角度：以下函数才算是闭包：
<ol><li>即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）</li> <li>在代码中引用了自由变量</li></ol></li></ol> <p>自由变量是指在函数中使用的，但既不是函数参数也不是函数的局部变量的变量。</p> <h3 id="案例说明"><a href="#案例说明" aria-hidden="true" class="header-anchor">#</a> 案例说明</h3> <p>示例1：</p> <div class="language- extra-class"><pre class="language-text"><code>var a = 1;

var foo(){
  console.log(a)
}

foo()// 1
</code></pre></div><p>该示例 a 不是全局作用域下的变量，但是在函数foo作用域里面可以访问，那是不是就满足第一天定义所描述的闭包，那肯定也符合第二条。 但你会有疑问，这和我理解的闭包不一样啊。因为这是从理论上说嘛，那接下来谈谈从实践角度。</p> <p>示例2：</p> <div class="language- extra-class"><pre class="language-text"><code>var scope = 'global scope';
function checkscope(){
  var scope = 'local scope';
  function f(){
    return scope
  }
  return f
}
checkscope()()  //输出什么
</code></pre></div><p>根据执行上下文的知识点，进行分析：</p> <ol><li>执行全局代码，创建全局上下文、全局上下文进入执行栈、全局上下文初始化</li></ol> <div class="language- extra-class"><pre class="language-text"><code>ECStack=[
  globalContext
]
globalContext = {
  AO:{
    scope:undefined,
    checkscope:reference to function checkscope(){},
  },
  [[scope]]:[global],
}
</code></pre></div><ol start="2"><li>创建checkscope函数上下文、checkscope函数上下文初始化</li></ol> <div class="language- extra-class"><pre class="language-text"><code>scopeContext = {
  AO:{
    arguments:{
      length:0
    }
    scope:undefined,
    f:reference to function f(){},
  },
  [[scope]]:[globalContext.AO]
}
</code></pre></div><ol start="3"><li>创建f函数上下文、f函数上下文初始化</li></ol> <div class="language- extra-class"><pre class="language-text"><code>fContext = {
  AO:{
    arguments:{
      length:0
    }
  },
  [[scope]]:[globalContext.AO,scopeContext.AO]
}
</code></pre></div><p>4.checkscope函数执行，checkscopeContext进入执行栈，修改变量对象的值</p> <p>5.checkscope函数执行结束，退出执行栈</p> <p>6.f函数执行，fContext进入执行栈，修改变量对象的值</p> <p>7.f函数执行结束，fContext退出执行栈</p> <p>当我们了解了具体的执行过程后，我们知道 f 执行上下文维护了一个作用域链：</p> <p>你会发现当checkscopeContext退出的执行栈的时候变量还是能被访问到，这是因为fContext中的作用域链。</p> <div class="language- extra-class"><pre class="language-text"><code>fContext = {
    Scope: [AO, checkscopeContext.AO, globalContext.VO],
}
</code></pre></div><p>对的，就是因为这个作用域链，f 函数依然可以读取到 checkscopeContext. AO 的值，说明当 f 函数引用了 checkscopeContext. AO 中的值的时候，即使 checkscopeContext 被销毁了，但是 JavaScript 依然会让 checkscopeContext. AO 活在内存中，f 函数依然可以通过 f 函数的作用域链找到它，正是因为 JavaScript 做到了这一点，从而实现了闭包这个概念。</p> <p>这不是就符合了上述的第三条定义。</p> <h3 id="经典面试题"><a href="#经典面试题" aria-hidden="true" class="header-anchor">#</a> 经典面试题</h3> <div class="language- extra-class"><pre class="language-text"><code>var result = [];
for (var i=0; i &lt; 3; i++){
  result[i] = function(){
    console.log(i)
  };
}
result[0]() 
result[1]() 
result[2]() 
// 上述3次输出分别为什么
</code></pre></div><p>输出结果都为3，但是想输出0，1，2改如何改呢。</p> <p>该面试题想必很多同学遇到过，也知道怎么解。最简单的就是将var 改为let；还有一种解法就是构建一个闭包。但是为什么呢，底层原理又是什么呢想必有不多同学不知道吧。</p> <p>这问题本质还是与执行上下文有关系。</p> <p>当执行result[0]之前，全局上下文</p> <div class="language- extra-class"><pre class="language-text"><code>glbalContext:{
  AO:{
    result:[...],
    i:3
  }
}
</code></pre></div><p>当执行 result[0] 函数的时候，result[0] 函数的上下文为：</p> <div class="language- extra-class"><pre class="language-text"><code>result[0]Context = {
  AO:{
    arguments:{
      length:0
    }
  }
  [[scope]]: [AO, globalContext.VO]
}
</code></pre></div><p>result[0]Context 的 AO 并没有 i 值，所以会从 globalContext. VO 中查找，i 为 3，所以打印的结果就是3</p> <p>result[1] 和 result[2]都是一样的原理</p> <h4 id="闭包解法"><a href="#闭包解法" aria-hidden="true" class="header-anchor">#</a> 闭包解法</h4> <p>但是使用闭包为什么有可以了呢, 我们先改成闭包的写法</p> <div class="language- extra-class"><pre class="language-text"><code>var result = [];
for (var i=0; i &lt; 3; i++){
  result[i] = function(i){
    return function()
    console.log(i)
  }(i)
}
result[0]() 
result[1]() 
result[2]() 
</code></pre></div><p>当执行result[0]之前，全局上下文没有变还是</p> <div class="language- extra-class"><pre class="language-text"><code>glbalContext:{
  AO:{
    result:[...],
    i:3
  }
}
</code></pre></div><p>但是当result[0]执行时，result[0] 函数的上下文变为：</p> <div class="language- extra-class"><pre class="language-text"><code>result[0]Context = {
  AO:{
    arguments:{
      length:0
    }
  }
  [[scope]]: [globalContext.VO,匿名函数Context.AO,AO]
}
</code></pre></div><p>那多当 result[0]Context 的 AO 并没有 i 值，所以会先从 匿名函数Context. AO中查找，再去 globalContext. VO 中查找。</p> <p>此时的匿名函数Context为:</p> <div class="language- extra-class"><pre class="language-text"><code>匿名函数Context={
  AO:{
    arguments:{
      0:0,
      lenght:1
    },
    i:0
  }
}
</code></pre></div><p>所以输出结果为0. result[1] 和 result[2] 同理</p> <h4 id="内存泄露"><a href="#内存泄露" aria-hidden="true" class="header-anchor">#</a> 内存泄露</h4> <p>闭包会引起内存泄露，这时就需要垃圾回收机制。JS的垃圾回收的方法主要有2种。标记清除法和引用计数 具体见<a href="/browser.html#垃圾回收机制">垃圾回收机制</a>文章</p> <h2 id="浮点数精度"><a href="#浮点数精度" aria-hidden="true" class="header-anchor">#</a> 浮点数精度</h2> <p>经典的 <code>0.1 + 0.2 !== 0.3</code> 想必许多同学都知道，也都知道这是由于浮点数精度问题导致。其主要原因在于采用的是 IEEE 754标准。这不是JavaSript的特例。</p> <h3 id="ieee-754标准"><a href="#ieee-754标准" aria-hidden="true" class="header-anchor">#</a> IEEE 754标准</h3> <p>ECMAScript 中的 Number 类型使用 IEEE754 标准来表示整数和浮点数值。所谓 IEEE754 标准，全称 IEEE 二进制浮点数算术标准，这个标准定义了表示浮点数的格式等内容。</p> <p>IEEE 754标准中，浮点格式主要分为四种类型，即单精度格式、双精度格式、扩展单精度格式和扩展双精度格式。它们的构成都由以下三部分组成：</p> <ul><li>符号位，控制数值的正负 Sign  （S） 0 为正 1为负</li> <li>指数位，控制数值的大小 Exponent （E）</li> <li>尾数位，控制数值的精度 Mantissa   （M）</li></ul> <p>ECMAScript 中 采用的是双精度(64位)格式。构成如图所示：</p> <p><img src="/assets/img/IEEE.3befff3f.png" alt="An image"></p> <p>求值方法:(-1)^S*(1. M)*2^(E-1023)</p> <p>双精度的指数部分（E）采用的偏置码为1023</p> <h3 id="浮点数转二进制"><a href="#浮点数转二进制" aria-hidden="true" class="header-anchor">#</a> 浮点数转二进制</h3> <p>我们所常用的是十进制数字，但是计算机所存储的是二进制。这就涉及到了进制转换。</p> <p>以十进制浮点数转换二进制为例。(其它进制转换自行查阅)</p> <p>整数部分：除以2，取出余数，商继续除以2，直到得到0为止，将取出的余数逆序</p> <p>小数部分：乘以2，然后取出整数部分，将剩下的小数部分继续乘以2，然后再取整数部分，一直取到小数部分为零为止。如果永远不为零，则按要求保留足够位数的小数，最后一位做0舍1入。将取出的整数顺序排列。</p> <p>十进制22.8125转二进制的具体计算过程：</p> <p>整数部分：除以2，商继续除以2，得到0为止，将余数逆序排列。</p> <div class="language- extra-class"><pre class="language-text"><code>22 / 2     11 余 0
11/2       5  余 1
5  /2      2  余 1
2  /2      1  余 0
1  /2      0  余 1
</code></pre></div><p>得到22的二进制是10110</p> <p>小数部分：乘以2，取整，小数部分继续乘以2，取整，得到小数部分0为止，将整数顺序排列。</p> <div class="language- extra-class"><pre class="language-text"><code>0.8125x2=1.625  取整1,小数部分是0.625
0.625x2=1.25    取整1,小数部分是0.25
0.25x2=0.5      取整0,小数部分是0.5
0.5x2=1.0       取整1,小数部分是0，
</code></pre></div><p>得到0.8125的二进制是0.1101</p> <p>结果：十进制22.8125等于二进制10110.1101</p> <h3 id="浮点数的计算"><a href="#浮点数的计算" aria-hidden="true" class="header-anchor">#</a> 浮点数的计算</h3> <p>关于浮点数的运算，一般由以下五个步骤完成：对阶、尾数运算、规格化、舍入处理、溢出判断。我们来简单看一下 0.1 和 0.2 的计算。</p> <p>首先是对阶，所谓对阶，就是把阶码调整为相同，比如 0.1 是 1.1001100110011…… * 2^-4，阶码是 -4，而 0.2 就是 1.10011001100110...* 2^-3，阶码是 -3，两个阶码不同，所以先调整为相同的阶码再进行计算，调整原则是小阶对大阶，也就是 0.1 的 -4 调整为 -3，对应变成 0.11001100110011…… * 2^-3</p> <p>接下来是尾数计算:</p> <div class="language- extra-class"><pre class="language-text"><code>  0.1100110011001100110011001100110011001100110011001101

+ 1.1001100110011001100110011001100110011001100110011010

————————————————————————————————————————————————————————
 10.0110011001100110011001100110011001100110011001100111
</code></pre></div><p>我们得到结果为 10.0110011001100110011001100110011001100110011001100111 * 2^-3</p> <p>将这个结果处理一下，即结果规格化，变成 1.0011001100110011001100110011001100110011001100110011(1) * 2^-2</p> <p>括号里的 1 意思是说计算后这个 1 超出了范围，所以要被舍弃了。</p> <p>再然后是舍入，四舍五入对应到二进制中，就是 0 舍 1 入，因为我们要把括号里的 1 丢了，所以这里会进一，结果变成</p> <p>1.0011001100110011001100110011001100110011001100110100 * 2^-2</p> <p>所以最终的结果存成 64 位就是</p> <p>0 01111111101 0011001100110011001100110011001100110011001100110100</p> <p>将它转换为10进制数就得到 0.30000000000000004440892098500626</p> <p>因为两次存储时的精度丢失加上一次运算时的精度丢失，最终导致了 0.1 + 0.2 !== 0.3</p> <h2 id="类数组对象与arguments"><a href="#类数组对象与arguments" aria-hidden="true" class="header-anchor">#</a> 类数组对象与arguments</h2> <h3 id="类数组对象"><a href="#类数组对象" aria-hidden="true" class="header-anchor">#</a> 类数组对象</h3> <p>所谓的类数组对象拥有一个 length 属性和若干索引属性的对象。</p> <p>具有数组length属性，也能使用索引访问，也能遍历。但是不能使用数组的方法。</p> <p>举个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>var array = ['name', 'age', 'sex'];

var arrayLike = {
    0: 'name',
    1: 'age',
    2: 'sex',
    length: 3
}

console.log(array[0]); // name
console.log(arrayLike[0]); // name

array[0] = 'new name';
arrayLike[0] = 'new name';

console.log(array.length); // 3
console.log(arrayLike.length); // 3

console.log(array.length); // 3
console.log(arrayLike.length); // 3

array.push('4'); // ['name', 'age', 'sex','4'];
arrayLike.push('4');arrayLike.push is not a function 

</code></pre></div><p>那类数组对象是否可以使用数组的方法呢？</p> <h4 id="调用数组方法"><a href="#调用数组方法" aria-hidden="true" class="header-anchor">#</a> 调用数组方法</h4> <p>不能直接的调用数组方法，可以使用 Functuon.call 间接调用</p> <div class="language- extra-class"><pre class="language-text"><code>var arrayLike = {
    0: 'name',
    1: 'age',
    2: 'sex',
    length: 3
}

Array.prtototype.push.call(arrayLike,'4')
</code></pre></div><h4 id="类数组转数组方法"><a href="#类数组转数组方法" aria-hidden="true" class="header-anchor">#</a> 类数组转数组方法</h4> <ol><li>Array.prototype.slice()</li> <li>Array.prototype.splice()</li> <li>Array.from()</li> <li>Array.prototype.concat()</li> <li>扩展运算符</li></ol> <div class="language- extra-class"><pre class="language-text"><code>
1. Array.prototype.slice.call(arguments) 或者 [].slice.call(arguments)
2. Array.prototype.splice.call(arrayLike, 0)
3. Array.from() // es6
4. [...arguments] // es6
5. Array.prototype.concat.apply([], arrayLike)  // 这里不使用call 是在于apply 的参数区别

</code></pre></div><p>要说到类数组对象，Arguments 对象就是一个类数组对象。在客户端 JavaScript 中，一些 DOM 方法(document.getElementsByTagName()等)也返回类数组对象。</p> <h3 id="arguments"><a href="#arguments" aria-hidden="true" class="header-anchor">#</a> arguments</h3> <p>Arguments 对象只定义在函数体中，包括了函数的参数和其他属性。在函数体中，arguments 指代该函数的 Arguments 对象。</p> <p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>function foo(name, age, sex) {
    console.log(arguments);
}

foo('name', 'age', 'sex')
</code></pre></div><p>输出如下：</p> <p><img src="/assets/img/arguments.3c9aba84.png" alt="An image"></p> <p>如图可以看出</p> <ol><li>arguments的长度只与实参的个数有关，与形参定义的个数没有直接关系。</li> <li>arguments 具有 length、callee、Symbol.iterator等属性</li></ol> <h4 id="callee-属性"><a href="#callee-属性" aria-hidden="true" class="header-anchor">#</a> callee 属性</h4> <p>指向当前执行的函数。</p> <p>闭包经典面试题使用 callee 的解决方法：</p> <div class="language- extra-class"><pre class="language-text"><code>var data = []

for(var i=0;i &lt; 10;i++){
  (data[i]=function(){
    return arguments.callee.i
  }).i = i
}

data[0] // 0
data[1] // 1
</code></pre></div><p>arguments还具有caller属性 指向调用当前函数的函数。 但是该属性已经被删选了</p> <h4 id="arguments对象与剩余参数、默认参数和解构赋值参数结合使用"><a href="#arguments对象与剩余参数、默认参数和解构赋值参数结合使用" aria-hidden="true" class="header-anchor">#</a> arguments对象与剩余参数、默认参数和解构赋值参数结合使用</h4> <div class="language- extra-class"><pre class="language-text"><code>function foo(...args) {
  return args;
}
foo(1, 2, 3);  // [1,2,3]
</code></pre></div><p>在严格模式下，剩余参数、默认参数和解构赋值参数的存在不会改变 arguments对象的行为，但是在非严格模式下就有所不同了。</p> <p>当非严格模式中的函数<strong>没有</strong>包含剩余参数、默认参数和解构赋值，那么arguments对象中的值会跟踪参数的值（反之亦然） 看下面的代码：</p> <div class="language- extra-class"><pre class="language-text"><code>function func(a) { 
  arguments[0] = 99;   // 更新了arguments[0] 同样更新了a
  console.log(a);
}
func(10); // 99

function func(a) { 
  a = 99;              // 更新了a 同样更新了arguments[0] 
  console.log(arguments[0]);
}
func(10); // 99
</code></pre></div><p>当非严格模式中的函数<strong>有</strong>包含剩余参数、默认参数和解构赋值，那么arguments对象中的值不会跟踪参数的值（反之亦然）。相反, arguments反映了调用时提供的参数：</p> <div class="language- extra-class"><pre class="language-text"><code>function func(a = 55) { 
  arguments[0] = 99; // updating arguments[0] does not also update a
  console.log(a);
}
func(10); // 10

function func(a = 55) { 
  a = 99; // updating a does not also update arguments[0]
  console.log(arguments[0]);
}
func(10); // 10

function func(a = 55) { 
  console.log(arguments[0]);
}
func(); // undefined
</code></pre></div><h3 id="类数组检测"><a href="#类数组检测" aria-hidden="true" class="header-anchor">#</a> 类数组检测</h3> <div class="language- extra-class"><pre class="language-text"><code>function isArrayLike(o) {
    if (o &amp;&amp;                                // o is not null, undefined, etc.
        typeof o === 'object' &amp;&amp;            // o is an object
        isFinite(o.length) &amp;&amp;               // o.length is a finite number
        o.length &gt;= 0 &amp;&amp;                    // o.length is non-negative
        o.length===Math.floor(o.length) &amp;&amp;  // o.length is an integer
        o.length &lt; 4294967296)              // o.length &lt; 2^32
        return true;                        // Then o is array-like
    else
        return false;                       // Otherwise it is not
}
</code></pre></div><p>代码来自《JavaScript权威指南》</p> <h2 id="js运行机制"><a href="#js运行机制" aria-hidden="true" class="header-anchor">#</a> JS运行机制</h2> <h3 id="js-单线程"><a href="#js-单线程" aria-hidden="true" class="header-anchor">#</a> JS 单线程</h3> <p>JavaScript 语言的一大特点就是单线程，也就是说，同一个时间只能做一件事。作为浏览器脚本语言，JavaScript的主要用途是与用户互动，以及操作DOM。这决定了它只能是单线程，否则会带来很复杂的同步问题。比如，假定JavaScript同时有两个线程，一个线程在某个DOM节点上添加内容，另一个线程删除了这个节点，这时浏览器应该以哪个线程为准？</p> <p>为了利用多核CPU的计算能力，HTML5提出Web Worker标准，允许JavaScript脚本创建多个线程，但是子线程完全受主线程控制，且不得操作DOM。所以，这个新标准并没有改变JavaScript单线程的本质。</p> <h3 id="任务队列"><a href="#任务队列" aria-hidden="true" class="header-anchor">#</a> 任务队列</h3> <p>任务可以分为两种：同步任务（synchronous） 和 异步任务（asynchronous）。</p> <p>同步任务指的是在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务</p> <p>异步任务指的是不进入主线程、而进入任务队列（task queue）的任务。只有&quot;任务队列&quot;通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。</p> <p>异步执行的运行机制如下：</p> <ol><li><p>所有同步任务都在主线程上执行，形成一个执行栈</p></li> <li><p>主线程之外，在存在一个任务队列。只要异步任务有了运行结果，就在任务队列之中放置一个事件</p></li> <li><p>一旦执行栈中的所有同步任务执行完毕，系统就会读取任务队列，那么异步任务就会进入执行栈 执行</p></li> <li><p>主线程不断重复上面的3个步骤</p></li></ol> <p><img src="/assets/img/eventloop.b9e7e75d.jpg" alt=""></p> <p>只要主线程空了，就会去读取&quot;任务队列&quot;，这就是JavaScript的运行机制。这个过程会不断重复。</p> <h3 id="event-loop"><a href="#event-loop" aria-hidden="true" class="header-anchor">#</a> Event Loop</h3> <p>主线程从&quot;任务队列&quot;中读取事件，这个过程是循环不断的，所以整个的这种运行机制又称为Event Loop（事件循环）</p> <p>为了更好地理解Event Loop，请看下图:
<img src="/assets/img/eventloop.b7139bfb.png" alt=""></p> <p>以下几种情况会放入异步任务队列中：</p> <ol><li>setTimeout和setlnterval</li> <li>DOM事件</li> <li>ES6中的Promise</li> <li>Ajax异步请求</li> <li>异步任务</li></ol> <h4 id="定时器注意点"><a href="#定时器注意点" aria-hidden="true" class="header-anchor">#</a> 定时器注意点</h4> <p>定时器功能主要由setTimeout()和setInterval()这两个函数来完成，它们的内部运行机制完全一样，区别在于前者指定的代码是一次性执行，后者则为反复执行。</p> <p>setTimeout()接受两个参数，第一个是回调函数，第二个是推迟执行的毫秒数。</p> <p>当第二个参数缺省时，默认为 0；当指定的值小于 4 毫秒，则增加到 4ms(4ms 是 HTML5 标准指定的，对于 2010 年及之前的浏览器则是 10ms); 也就是说至少需要4毫秒，该setTimeout()拿到任务队列中。</p> <p>需要注意的是，setTimeout()只是将事件插入了&quot;任务队列&quot;，必须等到当前代码（执行栈）执行完，主线程才会去执行它指定的回调函数。要是当前代码耗时很长，有可能要等很久，所以并没有办法保证，回调函数一定会在setTimeout()指定的时间执行。</p> <h3 id="微任务和宏任务"><a href="#微任务和宏任务" aria-hidden="true" class="header-anchor">#</a> 微任务和宏任务</h3> <p>异步任务可以分为微任务（Microtak） 和 宏任务（Macrotask）</p> <p>宏任务包括：</p> <ul><li>script(全局任务)</li> <li>setTimeout/setInterval</li> <li>setImmediate</li> <li>I/O</li> <li>UI rendering</li></ul> <p>微任务包括：</p> <ul><li>new Promise().then(回调)</li> <li>Async/Await</li> <li>process.nextTick</li> <li>MutationObserver(html5新特性)</li></ul> <p>那有个问题哪个先执行呢？</p> <p>如下图所示：</p> <p><img src="/assets/img/eventloop2.3f29ffb1.png" alt=""></p> <p>从图中得出：</p> <ol><li>存在微任务的话，那么就执行所有的微任务</li> <li>微任务都执行完之后，执行第一个宏任务，</li> <li>循环以上的步骤</li></ol> <p>举个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>Promise.resolve().then(()=&gt;{
  console.log('Promise1')  
  setTimeout(()=&gt;{
    console.log('setTimeout2')
  },0)
})
setTimeout(()=&gt;{
  console.log('setTimeout1')
  Promise.resolve().then(()=&gt;{
    console.log('Promise2')    
  })
},0)
</code></pre></div><p>最后输出结果是Promise1，setTimeout1，Promise2，setTimeout2</p> <h3 id="node-js的event-loop"><a href="#node-js的event-loop" aria-hidden="true" class="header-anchor">#</a> Node.js的Event Loop</h3> <p>Node.js也是单线程的Event Loop，但是它的运行机制不同于浏览器环境。node中事件循环的实现是依靠的libuv引擎。</p> <p>我们知道node选择chrome v8引擎作为js解释器，v8引擎将js代码分析后去调用对应的node api，而这些api最后则由libuv引擎驱动，执行对应的任务，并把不同的事件放在不同的队列中等待主线程执行。 因此实际上node中的事件循环存在于libuv引擎中。</p> <p>下面是一个libuv引擎中的事件循环的模型:</p> <div class="language- extra-class"><pre class="language-text"><code>   ┌───────────────────────┐
┌─&gt;│        timers         │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     I/O callbacks     │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     idle, prepare     │
│  └──────────┬────────────┘      ┌───────────────┐
│  ┌──────────┴────────────┐      │   incoming:   │
│  │         poll          │&lt;──connections───     │
│  └──────────┬────────────┘      │   data, etc.  │
│  ┌──────────┴────────────┐      └───────────────┘
│  │        check          │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
└──┤    close callbacks    │
   └───────────────────────┘
</code></pre></div><p>注：模型中的每一个方块代表事件循环的一个阶段</p> <p>从上面这个模型中，我们可以大致分析出node中的事件循环的顺序:</p> <ol><li>外部输入数据</li> <li>轮询阶段(poll)</li> <li>检查阶段(check)</li> <li>关闭事件回调阶段（close callback）</li> <li>定时器检测阶段(timer)</li> <li>I/O事件回调阶段(I/O callbacks)</li> <li>闲置阶段(idle,prepare)</li> <li>轮询阶段
....</li></ol> <p>这些阶段大致的功能如下：</p> <p>timers: 这个阶段执行定时器队列中的回调如 setTimeout() 和 setInterval()。</p> <p>I/O callbacks: 这个阶段执行几乎所有的回调。但是不包括close事件，定时器和setImmediate()的回调。</p> <p>idle, prepare: 这个阶段仅在内部使用，可以不必理会。</p> <p>poll: 等待新的I/O事件，node在一些特殊情况下会阻塞在这里。</p> <p>check: setImmediate()的回调会在这个阶段执行。</p> <p>close callbacks: 例如socket.on('close', ...)这种close事件的回调。</p> <h4 id="process-nexttick"><a href="#process-nexttick" aria-hidden="true" class="header-anchor">#</a> process.nextTick()</h4> <p>node中存在着一个特殊的队列，既nextTick queue。这个队列中的回调执行虽然没有被表示为一个阶段，但是这个些事件却会在每一个阶段执行完毕准备进入下一个阶段时优先执行。</p> <p>与执行poll queue中的任务不同的是，这个操作在队列清空前是不会停止的。这也就意味着，错误的使用process.nextTick()方法会导致node进入一个死循环。。直到内存泄漏。</p> <h4 id="setimmediate"><a href="#setimmediate" aria-hidden="true" class="header-anchor">#</a> setImmediate()</h4> <p>setImmediate() 方法从意义上讲是立刻执行的意思，但是实际上它却是在一个固定的阶段才会执行回调，既poll阶段之后。</p> <p>setImmediate()和setTimeout()相似，但是根据调用时间的不同，行为也不同</p> <p>setImmediate()设计用于在当前轮询阶段完成后执行脚本。
setTimeout() 计划在最小阈值（毫秒）过去后运行脚本。</p> <p>计时器的执行顺序将根据调用它们的上下文而有所不同。如果两者都是从主模块中调用的，则时序将受到进程性能的限制（这可能会受到计算机上运行的其他应用程序的影响）。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// timeout_vs_immediate.js</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 输出</span>
node timeout_vs_immediate<span class="token punctuation">.</span>js

timeout
immediate

node timeout_vs_immediate<span class="token punctuation">.</span>js

immediate
timeout
</code></pre></div><p>但是，如果在一个I / O周期内移动两个调用，则始终首先执行setImmediate()</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// timeout_vs_immediate.js</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>__filename<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'timeout'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setImmediate</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'immediate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

$ node timeout_vs_immediate<span class="token punctuation">.</span>js
immediate
timeout

$ node timeout_vs_immediate<span class="token punctuation">.</span>js
immediate
timeout
</code></pre></div><h3 id="知识点实践运用解题"><a href="#知识点实践运用解题" aria-hidden="true" class="header-anchor">#</a> 知识点实践运用解题</h3> <ol><li>如果我们在浏览器控制台中运行下列的'foo'函数，是否会导致堆栈溢出错误？</li></ol> <div class="language- extra-class"><pre class="language-text"><code>function foo() {
  setTimeout(foo, 0); // 是否存在堆栈溢出错误?
}; 
</code></pre></div><p>答案是不会那是为什么呢</p> <p>因为setTimeout 是个异步流 宏任务。</p> <p>JS调用栈是后进先出(LIFO)的。引擎每次从堆栈中取出一个函数，然后从上到下依次运行代码。每当它遇到一些异步代码，如setTimeout，它就把它交给Web API。因此，每当事件被触发时，callback 都会被发送到任务队列</p> <p>事件循环(Event loop)不断地监视任务队列(Task Queue)，并按它们排队的顺序一次处理一个回调。每当调用堆栈(call stack)为空时，Event loop获取回调并将其放入堆栈(stack )中进行处理。请记住，如果调用堆栈不是空的，则事件循环不会将任何回调推入堆栈。</p> <p>运行过程如下图：
<img src="/assets/img/runtime.441515f6.gif" alt=""></p> <ol start="2"><li>如果在控制台中运行以下函数，当前页面(选项卡)的 UI 是否仍然响应</li></ol> <div class="language- extra-class"><pre class="language-text"><code>function foo() {
  return Promise.resolve().then(foo);
};  
</code></pre></div><p>答案是不响应</p> <p>setTimeout回调是宏任务，而Promise回调是微任务。</p> <p>宏任务在单个循环周期中一次一个地推入堆栈，但是微任务队列总是在执行后返回到事件循环之前清空。因此，如果你以处理条目的速度向这个队列添加条目，那么你就永远在处理微任务。只有当微任务队列为空时，事件循环才会重新渲染页面、</p> <h2 id="object-常用方法"><a href="#object-常用方法" aria-hidden="true" class="header-anchor">#</a> Object 常用方法</h2> <h3 id="object-assgin"><a href="#object-assgin" aria-hidden="true" class="header-anchor">#</a> Object.assgin()</h3> <p>用于将所有<strong>可枚举</strong>属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。Object.assign()拷贝的是属性值。假如源对象的属性值是一个对象的引用，那么它也只指向那个引用。</p> <div class="language- extra-class"><pre class="language-text"><code>const o1 = { a: 1 };
const o2 = { b: 2 };
const o3 = { c: 3 };

const obj = Object.assign(o1, o2, o3);
console.log(obj); // { a: 1, b: 2, c: 3 }
console.log(o1);  // { a: 1, b: 2, c: 3 }, 注意目标对象自身也会改变。
</code></pre></div><h3 id="object-create"><a href="#object-create" aria-hidden="true" class="header-anchor">#</a> Object.create()</h3> <p>Object.create()方法创建一个新对象，使用现有的对象来提供新创建的对象的__proto__。</p> <p>语法： <code>Object.create(proto[, propertiesObject])</code></p> <p>参数</p> <ul><li>proto 新创建对象的原型对象。</li> <li>propertiesObject 可选。如果没有指定为 undefined，则是要添加到新创建对象的不可枚举（默认）属性对象的属性描述符以及相应的属性名称。这些属性对应Object.defineProperties()的第二个参数。</li></ul> <p>返回值  一个新对象，带着指定的原型对象和属性。</p> <h3 id="object-defineproperty"><a href="#object-defineproperty" aria-hidden="true" class="header-anchor">#</a> Object.defineProperty()</h3> <p>Object.defineProperty() 方法会直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象。</p> <p>语法：<code>Object.defineProperty(obj, prop, descriptor)</code></p> <p>obj 要定义属性的对象。
prop 要定义或修改的属性的名称或 Symbol 。
descriptor 要定义或修改的属性描述符。</p> <div class="language- extra-class"><pre class="language-text"><code>const object1 = {};

Object.defineProperty(object1, 'property1', {
  value: 42,
  writable: false
});

object1.property1 = 77;
// throws an error in strict mode

console.log(object1.property1);
// expected output: 42
</code></pre></div><p>该方法允许精确地添加或修改对象的属性。通过赋值操作添加的普通属性是可枚举的，在枚举对象属性时会被枚举到（for...in 或 Object.keys 方法），可以改变这些属性的值，也可以删除这些属性。这个方法允许修改默认的额外选项（或配置）。默认情况下，使用 Object.defineProperty() 添加的属性值是不可修改（immutable）的。</p> <h3 id="object-defineproperties"><a href="#object-defineproperties" aria-hidden="true" class="header-anchor">#</a> Object.defineProperties()</h3> <p>Object.defineProperties() 方法直接在一个对象上定义新的属性或修改现有属性，并返回该对象。</p> <p>语法： <code>Object.defineProperties(obj, props)</code></p> <p>参数:</p> <ul><li>obj 在其上定义或修改属性的对象。</li> <li>props 要定义其可枚举属性或修改的属性描述符的对象。</li></ul> <p>对象中存在的属性描述符主要有两种：数据描述符和访问器描述符。</p> <p>描述符具有以下键：</p> <p>configurable</p> <p>true 当且仅当该属性描述符的类型可以被改变并且该属性可以从对应对象中删除。默认为 false</p> <p>enumerable</p> <p>true 当且仅当在枚举相应对象上的属性时该属性显现。默认为 false</p> <p>value</p> <p>与属性关联的值。可以是任何有效的JavaScript值（数字，对象，函数等）。默认为 undefined.</p> <p>writable</p> <p>true当且仅当与该属性相关联的值可以用assignment operator改变时。默认为 false</p> <p>get</p> <p>作为该属性的 getter 函数，如果没有 getter 则为undefined。函数返回值将被用作属性的值。默认为 undefined</p> <p>set</p> <p>作为属性的 setter 函数，如果没有 setter 则为undefined。函数将仅接受参数赋值给该属性的新值。默认为 undefined</p> <div class="language- extra-class"><pre class="language-text"><code>var obj = {};
Object.defineProperties(obj, {
  'property1': {
    value: true,
    writable: true
  },
  'property2': {
    value: 'Hello',
    writable: false
  }
  // etc. etc.
});
</code></pre></div><p>Object.defineProperty() 与 Object.defineProperties()的区别在于一次只能定义一个属性</p> <h3 id="object-getownpropertydesriptor"><a href="#object-getownpropertydesriptor" aria-hidden="true" class="header-anchor">#</a> Object.getOwnPropertyDesriptor()</h3> <p>Object.getOwnPropertyDescriptor() 方法返回指定对象上一个自有属性对应的属性描述符。（自有属性指的是直接赋予该对象的属性，不需要从原型链上进行查找的属性）</p> <p>语法 <code>Object.getOwnPropertyDescriptor(obj, prop)</code></p> <p>参数 obj 需要查找的目标对象 prop目标对象内属性名称</p> <p>返回值 如果指定的属性存在于对象上，则返回其属性描述符对象（property descriptor），否则返回 undefined。</p> <div class="language- extra-class"><pre class="language-text"><code>var o, d;

o = { get foo() { return 17; } };
d = Object.getOwnPropertyDescriptor(o, &quot;foo&quot;);
// d {
//   configurable: true,
//   enumerable: true,
//   get: /*the getter function*/,
//   set: undefined
// }

o = { bar: 42 };
d = Object.getOwnPropertyDescriptor(o, &quot;bar&quot;);
// d {
//   configurable: true,
//   enumerable: true,
//   value: 42,
//   writable: true
// }
</code></pre></div><h3 id="object-getownpropertydesriptors"><a href="#object-getownpropertydesriptors" aria-hidden="true" class="header-anchor">#</a> Object.getOwnPropertyDesriptors()</h3> <p>Object.getOwnPropertyDescriptors() 方法用来获取一个对象的所有自身属性的描述符。</p> <p>语法： <code>Object.getOwnPropertyDescriptors(obj)</code></p> <p>参数 obj 任意对象</p> <p>返回值 所指定对象的所有自身属性的描述符，如果没有任何自身属性，则返回空对象。</p> <h3 id="object-getownpropertynames"><a href="#object-getownpropertynames" aria-hidden="true" class="header-anchor">#</a> Object.getOwnPropertyNames()</h3> <p>Object.getOwnPropertyNames()方法返回一个由指定对象的所有自身属性的属性名（包括不可枚举属性但不包括Symbol值作为名称的属性）组成的数组。</p> <div class="language- extra-class"><pre class="language-text"><code>// 类数组对象
var obj = { 0: &quot;a&quot;, 1: &quot;b&quot;, 2: &quot;c&quot;};
console.log(Object.getOwnPropertyNames(obj)); // [&quot;0&quot;, &quot;1&quot;, &quot;2&quot;]
</code></pre></div><h3 id="object-getpropertyof"><a href="#object-getpropertyof" aria-hidden="true" class="header-anchor">#</a> Object.getPropertyOf()</h3> <p>Object.getPrototypeOf() 方法返回指定对象的原型（内部[[Prototype]]属性的值）</p> <p>语法: <code>Object.getPrototypeOf(obj)</code></p> <p>参数 obj 要返回其原型的对象。</p> <p>返回值 给定对象的原型。如果没有继承属性，则返回 null 。</p> <div class="language- extra-class"><pre class="language-text"><code>var proto = {};
var obj = Object.create(proto);
Object.getPrototypeOf(obj) === proto; // true

Object.getPrototypeOf( Object ) === Function.prototype;        // true
</code></pre></div><h3 id="object-prototype-hasownproperty"><a href="#object-prototype-hasownproperty" aria-hidden="true" class="header-anchor">#</a> Object.prototype.hasOwnProperty()</h3> <p>hasOwnProperty() 方法会返回一个布尔值，指示对象<strong>自身属性</strong>中是否具有指定的属性（也就是，是否有指定的键）。</p> <div class="language- extra-class"><pre class="language-text"><code>const object1 = new Object();
object1.property1 = 42;

console.log(object1.hasOwnProperty('property1'));
// expected output: true
</code></pre></div><h3 id="object-setprototypeof"><a href="#object-setprototypeof" aria-hidden="true" class="header-anchor">#</a> Object.setPrototypeOf()</h3> <p>Object.setPrototypeOf() 方法设置一个指定的对象的原型 ( 即, 内部[[Prototype]]属性）到另一个对象或  null。</p> <p>语法： <code>Object.setPrototypeOf(obj, prototype)</code></p> <p>参数 obj 要设置其原型的对象。prototype 该对象的新原型(一个对象 或 null).</p> <p>Object.setPrototypeOf()是ECMAScript 6最新草案中的方法，相对于 <code>Object.prototype.__proto__</code>，它被认为是修改对象原型更合适的方法</p> <h3 id="object-prototype-isprototypeof"><a href="#object-prototype-isprototypeof" aria-hidden="true" class="header-anchor">#</a> Object.prototype.isPrototypeOf()</h3> <p>isPrototypeOf() 方法用于测试一个对象是否存在于另一个对象的原型链上。</p> <p>语法： <code>prototypeObj.isPrototypeOf(object)</code></p> <p>参数：object 在该对象的原型链上搜寻</p> <p>返回值 Boolean，表示调用对象是否在另一个对象的原型链上。</p> <p>如果 prototypeObj 为 undefined 或 null，会抛出 TypeError。</p> <h2 id="array的常用方法"><a href="#array的常用方法" aria-hidden="true" class="header-anchor">#</a> Array的常用方法</h2> <h3 id="array-from"><a href="#array-from" aria-hidden="true" class="header-anchor">#</a> Array.from()</h3> <p>从一个类数组或者可迭代对象创建一个新的、浅拷贝的数组实例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 从 String 生成数组</span>
Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">&quot;f&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;o&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;o&quot;</span><span class="token punctuation">]</span>

<span class="token comment">//从 Set 生成数组</span>
<span class="token keyword">const</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">,</span> <span class="token string">'bar'</span><span class="token punctuation">,</span> <span class="token string">'baz'</span><span class="token punctuation">,</span> <span class="token string">'foo'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//从 Map 生成数组</span>
<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token comment">//从类数组对象（arguments）生成数组</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [ 1, 2, 3 ]</span>
</code></pre></div><h3 id="array-prototype-entries"><a href="#array-prototype-entries" aria-hidden="true" class="header-anchor">#</a> Array.prototype.entries()</h3> <p>entries() 方法返回一个新的Array Iterator对象，该对象包含数组中每个索引的键/值对。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;c&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> iterator <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>iterator<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*Array Iterator {}
         __proto__:Array Iterator
         next:ƒ next()
         Symbol(Symbol.toStringTag):&quot;Array Iterator&quot;
         __proto__:Object
*/</span>
</code></pre></div><h3 id="array-prototype-filter"><a href="#array-prototype-filter" aria-hidden="true" class="header-anchor">#</a> Array.prototype.filter()</h3> <p>创建一个新数组, 其包含通过所提供函数实现的测试的所有元素。</p> <p><code>var newArray = arr.filter(callback(element[, index[, array]])[, thisArg])</code></p> <p>callback 被调用时传入三个参数：元素的值、元素的索引、被遍历的数组本身</p> <p>filter 不会改变原数组，它返回过滤后的新数组。</p> <p>filter 遍历的元素范围在第一次调用 callback 之前就已经确定了。在调用 filter 之后被添加到数组中的元素不会被 filter 遍历到。如果已经存在的元素被改变了，则他们传入 callback 的值是 filter 遍历到它们那一刻的值。被删除或从来未被赋值的元素不会被遍历到。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">isBigEnough</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> element <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> filtered <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>isBigEnough<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// filtered is [12, 130, 44] </span>
</code></pre></div><h3 id="array-prototype-reduce"><a href="#array-prototype-reduce" aria-hidden="true" class="header-anchor">#</a> Array.prototype.reduce()</h3> <p>reduce() 方法对数组中的每个元素执行一个由您提供的reducer函数(升序执行)，将其结果汇总为单个返回值。</p> <p><code>arr.reduce(callback(accumulator, currentValue[, index[, array]])[, initialValue])</code></p> <p>参数
callback
执行数组中每个值 (如果没有提供 initialValue则第一个值除外)的函数，包含四个参数：</p> <ol><li><p>accumulator 累计器累计回调的返回值; 它是上一次调用回调时返回的累积值，或initialValue（见于下方）。</p></li> <li><p>currentValue 数组中正在处理的元素。 index 可选 数组中正在处理的当前元素的索引。 如果提供了initialValue，则起始索引号为0，否则从索引1起始。</p></li> <li><p>array可选 调用reduce()的数组</p></li> <li><p>initialValue可选</p></li></ol> <p>作为第一次调用 callback函数时的第一个参数的值。 如果没有提供初始值，则将使用数组中的第一个元素。 在没有初始值的空数组上调用 reduce 将报错。</p> <h3 id="array-prototype-flat"><a href="#array-prototype-flat" aria-hidden="true" class="header-anchor">#</a> Array.prototype.flat()</h3> <p>flat() 方法会按照一个可指定的深度递归遍历数组，并将所有元素与遍历到的子数组中的元素合并为一个新数组返回。简单来说就是数组扁平化</p> <p><code>var newArray = arr.flat([depth])</code></p> <p>depth 可选 指定要提取嵌套数组的结构深度，默认值为 1。</p> <div class="language- extra-class"><pre class="language-text"><code>var arr1 = [1, 2, [3, 4]];
arr1.flat(); 
// [1, 2, 3, 4]

var arr2 = [1, 2, [3, 4, [5, 6]]];
arr2.flat();
// [1, 2, 3, 4, [5, 6]]

//使用 Infinity，可展开任意深度的嵌套数组
var arr4 = [1, 2, [3, 4, [5, 6, [7, 8, [9, 10]]]]];
arr4.flat(Infinity);
// [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
</code></pre></div><p>flat() 方法会移除数组中的空项:</p> <p><strong>扁平化数组的替代实现</strong></p> <ol><li>reduce 和 concat</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment">// 展开一层</span>
arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">acc<span class="token punctuation">,</span> val</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// 多层次的话 递归</span>
<span class="token keyword">function</span> <span class="token function">flatDeep</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> deep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> d <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> arr<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">arr<span class="token punctuation">,</span> v</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> acc<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isAarray</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">flatDepp</span><span class="token punctuation">(</span>v<span class="token punctuation">,</span> deep <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> val<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="array-prototype-sort"><a href="#array-prototype-sort" aria-hidden="true" class="header-anchor">#</a> Array.prototype.sort()</h3> <p>sort() 方法用原地算法对数组的元素进行排序，并返回数组。默认排序顺序是在将元素转换为字符串，然后比较它们的UTF-16代码单元值序列时构建的
<code>arr.sort([compareFunction])</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> months <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'March'</span><span class="token punctuation">,</span> <span class="token string">'Jan'</span><span class="token punctuation">,</span> <span class="token string">'Feb'</span><span class="token punctuation">,</span> <span class="token string">'Dec'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
months<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>months<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: Array [&quot;Dec&quot;, &quot;Feb&quot;, &quot;Jan&quot;, &quot;March&quot;]</span>

<span class="token keyword">const</span> array1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">100000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
array1<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: Array [1, 100000, 21, 30, 4]</span>
</code></pre></div><p>如果没有指明 compareFunction ，那么元素会按照转换为的字符串的诸个字符的Unicode位点进行排序。例如 &quot;Banana&quot; 会被排列到 &quot;cherry&quot; 之前。当数字按由小到大排序时，9 出现在 80 之前，但因为（没有指明 compareFunction），比较的数字会先被转换为字符串，所以在Unicode顺序上 &quot;80&quot; 要比 &quot;9&quot; 要靠前。</p> <p>如果指明了 compareFunction ，那么数组会按照调用该函数的返回值排序。即 a 和 b 是两个将要被比较的元素：</p> <ul><li>如果 compareFunction(a, b) 小于 0 ，那么 a 会被排列到 b 之前；</li> <li>如果 compareFunction(a, b) 等于 0 ， a 和 b 的相对位置不变。备注： ECMAScript 标准并不保证这一行为，而且也不是所有浏览器都会遵守（例如 Mozilla 在 2003 年之前的版本）；</li> <li>如果 compareFunction(a, b) 大于 0 ， b 会被排列到 a 之前。</li></ul> <p>compareFunction(a, b) 必须总是对相同的输入返回相同的比较结果，否则排序的结果将是不确定的。</p> <h3 id="array-prototype-splice"><a href="#array-prototype-splice" aria-hidden="true" class="header-anchor">#</a> Array.prototype.splice()</h3> <p>splice() 方法通过删除或替换现有元素或者原地添加新的元素来修改数组, 并以数组形式返回被修改的内容。此方法会改变原数组。</p> <p><code>array.splice(start[, deleteCount[, item1[, item2[, ...]]]])</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>从第 <span class="token number">3</span> 位开始删除 <span class="token number">1</span> 个元素
<span class="token keyword">var</span> myFish <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'angel'</span><span class="token punctuation">,</span> <span class="token string">'clown'</span><span class="token punctuation">,</span> <span class="token string">'drum'</span><span class="token punctuation">,</span> <span class="token string">'mandarin'</span><span class="token punctuation">,</span> <span class="token string">'sturgeon'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> removed <span class="token operator">=</span> myFish<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 运算后的 myFish: [&quot;angel&quot;, &quot;clown&quot;, &quot;drum&quot;, &quot;sturgeon&quot;]</span>
<span class="token comment">// 被删除的元素: [&quot;mandarin&quot;]</span>

从第 <span class="token number">2</span> 位开始删除 <span class="token number">1</span> 个元素， 插入“ trumpet”
<span class="token keyword">var</span> myFish <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'angel'</span><span class="token punctuation">,</span> <span class="token string">'clown'</span><span class="token punctuation">,</span> <span class="token string">'drum'</span><span class="token punctuation">,</span> <span class="token string">'sturgeon'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> removed <span class="token operator">=</span> myFish<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;trumpet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 运算后的 myFish: [&quot;angel&quot;, &quot;clown&quot;, &quot;trumpet&quot;, &quot;sturgeon&quot;]</span>
<span class="token comment">// 被删除的元素: [&quot;drum&quot;]</span>
</code></pre></div><h3 id="array-prototype-slice"><a href="#array-prototype-slice" aria-hidden="true" class="header-anchor">#</a> Array.prototype.slice()</h3> <p>slice() 方法返回一个新的数组对象，这一对象是一个由 begin 和 end 决定的原数组的浅拷贝（包括 begin，不包括end）。原始数组不会被改变。</p> <p><code>arr.slice([begin[, end]])</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> animals <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ant'</span><span class="token punctuation">,</span> <span class="token string">'bison'</span><span class="token punctuation">,</span> <span class="token string">'camel'</span><span class="token punctuation">,</span> <span class="token string">'duck'</span><span class="token punctuation">,</span> <span class="token string">'elephant'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>animals<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: Array [&quot;camel&quot;, &quot;duck&quot;, &quot;elephant&quot;]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>animals<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: Array [&quot;camel&quot;, &quot;duck&quot;]</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>animals<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// expected output: Array [&quot;bison&quot;, &quot;camel&quot;, &quot;duck&quot;, &quot;elephant&quot;]</span>
</code></pre></div><h3 id="array-prototype-includes"><a href="#array-prototype-includes" aria-hidden="true" class="header-anchor">#</a> Array.prototype.includes()</h3> <p>includes() 方法用来判断一个数组是否包含一个指定的值，根据情况，如果包含则返回 true，否则返回false。</p> <p>语法: <code>arr.includes(valueToFind[, fromIndex])</code></p> <p>valueToFind 需要查找的元素值。</p> <p>fromIndex 可选 从fromIndex 索引处开始查找 valueToFind。如果为负值，则按升序从 array.length + fromIndex 的索引开始搜 （即使从末尾开始往前跳 fromIndex 的绝对值个索引，然后往后搜寻）。默认为 0。</p> <p>注意 使用 includes()比较字符串和字符时是区分大小写。</p> <p>includes 和 indexOf 的区别</p> <p>例子：</p> <div class="language-javasscript extra-class"><pre class="language-text"><code>[1, 2, NaN].includes(NaN); // true
[1, 2, NaN].indexOf(NaN)  // -1
</code></pre></div><h2 id="string的常用方法"><a href="#string的常用方法" aria-hidden="true" class="header-anchor">#</a> String的常用方法</h2> <h3 id="string-prototype-match"><a href="#string-prototype-match" aria-hidden="true" class="header-anchor">#</a> String.prototype.match()</h3> <p>match() 方法检索返回一个字符串匹配正则表达式的结果。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> paragraph <span class="token operator">=</span> <span class="token string">'The quick brown fox jumps over the lazy dog. It barked.'</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> regex <span class="token operator">=</span> <span class="token regex">/[A-Z]/g</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> found <span class="token operator">=</span> paragraph<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>regex<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>found<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// expected output: Array [&quot;T&quot;, &quot;I&quot;]</span>
</code></pre></div><h3 id="string-prototype-replace"><a href="#string-prototype-replace" aria-hidden="true" class="header-anchor">#</a> String.prototype.replace()</h3> <p>replace() 方法返回一个由替换值（replacement）替换部分或所有的模式（pattern）匹配项后的新字符串。模式可以是一个字符串或者一个正则表达式，替换值可以是一个字符串或者一个每次匹配都要调用的回调函数。如果pattern是字符串，则仅替换第一个匹配项。</p> <p>原字符串不会改变。</p> <p>语法：<code>str.replace(regexp|substr, newSubStr|function)</code></p> <h2 id="dom事件"><a href="#dom事件" aria-hidden="true" class="header-anchor">#</a> DOM事件</h2> <h3 id="事件级别"><a href="#事件级别" aria-hidden="true" class="header-anchor">#</a> 事件级别</h3> <p>事件级别可以分为：DOM0级事件、DOM2级事件、DOM3级事件</p> <h4 id="dom-0级事件"><a href="#dom-0级事件" aria-hidden="true" class="header-anchor">#</a> DOM 0级事件</h4> <p>DOM 0级： 写法：el.οnclick=function(){}</p> <p>当希望为同一个元素/标签绑定多个同类型事件的时候，是不被允许的。DOM0事件绑定，给元素的事件行为绑定方法，这些方法都是在当前元素事件行为的冒泡阶段(或者目标阶段)执行的。</p> <h4 id="dom-2级事件"><a href="#dom-2级事件" aria-hidden="true" class="header-anchor">#</a> DOM 2级事件</h4> <p>DOM 2级 写法：el.addEventListener(event-name, callback, useCapture)</p> <ol><li>event-name: 事件名称，可以是标准的DOM事件</li> <li>callback: 回调函数，当事件触发时，函数会被注入一个参数为当前的事件对象 event</li> <li>useCapture: 默认是false，代表事件句柄在冒泡阶段执行</li></ol> <p>DOM 2级 可以为同一个元素绑定多个事件</p> <h4 id="dom-3级事件"><a href="#dom-3级事件" aria-hidden="true" class="header-anchor">#</a> DOM 3级事件</h4> <p>DOM 3级 写法和DOM2级一致 只是在DOM 2级事件的基础上添加了更多的事件类型</p> <p>列如 load、scroll等</p> <h3 id="事件流"><a href="#事件流" aria-hidden="true" class="header-anchor">#</a> 事件流</h3> <p>事件流描述的是从页面中接收事件的顺序。事件流模型可以分为事件冒泡和事件捕获两种。</p> <ol><li><strong>事件冒泡</strong></li></ol> <p>事件冒泡既事件开始时由最具体的元素接收，然后逐级向上传播到较为不具体的节点。这种事件流的概念由IE提出</p> <ol start="2"><li><strong>事件捕获</strong></li></ol> <p>事件捕获的思想 是不太具体的节点应该更早接收到事件，而最具体的节点应该最后接收到事件。</p> <p>事件流可以分为三个阶段：</p> <ol><li>捕获阶段：事件从window对象自上而下向目标节点传播的阶段；</li> <li>目标阶段：真正的目标节点正在处理事件的阶段；</li> <li>冒泡阶段：事件从目标节点自下而上向window对象传播的阶段</li></ol> <h4 id="事件委托"><a href="#事件委托" aria-hidden="true" class="header-anchor">#</a> 事件委托</h4> <p>由于事件会在冒泡阶段向上传播到父节点，因此可以把子节点的监听函数定义在父节点上，由父节点的监听函数统一处理多个子元素的事件。这种方法叫做事件的代理（delegation）</p> <p>这种做可以达到：</p> <ol><li>减少内存消耗，提高性能(不需要为每一个子元素绑定事件)</li> <li>动态绑定事件</li></ol> <h4 id="event对象使用"><a href="#event对象使用" aria-hidden="true" class="header-anchor">#</a> Event对象使用</h4> <ol><li>阻止默认行为：event. preventDefault()</li></ol> <p>什么是默认事件呢？例如表单一点击提交按钮(submit)跳转页面、a标签默认页面跳转或是锚点定位等</p> <ol start="2"><li>阻止冒泡</li></ol> <p>event.stopPropagation() 方法阻止事件冒泡到父元素，阻止任何父事件处理程序被执行</p> <p>stopImmediatePropagation 既能阻止事件向父元素冒泡，也能阻止元素同事件类型的其它监听器被触发</p> <p>e.cancelBubble=true; IE下阻止冒泡</p> <ol start="3"><li>event.target 和 event.currentTarget</li></ol> <p>event.currentTarget始终是监听事件者，而event.target是事件的真正发出者</p> <p>用例子说明：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;a&quot;</span><span class="token operator">&gt;</span>
    aaaa
  <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;b&quot;</span><span class="token operator">&gt;</span>
      bbbb
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;c&quot;</span><span class="token operator">&gt;</span>
        cccc
      <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;d&quot;</span><span class="token operator">&gt;</span>
          dddd
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
            <span class="token string">&quot;target:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot;;currentTarget:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
            <span class="token string">&quot;target:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot;;currentTarget:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
            <span class="token string">&quot;target:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot;;currentTarget:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
            <span class="token string">&quot;target:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">&quot;;currentTarget:&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">.</span>currentTarget<span class="token punctuation">.</span>id
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

当我们点击最里层的元素d的时候，会依次输出<span class="token punctuation">:</span>
target<span class="token punctuation">:</span>d<span class="token punctuation">;</span>currentTarget<span class="token punctuation">:</span>d
target<span class="token punctuation">:</span>d<span class="token punctuation">;</span>currentTarget<span class="token punctuation">:</span>c
target<span class="token punctuation">:</span>d<span class="token punctuation">;</span>currentTarget<span class="token punctuation">:</span>b
target<span class="token punctuation">:</span>d<span class="token punctuation">;</span>currentTarget<span class="token punctuation">:</span>a

</code></pre></div><h4 id="事件模拟"><a href="#事件模拟" aria-hidden="true" class="header-anchor">#</a> 事件模拟</h4> <p>可以在 document 对象上使用 createEvent()方法创建 event 对象。</p> <p>在创建了 event 对象之后，还需要使用与事件有关的信息对其进行初始化。每种类型的 event 对 象都有一个特殊的方法，为它传入适当的数据就可以初始化该 event 对象。不同类型的这个方法的名 字也不相同，具体要取决于 createEvent()中使用的参数。</p> <p>模拟事件的最后一步就是触发事件。这一步需要使用 dispatchEvent()方法。调用 dispatchEvent()方法时，需要传入一个参数，即表示要触发事件 的 event 对象</p> <p>以下用UIEvent 来举个例子：</p> <div class="language- extra-class"><pre class="language-text"><code>var resizeEvent = window.document.createEvent('UIEvents');
resizeEvent .initUIEvent('resize', true, false, window, 0);
window.dispatchEvent(resizeEvent);
</code></pre></div><h2 id="js-异常类型"><a href="#js-异常类型" aria-hidden="true" class="header-anchor">#</a> JS 异常类型</h2> <p>了解Javascript的具有几种异常类型是非常有必要的，可以方便我们更快的定位和解决问题。</p> <h3 id="error-基本错误类型"><a href="#error-基本错误类型" aria-hidden="true" class="header-anchor">#</a> Error 基本错误类型</h3> <p>Error 是最基本的错误类型，其他的错误类型都是继承自该类型。Error 对象主要有两个重要属性 message 和 name ; 分别表示错误信息和错误名称。</p> <p>程序运行过程中抛出的异常一般都有具体的类型，Error 类型一般都是开发人员自己抛出的异常。</p> <p><img src="/assets/img/error.e2946612.jpg" alt=""></p> <h3 id="syntaxerror-语法错误"><a href="#syntaxerror-语法错误" aria-hidden="true" class="header-anchor">#</a> SyntaxError 语法错误</h3> <p>SyntaxError 语法错误 也称为解析错误。语法错误在任何编程语言中都是最常见的错误类型，表示不符合编程语言的语法规范。</p> <p>Javascript 是一门解释性语言，执行一段代码需要经历<code>词法分析 -&gt; 语法分析 -&gt; 语法树</code>，然后就可以解释执行了</p> <p>词法分析是将字符流（char stream）转换为记号流（token stream），语法分析阶段会将记号流 生成抽象语法树（AST）。</p> <p>在这两个阶段，如果Javascript引擎发现了预期之外或者无法抓换的token，或者token顺序和预期不一致时，就会抛出SyntaxError</p> <p><img src="/assets/img/syntaxError.e2b58049.jpg" alt=""></p> <p>SyntaxError 应该和其他类型的异常区分开，此类异常发生在 JavaScript 解析/编译时，此类异常一旦发生，导致整个js文件都无法执行，而其他异常发生在代码运行时，这一类的错误会导致在错误出现的那一行之后的代码无法执行，但在那一行之前的代码不会受到影响。</p> <h3 id="typeerror-类型错误"><a href="#typeerror-类型错误" aria-hidden="true" class="header-anchor">#</a> TypeError 类型错误</h3> <p>TypeError 类型错误。运行时最常见的异常，表示变量或者参数不是预期类型，比如 new 关键字后面必须为构造函数、括号前必须为函数。</p> <p><img src="/assets/img/typeError.13f07f37.jpg" alt=""></p> <h3 id="referenceerror-引用错误"><a href="#referenceerror-引用错误" aria-hidden="true" class="header-anchor">#</a> ReferenceError 引用错误</h3> <p>ReferenceError 引用错误。</p> <p>引用一个不存在的变量时发生的错误，每当我们创建或定义一个变量时，变量名称都会写入一个变量存储中心里面。这个变量存储中心就像键值存储一样，每当我们引用变量时，它都去存储中找到key并提取返回value，如果找不到时，就会抛出ReferenceError。</p> <p>请注意，如果我们调用的是一个已经存在的变量的一个不存在的属性，则不会抛出 ReferenceError，因为变量本身已经在存储中了，调用它不存在的属性只会是未定义状态，也就是 undefined。</p> <p><img src="/assets/img/referenceError.3a88e0c5.jpg" alt=""></p> <h3 id="rangeerror-边界错误"><a href="#rangeerror-边界错误" aria-hidden="true" class="header-anchor">#</a> RangeError 边界错误</h3> <p>RangeError 边界错误。表示超出有效范围时发生的异常，主要有以下几种情况：</p> <ul><li>数组长度为负数或者超长</li> <li>数字类型的方法参数超出预定义范围</li> <li>函数堆栈调用超过最大值</li></ul> <p><img src="/assets/img/rangeError.de6a4b03.jpg" alt=""></p> <h3 id="urierror-url错误"><a href="#urierror-url错误" aria-hidden="true" class="header-anchor">#</a> URIError URL错误</h3> <p>在调用 URI 相关的方法中 URL 无效时抛出的异常，主要包括 encodeURI、decodeURI()、encodeURIComponent()、decodeURIComponent()、escape()和unescape(）几个函数</p> <p><img src="/assets/img/uriError.cbb7a35f.jpg" alt=""></p> <p>当然你也可以自定义错误类型通过继承Error。</p> <h2 id="js-异常处理"><a href="#js-异常处理" aria-hidden="true" class="header-anchor">#</a> JS 异常处理</h2> <p>异常是不可控的，会影响最终的呈现结果，但是我们有充分的理由去做这样的事情。</p> <ul><li>增强用户体验；</li> <li>方便远程定位问题；</li> <li>未雨绸缪，及早发现问题；</li> <li>方便复现问题，尤其是移动端，机型，系统都是问题；</li> <li>完善的前端方案，前端监控系统；</li></ul> <p>那哪些异常需要处理呢？对于前端来说，我们可做的异常捕获还真不少。总结一下，大概如下：</p> <ul><li>JS 语法错误、代码异常</li> <li>AJAX 请求异常</li> <li>静态资源加载异常</li> <li>Promise 异常</li> <li>Iframe 异常</li> <li>跨域 Script error</li> <li>崩溃和卡顿</li></ul> <p>下面我会针对每种具体情况来说明如何处理这些异常。</p> <h3 id="try-catch"><a href="#try-catch" aria-hidden="true" class="header-anchor">#</a> try catch</h3> <p>try catch最常用的捕获异常的方式，但是它有一个弊端。只能捕获到同步的运行时错误，对语法和异步错误却捕获不到。</p> <ol><li>可以捕获的同步运行时错误</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'ye'</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name1<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 输出</span>
捕获到异常：ReferenceError<span class="token punctuation">:</span>name1 is not defined
</code></pre></div><ol start="2"><li>不能捕获到具体的语法错误,修改上述代码删除一个单引号</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> 'ye
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name1<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
Uncaught SyntaxError<span class="token punctuation">:</span> Invalid or unexpected token
</code></pre></div><p>但是语法错误一般在开发过程中ide 就会有提示</p> <ol start="3"><li>异步错误无法捕获</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">undefined</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出</span>
Uncaught TypeError<span class="token punctuation">:</span> Cannot read property <span class="token string">'map'</span> <span class="token keyword">of</span> <span class="token keyword">undefined</span> at setTimeout 
</code></pre></div><p>并没有捕获到异常，这是需要我们特别注意的点。</p> <h3 id="window-onerror"><a href="#window-onerror" aria-hidden="true" class="header-anchor">#</a> window.onerror</h3> <p>当JavaScript运行时错误（包括语法错误）发生时，window会触发一个ErrorEvent接口的error事件，并执行window.onerror()。</p> <p><code>window.onerror = function(message, source, lineno, colno, error) { ... }</code></p> <p>函数参数：</p> <ul><li>message：错误信息（字符串）。可用于HTML onerror=&quot;&quot;处理程序中的event。</li> <li>source：发生错误的脚本URL（字符串）</li> <li>lineno：发生错误的行号（数字）</li> <li>colno：发生错误的列号（数字）</li> <li>error：Error对象（对象）</li></ul> <p>若该函数返回true，则阻止执行默认事件处理函数。</p> <p>但是onerror 还是不能解决所有的情况，它依然无法捕获到语法错误、静态资源异常、接口异常等。</p> <p>到这里基本就清晰了：在实际的使用过程中，onerror 主要是来捕获预料之外的错误，而 try-catch 则是用来在可预见情况下监控特定的错误，两者结合使用更加高效。</p> <p>那捕获不到静态资源加载异常怎么办？</p> <h3 id="window-addeventlistener"><a href="#window-addeventlistener" aria-hidden="true" class="header-anchor">#</a> window.addEventListener</h3> <p>当一项资源<code>（如&lt;img&gt;或&lt;script&gt;）</code>加载失败，加载资源的元素会触发一个Event接口的error事件，并执行该元素上的onerror()处理函数。这些error事件不会向上冒泡到window，不过（至少在Firefox中）能被单一的window.addEventListener (en-US)捕获。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>./ye.png<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'捕获到异常：'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>输出：
<img src="/assets/img/error.b4de694d.png" alt=""></p> <p>由于网络请求异常不会事件冒泡，因此必须在捕获阶段将其捕捉到才行，但是这种方式虽然可以捕捉到网络请求的异常，但是无法判断 HTTP 的状态是 404 还是其他比如 500 等等，所以还需要配合服务端日志才进行排查分析才可以。</p> <p>注意：</p> <ol><li>不同浏览器下返回的 error 对象可能不同，需要注意兼容处理。</li> <li>需要注意避免 addEventListener 重复监听。</li></ol> <h3 id="promise-catch"><a href="#promise-catch" aria-hidden="true" class="header-anchor">#</a> Promise Catch</h3> <p>在 promise 中使用 catch 可以非常方便的捕获到异步 error ，这个很简单。</p> <p>没有写 catch 的 Promise 中抛出的错误无法被 onerror 或 try-catch 捕获到，所以我们务必要在 Promise 中不要忘记写 catch 处理抛出的异常。</p> <p>解决方案：为了防止有漏掉的 Promise 异常，建议在全局增加一个对 unhandledrejection 的监听，用来全局监听Uncaught Promise Error。使用方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;unhandlerejection&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="react-异常捕获"><a href="#react-异常捕获" aria-hidden="true" class="header-anchor">#</a> React 异常捕获</h3> <p>React 16 提供了一个内置函数 componentDidCatch，使用它可以非常简单的获取到 react 下的错误信息.</p> <p>需要注意的是：error boundaries 并不会捕捉下面这些错误。</p> <ul><li>事件处理器</li> <li>异步代码</li> <li>服务端的渲染代码</li> <li>在 error boundaries 区域内的错误</li></ul> <h3 id="页面崩溃与卡顿"><a href="#页面崩溃与卡顿" aria-hidden="true" class="header-anchor">#</a> 页面崩溃与卡顿</h3> <p>卡顿也就是网页暂时响应比较慢， JS 可能无法及时执行。但崩溃就不一样了，网页都崩溃了，JS 都不运行了，还有什么办法可以监控网页的崩溃，并将网页崩溃上报呢？</p> <ol><li>利用 window 对象的 load 和 beforeunload 事件实现了网页崩溃的监控 推荐文章<a href="http://jasonjl.me/blog/2015/06/21/taking-action-on-browser-crashes/" target="_blank" rel="noopener noreferrer">Logging Information on Browser Crashes<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">,</span> <span class="token string">'pending'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'time_before_crash'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">,</span> <span class="token string">'true'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span>sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'good_exit'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'true'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
        insert crash logging code here
    */</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Hey, welcome back from your crash, looks like you crashed on: '</span> <span class="token operator">+</span> sessionStorage<span class="token punctuation">.</span><span class="token function">getItem</span><span class="token punctuation">(</span><span class="token string">'time_before_crash'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>基于以下原因，我们可以使用 Service Worker 来实现网页崩溃的监控</li></ol> <p>Service Worker 有自己独立的工作线程，与网页区分开，网页崩溃了，Service Worker 一般情况下不会崩溃；Service Worker 生命周期一般要比网页还要长，可以用来监控网页的状态；网页可以通过 navigator.serviceWorker.controller.postMessage API 向掌管自己的 SW 发送消息。</p> <h3 id="script-error"><a href="#script-error" aria-hidden="true" class="header-anchor">#</a> Script error</h3> <p>一般情况，如果出现 Script error 这样的错误，基本上可以确定是出现了跨域问题。这时候，是不会有其他太多辅助信息的，但是解决思路无非如下：</p> <p>跨源资源共享机制( CORS )：我们为 script 标签添加 crossOrigin 属性。</p> <p>特别注意，服务器端需要设置：Access-Control-Allow-Origin</p> <h3 id="错误上报"><a href="#错误上报" aria-hidden="true" class="header-anchor">#</a> 错误上报</h3> <p>通过 Ajax 发送数据 因为 Ajax 请求本身也有可能会发生异常，而且有可能会引发跨域问题，一般情况下更推荐使用动态创建 img 标签的形式进行上报。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">report</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> reportUrl <span class="token operator">=</span> <span class="token string">'http://xxx/report'</span><span class="token punctuation">;</span>
  <span class="token keyword">new</span> <span class="token class-name">Image</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>reportUrl<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?logs=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>收集异常信息量太多，怎么办？实际中，我们不得不考虑这样一种情况：如果你的网站访问量很大，那么一个必然的错误发送的信息就有很多条，这时候，我们需要设置采集率，从而减缓服务器的压力。</p> <p>可以参考使用sentry 来做错误监控系统</p> <h3 id="总结-2"><a href="#总结-2" aria-hidden="true" class="header-anchor">#</a> 总结</h3> <p>如何优雅的处理异常呢？</p> <ol><li>可疑区域增加 Try-Catch</li> <li>全局监控 JS 异常 window.onerror</li> <li>全局监控静态资源异常 window.addEventListener</li> <li>捕获没有 Catch 的 Promise 异常：unhandledrejection</li> <li>React componentDidCatch</li> <li>监控网页崩溃：window 对象的 load 和 beforeunload</li> <li>跨域 crossOrigin 解决</li></ol> <h2 id="正则"><a href="#正则" aria-hidden="true" class="header-anchor">#</a> 正则</h2> <h3 id="常用正则符号"><a href="#常用正则符号" aria-hidden="true" class="header-anchor">#</a> 常用正则符号</h3> <table><thead><tr><th style="text-align:center;">元字符</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">*</td> <td style="text-align:left;">匹配前面的子表达式任意，相当于{0,}</td></tr> <tr><td style="text-align:center;">+</td> <td style="text-align:left;">匹配前面的子表达式大于等于一次，相当于{1,}</td></tr> <tr><td style="text-align:center;">?</td> <td style="text-align:left;">匹配前面的子表达式零次或者一次，相当于{0,1}</td></tr> <tr><td style="text-align:center;">.</td> <td style="text-align:left;">匹配除“\n”和&quot;\r&quot;之外的任何单个字符</td></tr> <tr><td style="text-align:center;">[xyz]</td> <td style="text-align:left;">字符集合。匹配所包含的任意一个字符</td></tr> <tr><td style="text-align:center;">[^xyz]</td> <td style="text-align:left;">负值字符集合。匹配未包含的任意字符</td></tr> <tr><td style="text-align:center;">\d</td> <td style="text-align:left;">匹配一个数字字符，相当于[0-9]</td></tr> <tr><td style="text-align:center;">\D</td> <td style="text-align:left;">匹配一个非数字字符</td></tr> <tr><td style="text-align:center;">\s</td> <td style="text-align:left;">匹配任何不可见字符，包括空格、制表符、换页符等等</td></tr> <tr><td style="text-align:center;">\S</td> <td style="text-align:left;">匹配任何可见字符</td></tr> <tr><td style="text-align:center;">\w</td> <td style="text-align:left;">匹配包括下划线的任何单词字符</td></tr> <tr><td style="text-align:center;">\W</td> <td style="text-align:left;">匹配任何非单词字符。等价于“[^A-Za-z0-9_]”</td></tr></tbody></table> <h4 id="pattern"><a href="#pattern" aria-hidden="true" class="header-anchor">#</a> (?:pattern)</h4> <p>()表示捕获分组，()会把每个分组里的匹配的值保存起来，从左向右，以分组的左括号为标志，第一个出现的分组的组号为1，第二个为2，以此类推</p> <p>(?:)表示非捕获分组，和捕获分组唯一的区别在于，非捕获分组匹配的值不会保存起来</p> <h4 id="pattern-2"><a href="#pattern-2" aria-hidden="true" class="header-anchor">#</a> (?=pattern)</h4> <p>正向肯定预查（look ahead positive assert），匹配pattern前面的位置。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。</p> <p>以 xxx(?=pattern)为例，就是捕获以pattern结尾的内容xxx。</p> <p>例如，&quot;Windows(?=95|98|NT|2000)&quot;能匹配&quot;Windows2000&quot;中的&quot;Windows&quot;，但不能匹配&quot;Windows3.1&quot;中的&quot;Windows&quot;。</p> <h4 id="pattern-3"><a href="#pattern-3" aria-hidden="true" class="header-anchor">#</a> (?!pattern)</h4> <p>正向否定预查(negative assert)，在任何不匹配pattern的字符串开始处匹配查找字符串。这是一个非获取匹配，也就是说，该匹配不需要获取供以后使用。</p> <p>以 xxx(?!pattern)为例，就是捕获不以pattern结尾的内容xxx</p> <p>例如&quot;Windows(?!95|98|NT|2000)&quot;能匹配&quot;Windows3.1&quot;中的&quot;Windows&quot;，但不能匹配&quot;Windows2000&quot;中的&quot;Windows&quot;。</p> <h4 id="pattern-4"><a href="#pattern-4" aria-hidden="true" class="header-anchor">#</a> (?&lt;=pattern)</h4> <p>反向(look behind)肯定预查，与正向肯定预查类似，只是方向相反。</p> <p>例如，&quot;(?&lt;=95|98|NT|2000)Windows&quot;能匹配&quot;2000Windows&quot;中的&quot;Windows&quot;，但不能匹配&quot;3.1Windows&quot;中的&quot;Windows&quot;。</p> <h4 id="！pattern"><a href="#！pattern" aria-hidden="true" class="header-anchor">#</a> (?&lt;！pattern)</h4> <p>反向否定预查，与正向否定预查类似，只是方向相反。</p> <p>例如&quot;(?&lt;!95|98|NT|2000)Windows&quot;能匹配&quot;3.1Windows&quot;中的&quot;Windows&quot;，但不能匹配&quot;2000Windows&quot;中的&quot;Windows&quot;。</p> <h2 id="ajax"><a href="#ajax" aria-hidden="true" class="header-anchor">#</a> Ajax</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 1. 创建一个XMLHttpRequest 异步对象兼容模式</span>
<span class="token keyword">var</span> xhr 

<span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>XMLHttpRequest<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// IE7+、Firefox、Chrome、Safari</span>
  xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
  xhr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActiveXObject</span><span class="token punctuation">(</span><span class="token string">&quot;Microsoft.XMLHTTP&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 2. 设置请求方式和请求地址</span>

<span class="token comment">// 第一个参数是请求方式、第二个是请求地址、第三个是是否是异步 true表示异步，false表示同步 默认是true</span>

xhr<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">'GET'</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
xhr<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">'json'</span>

<span class="token comment">// 3. 发生请求</span>
xhr<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 4. 监听状态变化</span>
<span class="token comment">// 状态码 0: 请求未初始化、1: 服务器已经建立连接、2: 请求已经接收、3: 请求处理中、4: 请求已经完成</span>

xhr<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 5. 接收返回数据</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>readyState <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>xhr<span class="token punctuation">.</span>status <span class="token operator">&gt;=</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> xhr<span class="token punctuation">.</span>status <span class="token operator">&lt;</span> <span class="token number">300</span> <span class="token operator">||</span> xhr<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">304</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;接收返回数据&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;没有接收返回数据&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Promise 版</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Ajax</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">handler</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>readyState <span class="token operator">!==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>statusText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>onreadystatechange <span class="token operator">=</span> handler<span class="token punctuation">;</span>
    client<span class="token punctuation">.</span>responseType <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">setRequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Accept&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;application/json&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="创建对象的方式有哪些"><a href="#创建对象的方式有哪些" aria-hidden="true" class="header-anchor">#</a> 创建对象的方式有哪些</h2> <ol><li>字面量</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> 
  name<span class="token punctuation">:</span> <span class="token string">'ye'</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sayName</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'my name is ye'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>使用Object()方法</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

o<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ye'</span>
o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'my name is ye'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>工厂函数创建</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">createObj</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  o<span class="token punctuation">.</span>name <span class="token operator">=</span> name
  o<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'my name is ye'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> o
<span class="token punctuation">}</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token string">'ye'</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
</code></pre></div><ol start="4"><li>构造函数创建</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>age</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
<span class="token punctuation">}</span>

<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'ye'</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span>
</code></pre></div><ol start="5"><li>原型属性模式</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'ye'</span>
<span class="token class-name">Student</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="操作符优先级"><a href="#操作符优先级" aria-hidden="true" class="header-anchor">#</a> 操作符优先级</h2> <p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence" target="_blank" rel="noopener noreferrer">MDN运算符优先级<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/css.html" class="prev">
          CSS
        </a></span> <span class="next"><a href="/js_advanced.html">
          手写JS
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.94b2f3ef.js" defer></script><script src="/assets/js/2.d467c8ee.js" defer></script><script src="/assets/js/4.e7adceac.js" defer></script>
  </body>
</html>
