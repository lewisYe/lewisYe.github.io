(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{305:function(t,a,s){t.exports=s.p+"assets/img/smp.04a8c0b8.png"},306:function(t,a,s){t.exports=s.p+"assets/img/analyzer.b9fe9054.jpg"},325:function(t,a,s){"use strict";s.r(a);var n=s(0),e=Object(n.a)({},function(){var t=this,a=t.$createElement,n=t._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"webpack"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#webpack","aria-hidden":"true"}},[t._v("#")]),t._v(" Webpack")]),t._v(" "),n("h2",{attrs:{id:"基础配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基础配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 基础配置")]),t._v(" "),n("p",[t._v("本文就不过多的说明基础配置, 具体配置可查看"),n("a",{attrs:{href:"https://github.com/lewisYe/react-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("本链接"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"性能优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#性能优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 性能优化")]),t._v(" "),n("h3",{attrs:{id:"分析工具"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分析工具","aria-hidden":"true"}},[t._v("#")]),t._v(" 分析工具")]),t._v(" "),n("p",[t._v("在进行性能优化之前，是不是需要知道哪里需要被优化，所以我们需要分析工具。")]),t._v(" "),n("h4",{attrs:{id:"速度分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#速度分析","aria-hidden":"true"}},[t._v("#")]),t._v(" 速度分析")]),t._v(" "),n("p",[t._v("使用 "),n("code",[t._v("speed-measure-webpack-plugin")]),t._v(" 插件")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装")]),t._v("\n\nnpm i speed"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("measure"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("webpack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.config.js配置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" SpeedMeasureWebpackPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'speed-measure-webpack-plugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" swp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("SpeedMeasureWebpackPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nswp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("warp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack配置")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[t._v("使用warp方法将webpack配置包裹 "),n("a",{attrs:{href:"https://www.npmjs.com/package/speed-measure-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("具体配置查看"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("效果如下图：\n"),n("img",{attrs:{src:s(305),alt:""}})]),t._v(" "),n("p",[t._v("该插件主要的工作是：计算整个打包总消耗；具体loader和plugin所花费的具体时间")]),t._v(" "),n("h4",{attrs:{id:"体积分析"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#体积分析","aria-hidden":"true"}},[t._v("#")]),t._v(" 体积分析")]),t._v(" "),n("p",[t._v("打包后的体积优化是一个可以着重优化的点，比如引入的一些第三方组件库过大，这时就要考虑是否需要寻找替代品了。例如moment")]),t._v(" "),n("p",[t._v("使用 "),n("code",[t._v("webpack-bundle-analyzer")]),t._v(" 插件来分析包体积大小")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装 ")]),t._v("\nnpm i webpack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bundle"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("analyzer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//webpack.config.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" BundleAnalyzerPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack-bundle-analyzer'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("BundleAnalyzerPlugin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("BundleAnalyzerPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("a",{attrs:{href:"https://www.npmjs.com/package/webpack-bundle-analyzer",target:"_blank",rel:"noopener noreferrer"}},[t._v("具体配置查看"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("然后在命令行工具中输入npm run build，它默认会起一个端口号为 8888 的本地服务器：")]),t._v(" "),n("p",[n("img",{attrs:{src:s(306),alt:""}})]),t._v(" "),n("h3",{attrs:{id:"优化方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#优化方案","aria-hidden":"true"}},[t._v("#")]),t._v(" 优化方案")]),t._v(" "),n("ul",[n("li",[t._v("使用高版本的webpack 和 node.js")]),t._v(" "),n("li",[t._v("多进程/多实例构建\n"),n("ul",[n("li",[t._v("thread-loader")]),t._v(" "),n("li",[t._v("happypack")]),t._v(" "),n("li",[t._v("parallel-webpack")])])]),t._v(" "),n("li",[t._v("多进程并行压缩\n"),n("ul",[n("li",[t._v("terser-webpack-plugin")]),t._v(" "),n("li",[t._v("uglifyjs-webpack-plugin")]),t._v(" "),n("li",[t._v("parallel-uglify-plugin")])])]),t._v(" "),n("li",[t._v("分包 与 预编译\n"),n("ul",[n("li",[t._v("webpack externals")])])]),t._v(" "),n("li",[t._v("开启缓存\n"),n("ul",[n("li",[t._v("babel-loader 开始缓存")]),t._v(" "),n("li",[t._v("terser-webpack-plugin 开启缓存 cache  true")]),t._v(" "),n("li",[t._v("cache-loader 和 hard-source-webpack-plugin")])])]),t._v(" "),n("li",[t._v("缩小构建目标\n"),n("ul",[n("li",[t._v("babel-loader 的时候 不解析node_modules里面的内容 使用exclude,和include的使用")]),t._v(" "),n("li",[t._v("优化 resolve.modules 配置 缩小搜索范围层级")]),t._v(" "),n("li",[t._v("优化 resolve.mainFields 配置 查询入口文件")]),t._v(" "),n("li",[t._v("优化 resolve.extensions 后缀名")]),t._v(" "),n("li",[t._v("合理使用 resolve.alias")])])]),t._v(" "),n("li",[t._v("tree shaking")]),t._v(" "),n("li",[t._v("图片压缩")]),t._v(" "),n("li",[t._v("polyfill service优化构建体积")]),t._v(" "),n("li",[t._v("socpe hoisting")])]),t._v(" "),n("h4",{attrs:{id:"使用高版本的webpack-和-node-js"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用高版本的webpack-和-node-js","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用高版本的webpack 和 node.js")]),t._v(" "),n("p",[t._v("比如webpack4 的打包速度就快于webpack3；node 的版本更高速度也会更快")]),t._v(" "),n("p",[t._v("webpack 优化原因")]),t._v(" "),n("p",[t._v("V8 带来的优化 使用for of 代替了forEach 、Map和Set代替了Object 、includes代替了indexOf")]),t._v(" "),n("p",[t._v("默认使用更快的md4 hash算法")]),t._v(" "),n("p",[t._v("webpacks AST可以直接从loader传递给 AST 减少传递时间")]),t._v(" "),n("p",[t._v("使用字符串代替正则表达式")]),t._v(" "),n("h4",{attrs:{id:"多进程-多实例构建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多进程-多实例构建","aria-hidden":"true"}},[t._v("#")]),t._v(" 多进程/多实例构建")]),t._v(" "),n("p",[t._v("可以使用的插件有")]),t._v(" "),n("ul",[n("li",[t._v("thread-loader")]),t._v(" "),n("li",[t._v("happypack")]),t._v(" "),n("li",[t._v("parallel-webpack")])]),t._v(" "),n("p",[n("strong",[t._v("thread-loader 用法")])]),t._v(" "),n("p",[t._v("thread-loader 会将你的 loader 放置在一个 worker 池里面运行，以达到多线程构建。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装")]),t._v("\nnpm i thread"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("loader "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//webpack.config.js")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        rules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/\\.js$/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            include"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"src"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    loader"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'thread-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    options"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    workers"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("把这个 loader 放置在其他 loader 之前（如下面示例的位置）， 放置在这个 loader 之后的 loader 就会在一个单独的 worker 池(worker pool)中运行。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://www.npmjs.com/package/thread-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("更多配置查看"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("strong",[t._v("HappyPack 用法")])]),t._v(" "),n("p",[t._v("HappyPack 可以让 Webpack 同一时间处理多个任务，发挥多核 CPU 的能力，将任务分解给多个子进程去并发的执行，子进程处理完后，再把结果发送给主进程。通过多进程模型，来加速代码构建。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装")]),t._v("\n\nnpm i happypack "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// webpack.config.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" HappyPack "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nexports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("module "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    rules"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/.js$/")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        use"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'happypack/loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nexports"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("plugins "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HappyPack")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        loaders"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'babel-loader'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("该方法在webpack3中使用比较多，而且目前作者都不在维护该库，并推荐在webpack 4中使用 "),n("code",[t._v("thread-loader")]),t._v(" 更多happypack配置查看"),n("a",{attrs:{href:"https://www.npmjs.com/package/happypack",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置连接"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("code",[t._v("thread-loader")]),t._v(" 和 "),n("code",[t._v("happypack")]),t._v(" 对于小型项目来说打包速度几乎没有影响，甚至可能会增加开销，所以建议尽量在大项目中采用。")]),t._v(" "),n("h4",{attrs:{id:"多进程并行压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多进程并行压缩","aria-hidden":"true"}},[t._v("#")]),t._v(" 多进程并行压缩")]),t._v(" "),n("p",[t._v("webpack默认提供了UglifyJS插件来压缩JS代码，但是它使用的是单线程压缩代码，也就是说多个js文件需要被压缩，它需要一个个文件进行压缩。所以说在正式环境打包压缩代码速度非常慢(因为压缩JS代码需要先把代码解析成用Object抽象表示的AST语法树，再应用各种规则分析和处理AST，导致这个过程耗时非常大)。")]),t._v(" "),n("p",[t._v("所以我们要对压缩代码这一步骤进行优化，常用的做法就是多进程并行压缩")]),t._v(" "),n("p",[t._v("目前有三种主流的压缩方案：")]),t._v(" "),n("ul",[n("li",[t._v("terser-webpack-plugin")]),t._v(" "),n("li",[t._v("uglifyjs-webpack-plugin")]),t._v(" "),n("li",[t._v("parallel-uglify-plugin")])]),t._v(" "),n("h4",{attrs:{id:"terser-webpack-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#terser-webpack-plugin","aria-hidden":"true"}},[t._v("#")]),t._v(" terser-webpack-plugin")]),t._v(" "),n("p",[t._v("不知道你有没有发现：webpack4 已经默认支持 ES6语法的压缩。而这离不开terser-webpack-plugin。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装")]),t._v("\nnpm i terser"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("webpack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//webpack.config.js")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" TerserPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'terser-webpack-plugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  optimization"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    minimize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    minimizer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TerserPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        parallel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h4",{attrs:{id:"uglifyjs-webpack-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uglifyjs-webpack-plugin","aria-hidden":"true"}},[t._v("#")]),t._v(" uglifyjs-webpack-plugin")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装 ")]),t._v("\nnpm i uglifyjs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("webpack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//webpack.config.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" UglifyJsPlugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'uglifyjs-webpack-plugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("UglifyJsPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      uglifyOptions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        warnings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        parse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        compress"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        ie8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      parallel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("通过设置parallel: true开启多进程压缩。")]),t._v(" "),n("h4",{attrs:{id:"parallel-uglify-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#parallel-uglify-plugin","aria-hidden":"true"}},[t._v("#")]),t._v(" parallel-uglify-plugin")]),t._v(" "),n("p",[t._v("当webpack有多个JS文件需要输出和压缩时，原来会使用UglifyJS去一个个压缩并且输出，而ParallelUglifyPlugin插件则会开启多个子进程，把对多个文件压缩的工作分给多个子进程去完成，但是每个子进程还是通过UglifyJS去压缩代码。并行压缩可以显著的提升效率。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 安装")]),t._v("\nnpm i webpack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("parallel"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("uglify"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("plugin "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("D")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//webpack.comfig.jss")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" ParallelUglifyPlugin "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'webpack-parallel-uglify-plugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ParallelUglifyPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Optional regex, or array of regex to match file against. Only matching files get minified.")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Defaults to /.js$/, any file ending in .js.")]),t._v("\n      test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      include"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Optional regex, or array of regex to include in minification. Only matching files get minified.")]),t._v("\n      exclude"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Optional regex, or array of regex to exclude from minification. Matching files are not minified.")]),t._v("\n      cacheDir"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Optional absolute path to use as a cache. If not provided, caching will not be used.")]),t._v("\n      workerCount"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Optional int. Number of workers to run uglify. Defaults to num of cpus - 1 or asset count (whichever is smaller)")]),t._v("\n      sourceMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Optional Boolean. This slows down the compilation. Defaults to false.")]),t._v("\n      uglifyJS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// These pass straight through to uglify-js@3.")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cannot be used with uglifyES.")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Defaults to {} if not neither uglifyJS or uglifyES are provided.")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// You should use this option if you need to ensure es5 support. uglify-js will produce an error message")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// if it comes across any es6 code that it can't parse.")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      uglifyES"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// These pass straight through to uglify-es.")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Cannot be used with uglifyJS.")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// uglify-es is a version of uglify that understands newer es6 syntax. You should use this option if the")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// files that you're minifying do not need to run in older browsers/versions of node.")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("注意：webpack-parallel-uglify-plugin已不再维护，这里不推荐使用")]),t._v(" "),n("h4",{attrs:{id:"分包-与-预编译"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#分包-与-预编译","aria-hidden":"true"}},[t._v("#")]),t._v(" 分包 与 预编译")]),t._v(" "),n("p",[t._v("什么是预编译")]),t._v(" "),n("p",[t._v("在使用webpack进行打包时候，对于依赖的第三方库，比如React，Redux等这些不会修改的依赖，我们可以让它和我们自己编写的代码分开打包，这样做的好处是每次更改我本地代码的文件的时候，webpack只需要打包我项目本身的文件代码，而不会再去编译第三方库。")]),t._v(" "),n("p",[t._v("那么第三方库在第一次打包的时候只打包一次，以后只要我们不升级第三方包的时候，那么webpack就不会对这些库去打包，这样的可以快速的提高打包的速度。其实也就是预编译资源模块。")]),t._v(" "),n("p",[t._v("webpack中，我们可以结合DllPlugin 和 DllReferencePlugin插件来实现。")]),t._v(" "),n("p",[t._v("但是发现在 vue-cli 和 create-react-app 抛弃了 该种方法 也可以使用hard-source-webpack-plugin 来代替 所以该方法作为了解吧。有兴趣的同学可以深入了解一下。")]),t._v(" "),n("h4",{attrs:{id:"开启缓存"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开启缓存","aria-hidden":"true"}},[t._v("#")]),t._v(" 开启缓存")]),t._v(" "),n("ul",[n("li",[t._v("babel-loader 开始缓存")]),t._v(" "),n("li",[t._v("terser-webpack-plugin 开启缓存")]),t._v(" "),n("li",[t._v("cache-loader 和 hard-source-webpack-plugin")])]),t._v(" "),n("p",[t._v("缓存对于首次构建时间没有太大变化，但是第二次构建有显著提升")]),t._v(" "),n("h4",{attrs:{id:"缩小构建目标"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缩小构建目标","aria-hidden":"true"}},[t._v("#")]),t._v(" 缩小构建目标")]),t._v(" "),n("ul",[n("li",[t._v("babel-loader 的时候 不解析node_modules里面的内容 使用exclude,和include的使用")]),t._v(" "),n("li",[t._v("优化 resolve.modules 配置 缩小搜索范围层级")]),t._v(" "),n("li",[t._v("优化 resolve.mainFields 配置 查询入口文件")]),t._v(" "),n("li",[t._v("优化 resolve.extensions 后缀名")]),t._v(" "),n("li",[t._v("合理使用 resolve.alias")])]),t._v(" "),n("h4",{attrs:{id:"tree-shaking"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking","aria-hidden":"true"}},[t._v("#")]),t._v(" tree shaking")]),t._v(" "),n("ul",[n("li",[t._v("purgecss-webpack-plugin 去除无效css")])]),t._v(" "),n("h4",{attrs:{id:"图片压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#图片压缩","aria-hidden":"true"}},[t._v("#")]),t._v(" 图片压缩")]),t._v(" "),n("ul",[n("li",[t._v("image-webpack-loader")])]),t._v(" "),n("h4",{attrs:{id:"polyfill-service优化构建体积"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#polyfill-service优化构建体积","aria-hidden":"true"}},[t._v("#")]),t._v(" polyfill service优化构建体积")]),t._v(" "),n("p",[t._v("es6语法不兼容 需要使用到polyfill去转换")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",{staticStyle:{"text-align":"center"}},[t._v("方案")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("优点")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("缺点")]),t._v(" "),n("th",{staticStyle:{"text-align":"center"}},[t._v("推荐")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("babel-polyfill")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("react推荐")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("1.包体积200k+，难以单独抽离Map、Set")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("❎")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("babel-plugin-transform-runtime")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("能只polyfill用到的类和方法，相对体积小")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("不能polyfill原型上的方法，不能应用于复杂的业务场景")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("❎")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("自己写一个库")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("定制化、体积小")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("重复造轮子、需要更新维护")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("❎")])]),t._v(" "),n("tr",[n("td",{staticStyle:{"text-align":"center"}},[t._v("polyfill-service")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("只给用户返回用到的polyfill、社区维护")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("国内奇葩浏览器UA不能识别、但可以降级处理返回全部的polyfill")]),t._v(" "),n("td",{staticStyle:{"text-align":"center"}},[t._v("✅")])])])]),t._v(" "),n("p",[t._v("https://polyfill.io/v3/ 官网")]),t._v(" "),n("h4",{attrs:{id:"socpe-hoisting"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#socpe-hoisting","aria-hidden":"true"}},[t._v("#")]),t._v(" socpe hoisting")]),t._v(" "),n("p",[t._v("Scope hoisting 直译过来就是「作用域提升」。熟悉 JavaScript 都应该知道「函数提升」和「变量提升」，JavaScript 会把函数和变量声明提升到当前作用域的顶部。「作用域提升」也类似于此，webpack 会把引入的 js 文件“提升到”它的引入者顶部。")]),t._v(" "),n("p",[t._v("Scope Hoisting 可以让 Webpack 打包出来的代码文件更小、运行的更快。")]),t._v(" "),n("p",[t._v("要在 Webpack 中使用 Scope Hoisting 非常简单，因为这是 Webpack 内置的功能，只需要配置一个插件，相关代码如下：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  plugins"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("webpack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("optimize"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ModuleConcatenationPlugin")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("该插件在webpack4中是默认开启的。")]),t._v(" "),n("p",[n("strong",[t._v("对比使用效果")])]),t._v(" "),n("p",[t._v("现在有个文件分别是：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// constant.js")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello,Jack-cool'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 入口文件 main.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" str "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./constant.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n")])])]),n("p",[t._v("未启用Scope Hoisting打包之后")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_exports__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_require__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" __WEBPACK_IMPORTED_MODULE_0__constant_js__ "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("__webpack_require__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__WEBPACK_IMPORTED_MODULE_0__constant_js__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_exports__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_require__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    __webpack_exports__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"a"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello,Jack-cool'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])]),n("p",[t._v("在开启 Scope Hoisting 后")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_exports__"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" __webpack_require__")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" constant "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello,Jack-cool'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("constant"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\n")])])]),n("p",[t._v("从中可以看出开启 Scope Hoisting 后，函数申明由两个变成了一个，constant.js 中定义的内容被直接注入到了 main.js 对应的模块中。")]),t._v(" "),n("p",[t._v("这样做的好处是：")]),t._v(" "),n("ul",[n("li",[t._v("代码体积更小，因为函数申明语句会产生大量代码；")]),t._v(" "),n("li",[t._v("代码在运行时因为创建的函数作用域更少了，内存开销也随之变小。")])]),t._v(" "),n("p",[t._v("Scope Hoisting 的实现原理其实很简单：分析出模块之间的依赖关系，尽可能的把打散的模块合并到一个函数中去，但前提是不能造成代码冗余。因此只有那些被引用了一次的模块才能被合并。")]),t._v(" "),n("p",[t._v("注意： 由于 Scope Hoisting 需要分析出模块之间的依赖关系，因此源码必须采用 ES6 模块化语句，不然它将无法生效。")]),t._v(" "),n("h2",{attrs:{id:"writing-a-loader"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#writing-a-loader","aria-hidden":"true"}},[t._v("#")]),t._v(" Writing a Loader")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://webpack.js.org/contribute/writing-a-loader/",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档链接"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("开发插件中一般会用到的工具库 "),n("code",[t._v("loader-utils")]),t._v(" 和 "),n("code",[t._v("schema-utils")])]),t._v(" "),n("p",[n("code",[t._v("loader-utils")]),t._v(" 有很多工具类方法 "),n("a",{attrs:{href:"https://github.com/webpack/loader-utils",target:"_blank",rel:"noopener noreferrer"}},[t._v("具体配置项链接"),n("OutboundLink")],1)]),t._v(" "),n("p",[n("code",[t._v("schema-utils")]),t._v("用于参数校验")]),t._v(" "),n("p",[t._v("可以直接return 单个结果  多个结果可以使用"),n("code",[t._v("this.callback(err, values...)")])]),t._v(" "),n("p",[t._v("比如实现一个中文转unicode")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("exports")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("unicodeLoader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("source")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" res "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" source"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/([\\u0080-\\uffff])/g")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("str")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" hex "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" str"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("charCodeAt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" hex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      hex "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`0")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("hex"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`\\\\u")]),n("span",{pre:!0,attrs:{class:"token interpolation"}},[n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("hex"),n("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" res"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"writing-a-plugin"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#writing-a-plugin","aria-hidden":"true"}},[t._v("#")]),t._v(" Writing a Plugin")]),t._v(" "),n("p",[t._v("开发一个插件 必须是一个类，类中必须有一个apply 方法。 apply方法会有一个"),n("code",[t._v("compiler")]),t._v("参数。")]),t._v(" "),n("p",[t._v("然后通过监听hooks 进行操作 比如监听emit hook")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v(" compiler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("hooks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("emit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("tapAsync")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'MyPlugin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("compilation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 插件功能")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("p",[n("a",{attrs:{href:"https://webpack.js.org/contribute/writing-a-plugin/",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档链接"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"webpack核心原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#webpack核心原理","aria-hidden":"true"}},[t._v("#")]),t._v(" webpack核心原理")]),t._v(" "),n("p",[t._v("webpack本质上是一种事件流的机制，它的工作流程就是将各个插件串联起来，而实现这一切的核心就是Tapable，webpack中最核心的负责编译的Compiler和负责创建bundles的Compilation都是Tapable的实例。")]),t._v(" "),n("p",[t._v("Tapable 提供了很多钩子函数 包含sync 和 async 的 供编写插件使用 有点事件监听的感觉")]),t._v(" "),n("p",[t._v("Webpack 的运行流程是一个串行的过程,从启动到结束会依次执行以下流程 :")]),t._v(" "),n("ol",[n("li",[t._v("初始化参数：从配置文件和 Shell 语句中读取与合并参数,得出最终的参数。")]),t._v(" "),n("li",[t._v("开始编译：用上一步得到的参数初始化 Compiler 对象,加载所有配置的插件,执行对象的 run 方法开始执行编译。\nwebpack的编译都按照下面的钩子调用顺序执行。")])]),t._v(" "),n("ul",[n("li",[t._v("before-run 清除缓存")]),t._v(" "),n("li",[t._v("run 注册缓存数据钩子")]),t._v(" "),n("li",[t._v("before-compile")]),t._v(" "),n("li",[t._v("compile 开始编译")]),t._v(" "),n("li",[t._v("make 从入口分析依赖以及间接依赖模块，创建模块对象")]),t._v(" "),n("li",[t._v("build-module 模块构建")]),t._v(" "),n("li",[t._v("seal 构建结果封装， 不可再更改")]),t._v(" "),n("li",[t._v("after-compile 完成构建，缓存数据")]),t._v(" "),n("li",[t._v("emit 输出到dist目录")])]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("确定入口：根据配置中的 entry 找出所有的入口文件。\n在webpack make钩子中, tapAsync注册了一个DllEntryPlugin, 就是将入口模块通过调用compilation.addEntry方法将所有的入口模块添加到编译构建队列中，开启编译流程。在addEntry 中调用_addModuleChain开始编译。在_addModuleChain首先会生成模块，最后构建。\n_addModuleChain调用buildModule方法进行编译代码，build中 其实是利用acorn编译生成AST 设计loader的加载使用\n在编译完成后，调用compilation.seal方法封闭，生成资源，这些资源保存在compilation.assets, compilation.chunk")]),t._v(" "),n("li",[t._v("编译模块：从入口文件出发,调用所有配置的 Loader 对模块进行翻译,再找出该模块依赖的模块,再递归本步骤直到所有入口依赖的文件都经过了本步骤的处理。")]),t._v(" "),n("li",[t._v("完成模块编译：在经过第 4 步使用 Loader 翻译完所有模块后,得到了每个模块被翻译后的最终内容以及它们之间的依赖关系。")]),t._v(" "),n("li",[t._v("输出资源：根据入口和模块之间的依赖关系,组装成一个个包含多个模块的 Chunk,再把每个 Chunk 转换成一个单独的文件加入到输出列表,这步是可以修改输出内容的最后机会。")]),t._v(" "),n("li",[t._v("输出完成：在确定好输出内容后,根据配置确定输出的路径和文件名,把文件内容写入到文件系统。")])]),t._v(" "),n("h2",{attrs:{id:"webpack-热更新原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#webpack-热更新原理","aria-hidden":"true"}},[t._v("#")]),t._v(" webpack 热更新原理")]),t._v(" "),n("h2",{attrs:{id:"ast"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ast","aria-hidden":"true"}},[t._v("#")]),t._v(" AST")]),t._v(" "),n("h2",{attrs:{id:"webpack5"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#webpack5","aria-hidden":"true"}},[t._v("#")]),t._v(" webpack5")]),t._v(" "),n("p",[t._v("2020年10月10号webpack5发布了，带了许多的变更。下面就聊一聊我所认识的对我有影响的点。（其实我就是看懂了哪些，哈哈哈哈）")]),t._v(" "),n("p",[t._v("本次重大发布的整体发展方向如下：")]),t._v(" "),n("ul",[n("li",[t._v("尝试用持久性缓存来提高构建性能。")]),t._v(" "),n("li",[t._v("尝试用更好的算法和默认值来改进长期缓存。")]),t._v(" "),n("li",[t._v("尝试用更好的 Tree Shaking 和代码生成来改善包大小。")]),t._v(" "),n("li",[t._v("尝试改善与网络平台的兼容性。")]),t._v(" "),n("li",[t._v("尝试在不引入任何破坏性变化的情况下，清理那些在实现 v4 功能时处于奇怪状态的内部结构。")]),t._v(" "),n("li",[t._v("试图通过现在引入突破性的变化来为未来的功能做准备，尽可能长时间地保持在 v5 版本上。")])]),t._v(" "),n("h3",{attrs:{id:"功能清除"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#功能清除","aria-hidden":"true"}},[t._v("#")]),t._v(" 功能清除")]),t._v(" "),n("ol",[n("li",[t._v("清理已经废弃的功能")])]),t._v(" "),n("p",[t._v("所有在webpack4标记即将过期的功能，都在该版本移除。所以再升级之前请确认没有废弃的功能点。")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("不再为Node.js模块自动引用Polyfills")])]),t._v(" "),n("p",[t._v("在webpack4及之前的版本，项目中有使用node.js内置模块会自动添加Polyfills；在webpack5中将不会再添加。如果你的项目中有需要用到请手动添加。")]),t._v(" "),n("h3",{attrs:{id:"针对长期缓存的优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#针对长期缓存的优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 针对长期缓存的优化")]),t._v(" "),n("ol",[n("li",[t._v("确定的Chunk、模块ID和导出名称")])]),t._v(" "),n("p",[t._v("新增了长期的缓存的算法。这些算法在生产环境是默认开启的。")]),t._v(" "),n("p",[n("code",[t._v('chunkIds:"deterministic"')]),t._v(" "),n("code",[t._v('moduleIds:"deterministic"')]),t._v(" "),n("code",[t._v('mangleExports:"deterministic"')])]),t._v(" "),n("p",[t._v("该算法以确定性的方式为模块和分块分配短的（3 或 5 位）数字 ID，这是包大小和长期缓存之间的一种权衡。由于这些配置将使用确定的 ID 和名称，这意味着生成的缓存失效不再更频繁。")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("真正的contenthash")])]),t._v(" "),n("p",[t._v('在webpack5中将使用真正的文件内容哈希。之前的版本它"只"使用内容结构的哈希值。当只有注释被修改或者变量被重命名，这对长期缓存会有积极影响。这些变化在压缩后是不可见的。')]),t._v(" "),n("h3",{attrs:{id:"构建优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#构建优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 构建优化")]),t._v(" "),n("ol",[n("li",[t._v("嵌套的tree-shaking")])]),t._v(" "),n("p",[t._v("webpack现在能够跟着对导出的嵌套属性的访问。这可以改善重新导出命名空间 对象时的 Tree Shaking（清除未使用的导出和混淆导出）。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// inner.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" a "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" b "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// module.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" inner "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./inner'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 或 import * as inner from './inner'; export { inner };")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// user.js")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" module "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./module'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("inner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("在这个例子中，可以在生产模式下删除导出的b。")]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("内部模块tree-shaking")])]),t._v(" "),n("p",[t._v("webpack4没有分析模块的导出和引用之间的依赖关系。webpack5中有一个新的选项"),n("code",[t._v("optimization.innerGrph")]),t._v("，在生产模式下是默认开启的，它可以对模块中的标志进行分析，找出导出和引用之间的依赖关系。")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" something "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./something'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("usingSomething")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" something"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("usingSomething")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("内部依赖图算法会找出 something 只有在使用 test 导出时才会使用。这允许将更多的出口标记为未使用，并从代码包中省略更多的代码。")]),t._v(" "),n("p",[t._v("当设置"),n("code",[t._v('"sideEffects": false')]),t._v("时，可以省略更多的模块。在这个例子中，当 "),n("code",[t._v("test")]),t._v(" 导出未被使用时，"),n("code",[t._v("./something")]),t._v(" 将被省略。")]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("commonJs tree-shaking")])]),t._v(" "),n("p",[t._v("webpack 曾经不进行对 CommonJs 导出和 require() 调用时的导出使用分析。")]),t._v(" "),n("p",[t._v("webpack 5 增加了对一些 CommonJs 构造的支持，允许消除未使用的 CommonJs 导出，并从 require() 调用中跟踪引用的导出名称。")]),t._v(" "),n("h3",{attrs:{id:"重大变更：长期未解决的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#重大变更：长期未解决的问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 重大变更：长期未解决的问题")]),t._v(" "),n("ol",[n("li",[t._v("单一文件目标的代码分割")])]),t._v(" "),n("p",[t._v("只允许启动单个文件的目标（如 node、WebWorker、electron main）现在支持运行时自动加载引导所需的依赖代码片段。")]),t._v(" "),n("p",[t._v('这允许对这些目标使用 chunks: "all" 和 optimization.runtimeChunk。')]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("更新了解析器")])]),t._v(" "),n("p",[n("code",[t._v("enhanced-resolve")]),t._v("更新到了v5版本，有以下改进：")]),t._v(" "),n("ul",[n("li",[t._v("追踪更多的依赖关系，比如丢失的文件")]),t._v(" "),n("li",[t._v("别名可能有多种选择")]),t._v(" "),n("li",[t._v("现在可以别名为"),n("code",[t._v("false")]),t._v("了")]),t._v(" "),n("li",[t._v("支持 exports 和 imports 字段等功能")]),t._v(" "),n("li",[t._v("性能提高")])]),t._v(" "),n("ol",{attrs:{start:"3"}},[n("li",[t._v("没有JS的代码块")])]),t._v(" "),n("p",[t._v("不包含 JS 代码的块，将不再生成 JS 文件。这就允许有只包含 CSS 的代码块。")]),t._v(" "),n("h3",{attrs:{id:"主要的内部架构变更"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#主要的内部架构变更","aria-hidden":"true"}},[t._v("#")]),t._v(" 主要的内部架构变更")]),t._v(" "),n("ol",[n("li",[t._v("新的插件运行顺序")])]),t._v(" "),n("p",[t._v("现在 webpack 5 中的插件在应用配置默认值之前就会被应用。这使得插件可以应用自己的默认值，或者作为配置预设。但这也是一个突破性的变化，因为插件在应用时不能依赖配置值的设置。")]),t._v(" "),n("p",[t._v("参考链接："),n("a",{attrs:{href:"https://mp.weixin.qq.com/s/sh7rcv6hdhYfWr1bv_ssbg",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://mp.weixin.qq.com/s/sh7rcv6hdhYfWr1bv_ssbg"),n("OutboundLink")],1)]),t._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[t._v("入口文件的新增配置")])]),t._v(" "),n("p",[t._v("webpack 5 中，入口文件除了字符串、字符串数组，也可以使用描述符进行配置了，如：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n entry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   catalog"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n     "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./catalog.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("此外，也可以定义输出的文件名，之前都是通过 output.filename 进行定义的：")]),t._v(" "),n("div",{staticClass:"language-javascript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[t._v("module"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  entry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    about"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./about.js'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pages/[name][ext]'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ol",{attrs:{start:"3"}},[n("li",[t._v("Tapable 插件升级")])]),t._v(" "),n("p",[t._v("webpack 3 插件的 compat 层已经被移除。它在 webpack 4 中已经被取消了。一些较少使用的 tapable API 被删除或废弃。")]),t._v(" "),n("h2",{attrs:{id:"babel"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#babel","aria-hidden":"true"}},[t._v("#")]),t._v(" babel")]),t._v(" "),n("p",[t._v("babel 的转译过程分为三个阶段：parsing、transforming、generating，以 ES6 代码转译为 ES5 代码为例，babel 转译的具体过程如下：")]),t._v(" "),n("ol",[n("li",[t._v("ES6 代码输入")]),t._v(" "),n("li",[t._v("babylon 进行解析得到 AST")]),t._v(" "),n("li",[t._v("plugin 用 babel-traverse 对 AST 树进行遍历转译,得到新的 AST 树")]),t._v(" "),n("li",[t._v("用 babel-generator 通过 AST 树生成 ES5 代码")])])])},[],!1,null,null,null);a.default=e.exports}}]);