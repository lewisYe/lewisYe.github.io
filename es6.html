<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ES6 | FE Knowledge</title>
    <meta name="description" content="å‰ç«¯çŸ¥è¯†ç‚¹æ¢³ç†">
    
    
    <link rel="preload" href="/assets/css/0.styles.b194f207.css" as="style"><link rel="preload" href="/assets/js/app.94b2f3ef.js" as="script"><link rel="preload" href="/assets/js/2.d467c8ee.js" as="script"><link rel="preload" href="/assets/js/12.a146812a.js" as="script"><link rel="prefetch" href="/assets/js/10.7358a0a7.js"><link rel="prefetch" href="/assets/js/11.b76e3d06.js"><link rel="prefetch" href="/assets/js/13.cf5c1852.js"><link rel="prefetch" href="/assets/js/14.c5690a9e.js"><link rel="prefetch" href="/assets/js/15.cfd708ec.js"><link rel="prefetch" href="/assets/js/16.667fb96d.js"><link rel="prefetch" href="/assets/js/17.09141bb2.js"><link rel="prefetch" href="/assets/js/18.65cc8cb4.js"><link rel="prefetch" href="/assets/js/19.742f92d8.js"><link rel="prefetch" href="/assets/js/20.93f5ef9b.js"><link rel="prefetch" href="/assets/js/21.bf458488.js"><link rel="prefetch" href="/assets/js/3.64e9b869.js"><link rel="prefetch" href="/assets/js/4.e7adceac.js"><link rel="prefetch" href="/assets/js/5.d198a837.js"><link rel="prefetch" href="/assets/js/6.eee8a3aa.js"><link rel="prefetch" href="/assets/js/7.4250d63b.js"><link rel="prefetch" href="/assets/js/8.c395ce89.js"><link rel="prefetch" href="/assets/js/9.10bd2809.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b194f207.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">FE Knowledge</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/lewisYe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/lewisYe" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/introduction.html" class="sidebar-link">ä»‹ç»</a></li><li><a href="/html.html" class="sidebar-link">HTML</a></li><li><a href="/css.html" class="sidebar-link">CSS</a></li><li><a href="/js_base.html" class="sidebar-link">JS åŸºç¡€</a></li><li><a href="/js_advanced.html" class="sidebar-link">æ‰‹å†™JS</a></li><li><a href="/es6.html" class="active sidebar-link">ES6</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#let-å’Œ-const" class="sidebar-link">let å’Œ const</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#å—çº§ä¸­ä½œç”¨åŸŸ" class="sidebar-link">å—çº§ä¸­ä½œç”¨åŸŸ</a></li><li class="sidebar-sub-header"><a href="/es6.html#letã€const" class="sidebar-link">letã€const</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#arrow-function" class="sidebar-link">arrow function</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#åŸºæœ¬è¯­æ³•" class="sidebar-link">åŸºæœ¬è¯­æ³•</a></li><li class="sidebar-sub-header"><a href="/es6.html#ä½¿ç”¨æ³¨æ„ç‚¹" class="sidebar-link">ä½¿ç”¨æ³¨æ„ç‚¹</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#symbol" class="sidebar-link">Symbol</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#åŸºæœ¬ç”¨æ³•" class="sidebar-link">åŸºæœ¬ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/es6.html#å†…ç½®çš„symbolå€¼" class="sidebar-link">å†…ç½®çš„Symbolå€¼</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#set-å’Œ-map" class="sidebar-link">Set å’Œ Map</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#set" class="sidebar-link">Set</a></li><li class="sidebar-sub-header"><a href="/es6.html#weakset" class="sidebar-link">WeakSet</a></li><li class="sidebar-sub-header"><a href="/es6.html#map" class="sidebar-link">Map</a></li><li class="sidebar-sub-header"><a href="/es6.html#weakmap" class="sidebar-link">WeakMap</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#proxy-å’Œ-defineproperty" class="sidebar-link">Proxy å’Œ defineProperty</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#defineproperty" class="sidebar-link">defineProperty</a></li><li class="sidebar-sub-header"><a href="/es6.html#setters-å’Œ-getters" class="sidebar-link">Setters å’Œ Getters</a></li><li class="sidebar-sub-header"><a href="/es6.html#æ•°æ®ç›‘å¬" class="sidebar-link">æ•°æ®ç›‘å¬</a></li><li class="sidebar-sub-header"><a href="/es6.html#proxy" class="sidebar-link">Proxy</a></li><li class="sidebar-sub-header"><a href="/es6.html#wacth-proxy-å®ç°" class="sidebar-link">Wacth Proxy å®ç°</a></li><li class="sidebar-sub-header"><a href="/es6.html#defineproperty-å’Œ-proxy-åŒºåˆ«" class="sidebar-link">defineProperty å’Œ Proxy åŒºåˆ«</a></li><li class="sidebar-sub-header"><a href="/es6.html#åº”ç”¨åœºæ™¯" class="sidebar-link">åº”ç”¨åœºæ™¯</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#reflect" class="sidebar-link">Reflect</a></li><li class="sidebar-sub-header"><a href="/es6.html#promiseå¯¹è±¡" class="sidebar-link">Promiseå¯¹è±¡</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#ä»‹ç»" class="sidebar-link">ä»‹ç»</a></li><li class="sidebar-sub-header"><a href="/es6.html#åŸºæœ¬ç”¨æ³•-2" class="sidebar-link">åŸºæœ¬ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-all" class="sidebar-link">Promise.all()</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-race-iterable" class="sidebar-link">Promise.race(iterable)</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-allsettled" class="sidebar-link">Promise.allSettled()</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-any" class="sidebar-link">Promise.any()</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-reject-reason" class="sidebar-link">Promise.reject(reason)</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-resolve-value" class="sidebar-link">Promise.resolve(value)</a></li><li class="sidebar-sub-header"><a href="/es6.html#æ¨¡æ‹Ÿå®ç°promise" class="sidebar-link">æ¨¡æ‹Ÿå®ç°Promise</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-å®ç°è¶…æ—¶æœºåˆ¶" class="sidebar-link">Promise å®ç°è¶…æ—¶æœºåˆ¶</a></li><li class="sidebar-sub-header"><a href="/es6.html#promise-å¹¶è¡Œè°ƒåº¦å™¨" class="sidebar-link">Promise å¹¶è¡Œè°ƒåº¦å™¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#iterator-å’Œ-for-of-å¾ªç¯" class="sidebar-link">Iterator å’Œ for...of å¾ªç¯</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#for-of" class="sidebar-link">for ... of</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#generator-å‡½æ•°" class="sidebar-link">Generator å‡½æ•°</a></li><li class="sidebar-sub-header"><a href="/es6.html#async-å‡½æ•°" class="sidebar-link">Async å‡½æ•°</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#async-å‡½æ•°çš„å®ç°åŸç†" class="sidebar-link">async å‡½æ•°çš„å®ç°åŸç†</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#es6-3ç§å¼‚æ­¥å¤„ç†æ–¹æ³•çš„æ¯”è¾ƒ" class="sidebar-link">ES6 3ç§å¼‚æ­¥å¤„ç†æ–¹æ³•çš„æ¯”è¾ƒ</a></li><li class="sidebar-sub-header"><a href="/es6.html#class-ç±»" class="sidebar-link">Class ç±»</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#åŸºæœ¬è¯­æ³•-2" class="sidebar-link">åŸºæœ¬è¯­æ³•</a></li><li class="sidebar-sub-header"><a href="/es6.html#constructor" class="sidebar-link">constructor</a></li><li class="sidebar-sub-header"><a href="/es6.html#ç±»çš„å®ä¾‹" class="sidebar-link">ç±»çš„å®ä¾‹</a></li><li class="sidebar-sub-header"><a href="/es6.html#é™æ€æ–¹æ³•" class="sidebar-link">é™æ€æ–¹æ³•</a></li><li class="sidebar-sub-header"><a href="/es6.html#é™æ€å±æ€§" class="sidebar-link">é™æ€å±æ€§</a></li><li class="sidebar-sub-header"><a href="/es6.html#extends-ç»§æ‰¿" class="sidebar-link">extends ç»§æ‰¿</a></li><li class="sidebar-sub-header"><a href="/es6.html#super-å…³é”®å­—" class="sidebar-link">super å…³é”®å­—</a></li><li class="sidebar-sub-header"><a href="/es6.html#ç±»çš„-prototype-å±æ€§å’Œ-proto-å±æ€§" class="sidebar-link">ç±»çš„ prototype å±æ€§å’Œ_proto_å±æ€§</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#module" class="sidebar-link">Module</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/es6.html#export" class="sidebar-link">export</a></li><li class="sidebar-sub-header"><a href="/es6.html#import" class="sidebar-link">import</a></li><li class="sidebar-sub-header"><a href="/es6.html#export-default" class="sidebar-link">export default</a></li><li class="sidebar-sub-header"><a href="/es6.html#import-2" class="sidebar-link">import()</a></li><li class="sidebar-sub-header"><a href="/es6.html#ä¸common-jså·®å¼‚" class="sidebar-link">ä¸common.jså·®å¼‚</a></li></ul></li><li class="sidebar-sub-header"><a href="/es6.html#deorator-è£…é¥°å™¨" class="sidebar-link">Deorator è£…é¥°å™¨</a></li></ul></li><li><a href="/browser.html" class="sidebar-link">æµè§ˆå™¨ç³»åˆ—</a></li><li><a href="/network.html" class="sidebar-link">ç½‘ç»œ</a></li><li><a href="/react.html" class="sidebar-link">React</a></li><li><a href="/webpack.html" class="sidebar-link">Webpack</a></li><li><a href="/ts.html" class="sidebar-link">TypeScript</a></li><li><a href="/performance.html" class="sidebar-link">æ€§èƒ½</a></li><li><a href="/algorithm.html" class="sidebar-link">æ•°æ®ç»“æ„ä¸ç®—æ³•</a></li><li><a href="/design.html" class="sidebar-link">è®¾è®¡æ¨¡å¼</a></li><li><a href="/other.html" class="sidebar-link">å…¶å®ƒ</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="es6"><a href="#es6" aria-hidden="true" class="header-anchor">#</a> ES6</h1> <h2 id="let-å’Œ-const"><a href="#let-å’Œ-const" aria-hidden="true" class="header-anchor">#</a> let å’Œ const</h2> <h3 id="å—çº§ä¸­ä½œç”¨åŸŸ"><a href="#å—çº§ä¸­ä½œç”¨åŸŸ" aria-hidden="true" class="header-anchor">#</a> å—çº§ä¸­ä½œç”¨åŸŸ</h3> <p>ES5åªæœ‰å…¨å±€ä½œç”¨åŸŸå’Œå‡½æ•°ä½œç”¨åŸŸï¼Œæ²¡æœ‰å—çº§ä½œç”¨åŸŸï¼Œè¿™å¸¦æ¥å¾ˆå¤šä¸åˆç†çš„åœºæ™¯ã€‚</p> <ol><li>å†…å±‚å˜é‡å¯èƒ½ä¼šè¦†ç›–å¤–å±‚å˜é‡</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token string">'global'</span>

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> temp <span class="token operator">=</span> <span class="token string">'fuction'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// undefied</span>
</code></pre></div><p>è¾“å‡ºç»“æœä¸ºundefined,åŸå› åœ¨äºå˜é‡æå‡ï¼Œå¯¼è‡´å†…å±‚çš„tmpå˜é‡è¦†ç›–å¤–å±‚çš„tmpå˜é‡</p> <p>2.ç”¨æ¥è®¡æ•°çš„å¾ªç¯å˜é‡æ³„éœ²ä¸ºå…¨å±€å˜é‡</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'hello'</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>str<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 5</span>
</code></pre></div><p>å˜é‡åªç”¨æ¥æ§åˆ¶å¾ªç¯ï¼Œä½†æ˜¯å¾ªç¯ç»“æŸåï¼Œå®ƒå¹¶æ²¡æœ‰æ¶ˆå¤±ï¼Œæ³„éœ²æˆä¸ºäº†å…¨å±€å˜é‡</p> <h3 id="letã€const"><a href="#letã€const" aria-hidden="true" class="header-anchor">#</a> letã€const</h3> <p>ES6 æ–°å¢äº† let å’Œ const å…³é”®å­—ç”¨æ¥å£°æ˜å˜é‡ï¼Œå®é™…ä¸Šä¸ºJavaScriptæ–°å¢äº†å—çº§ä½œç”¨åŸŸã€‚</p> <p>æ³¨æ„ç‚¹ï¼šES6 çš„å—çº§ä½œç”¨åŸŸå¿…é¡»æœ‰å¤§æ‹¬å·ï¼Œå¦‚æœæ²¡æœ‰å¤§æ‹¬å·ï¼ŒJavaScript å¼•æ“å°±è®¤ä¸ºä¸å­˜åœ¨å—çº§ä½œç”¨åŸŸã€‚</p> <p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹let å’Œ const çš„ç‰¹ç‚¹</p> <h4 id="_1-ä¸å­˜åœ¨å˜é‡æå‡"><a href="#_1-ä¸å­˜åœ¨å˜é‡æå‡" aria-hidden="true" class="header-anchor">#</a> 1.ä¸å­˜åœ¨å˜é‡æå‡</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// var çš„æƒ…å†µ</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¾“å‡ºundefined</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token comment">// let çš„æƒ…å†µ</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æŠ¥é”™ReferenceError</span>
<span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_2-é‡å¤å£°æ˜æŠ¥é”™"><a href="#_2-é‡å¤å£°æ˜æŠ¥é”™" aria-hidden="true" class="header-anchor">#</a> 2.é‡å¤å£°æ˜æŠ¥é”™</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// æŠ¥é”™</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æŠ¥é”™</span>
<span class="token keyword">function</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-ä¸ç»‘å®šå…¨å±€ä½œç”¨åŸŸ"><a href="#_3-ä¸ç»‘å®šå…¨å±€ä½œç”¨åŸŸ" aria-hidden="true" class="header-anchor">#</a> 3.ä¸ç»‘å®šå…¨å±€ä½œç”¨åŸŸ</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">// å¦‚æœåœ¨ Node çš„ REPL ç¯å¢ƒï¼Œå¯ä»¥å†™æˆ global.a</span>
<span class="token comment">// æˆ–è€…é‡‡ç”¨é€šç”¨æ–¹æ³•ï¼Œå†™æˆ this.a</span>
window<span class="token punctuation">.</span>a <span class="token comment">// 1</span>

<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>b <span class="token comment">// undefined</span>
</code></pre></div><h4 id="_4-æš‚æ—¶æ€§æ­»åŒº"><a href="#_4-æš‚æ—¶æ€§æ­»åŒº" aria-hidden="true" class="header-anchor">#</a> 4. æš‚æ—¶æ€§æ­»åŒº</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> tmp <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  tmp <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
  <span class="token keyword">let</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ES6 æ˜ç¡®è§„å®šï¼Œå¦‚æœåŒºå—ä¸­å­˜åœ¨letå’Œconstå‘½ä»¤ï¼Œè¿™ä¸ªåŒºå—å¯¹è¿™äº›å‘½ä»¤å£°æ˜çš„å˜é‡ï¼Œä»ä¸€å¼€å§‹å°±å½¢æˆäº†å°é—­ä½œç”¨åŸŸã€‚å‡¡æ˜¯åœ¨å£°æ˜ä¹‹å‰å°±ä½¿ç”¨è¿™äº›å˜é‡ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p> <p>æ€»ä¹‹ï¼Œåœ¨ä»£ç å—å†…ï¼Œä½¿ç”¨letå‘½ä»¤å£°æ˜å˜é‡ä¹‹å‰ï¼Œè¯¥å˜é‡éƒ½æ˜¯ä¸å¯ç”¨çš„ã€‚è¿™åœ¨è¯­æ³•ä¸Šï¼Œç§°ä¸ºâ€œæš‚æ—¶æ€§æ­»åŒºâ€ï¼ˆtemporal dead zoneï¼Œç®€ç§° TDZï¼‰ã€‚</p> <h4 id="let-ä¸-const-åŒºåˆ«"><a href="#let-ä¸-const-åŒºåˆ«" aria-hidden="true" class="header-anchor">#</a> let ä¸ const åŒºåˆ«</h4> <p>const ç”¨äºå£°æ˜å¸¸é‡ï¼Œå…¶å€¼ä¸€æ—¦è¢«è®¾å®šä¸èƒ½å†è¢«ä¿®æ”¹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p> <p>constå®é™…ä¸Šä¿è¯çš„ï¼Œå¹¶ä¸æ˜¯å˜é‡çš„å€¼ä¸å¾—æ”¹åŠ¨ï¼Œè€Œæ˜¯å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€æ‰€ä¿å­˜çš„æ•°æ®ä¸å¾—æ”¹åŠ¨ã€‚å¯¹äºç®€å•ç±»å‹çš„æ•°æ®ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ï¼‰ï¼Œå€¼å°±ä¿å­˜åœ¨å˜é‡æŒ‡å‘çš„é‚£ä¸ªå†…å­˜åœ°å€ï¼Œå› æ­¤ç­‰åŒäºå¸¸é‡ã€‚ä½†å¯¹äºå¤åˆç±»å‹çš„æ•°æ®ï¼ˆä¸»è¦æ˜¯å¯¹è±¡å’Œæ•°ç»„ï¼‰ï¼Œå˜é‡æŒ‡å‘çš„å†…å­˜åœ°å€ï¼Œä¿å­˜çš„åªæ˜¯ä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®çš„æŒ‡é’ˆã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token comment">// æ²¡æœ‰é—®é¢˜</span>
data<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
data<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token comment">// æŠ¥é”™</span>
data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// Uncaught TypeError: Assignment to constant variable.</span>
</code></pre></div><h2 id="arrow-function"><a href="#arrow-function" aria-hidden="true" class="header-anchor">#</a> arrow function</h2> <h3 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" aria-hidden="true" class="header-anchor">#</a> åŸºæœ¬è¯­æ³•</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token parameter">v</span> <span class="token operator">=&gt;</span> v<span class="token punctuation">;</span>

<span class="token comment">// ç­‰åŒäº</span>
<span class="token keyword">var</span> <span class="token function-variable function">f</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å¦‚æœéœ€è¦ç»™å‡½æ•°ä¼ å…¥å¤šä¸ªå‚æ•°ï¼š</span>
<span class="token keyword">let</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> value <span class="token operator">*</span> num<span class="token punctuation">;</span>

<span class="token comment">// å¦‚æœå‡½æ•°çš„ä»£ç å—éœ€è¦å¤šæ¡è¯­å¥ï¼š</span>
<span class="token keyword">let</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token operator">*</span> num
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//å¦‚æœéœ€è¦ç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼šéœ€è¦ä½¿ç”¨æ‹¬å·æ‹¬èµ·æ¥ </span>
<span class="token keyword">let</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> num</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>total<span class="token punctuation">:</span> value <span class="token operator">*</span> num<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//ä¸å˜é‡è§£æ„ç»“åˆï¼š</span>
<span class="token keyword">let</span> <span class="token function-variable function">func</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>value<span class="token punctuation">,</span> num<span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>total<span class="token punctuation">:</span> value <span class="token operator">*</span> num<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ä½¿ç”¨</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
    num<span class="token punctuation">:</span> <span class="token number">10</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {total: 100}</span>
</code></pre></div><h3 id="ä½¿ç”¨æ³¨æ„ç‚¹"><a href="#ä½¿ç”¨æ³¨æ„ç‚¹" aria-hidden="true" class="header-anchor">#</a> ä½¿ç”¨æ³¨æ„ç‚¹</h3> <h4 id="æ²¡æœ‰this"><a href="#æ²¡æœ‰this" aria-hidden="true" class="header-anchor">#</a> æ²¡æœ‰this</h4> <p>å‡½æ•°ä½“å†…çš„thiså¯¹è±¡ï¼Œå°±æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ—¶æ‰€åœ¨çš„å¯¹è±¡ã€‚</p> <p>thisæŒ‡å‘çš„å›ºå®šåŒ–ï¼Œå¹¶ä¸æ˜¯å› ä¸ºç®­å¤´å‡½æ•°å†…éƒ¨æœ‰ç»‘å®šthisçš„æœºåˆ¶ï¼Œå®é™…åŸå› æ˜¯ç®­å¤´å‡½æ•°æ ¹æœ¬æ²¡æœ‰è‡ªå·±çš„thisï¼Œå¯¼è‡´å†…éƒ¨çš„thiså°±æ˜¯å¤–å±‚ä»£ç å—çš„thisã€‚æ­£æ˜¯å› ä¸ºå®ƒæ²¡æœ‰thisï¼Œæ‰€ä»¥ä¹Ÿå°±ä¸èƒ½ç”¨ä½œæ„é€ å‡½æ•°ã€‚</p> <p>è¿™å°±æ„å‘³ç€å¦‚æœç®­å¤´å‡½æ•°è¢«éç®­å¤´å‡½æ•°åŒ…å«ï¼Œthis ç»‘å®šçš„å°±æ˜¯æœ€è¿‘ä¸€å±‚éç®­å¤´å‡½æ•°çš„ thisã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'id:'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token number">21</span><span class="token punctuation">;</span>

<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// id: 42</span>
</code></pre></div><p>ä¸Šè¿°å‡½æ•°è½¬æ¢ä¸ºES5</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'id:'</span><span class="token punctuation">,</span>_this<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç”±äºç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„thisï¼Œæ‰€ä»¥å½“ç„¶ä¹Ÿå°±ä¸èƒ½ç”¨call()ã€apply()ã€bind()è¿™äº›æ–¹æ³•å»æ”¹å˜thisçš„æŒ‡å‘ã€‚</p> <h4 id="ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ã€ä¸å¯ä»¥ä½¿ç”¨newå‘½ä»¤"><a href="#ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ã€ä¸å¯ä»¥ä½¿ç”¨newå‘½ä»¤" aria-hidden="true" class="header-anchor">#</a> ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ã€ä¸å¯ä»¥ä½¿ç”¨newå‘½ä»¤</h4> <p>JavaScript å‡½æ•°æœ‰ä¸¤ä¸ªå†…éƒ¨æ–¹æ³•ï¼š[[Call]] å’Œ [[Construct]]ã€‚</p> <p>å½“é€šè¿‡ new è°ƒç”¨å‡½æ•°æ—¶ï¼Œæ‰§è¡Œ [[Construct]] æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œç„¶åå†æ‰§è¡Œå‡½æ•°ä½“ï¼Œå°† this ç»‘å®šåˆ°å®ä¾‹ä¸Šã€‚</p> <p>å½“ç›´æ¥è°ƒç”¨çš„æ—¶å€™ï¼Œæ‰§è¡Œ [[Call]] æ–¹æ³•ï¼Œç›´æ¥æ‰§è¡Œå‡½æ•°ä½“ã€‚</p> <p>ç®­å¤´å‡½æ•°å¹¶æ²¡æœ‰ [[Construct]] æ–¹æ³•ï¼Œä¸èƒ½è¢«ç”¨ä½œæ„é€ å‡½æ•°ï¼Œå¦‚æœé€šè¿‡ new çš„æ–¹å¼è°ƒç”¨ï¼Œä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">Foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Foo is not a constructor</span>
</code></pre></div><h4 id="ä¸å¯ä»¥ä½¿ç”¨argumentså¯¹è±¡"><a href="#ä¸å¯ä»¥ä½¿ç”¨argumentså¯¹è±¡" aria-hidden="true" class="header-anchor">#</a> ä¸å¯ä»¥ä½¿ç”¨argumentså¯¹è±¡</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'args:'</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token comment">// args: [2, 4, 6, 8]</span>
</code></pre></div><p>ä¸Šé¢ä»£ç ä¸­ï¼Œç®­å¤´å‡½æ•°å†…éƒ¨çš„å˜é‡argumentsï¼Œå…¶å®æ˜¯å‡½æ•°fooçš„argumentså˜é‡ã€‚</p> <p>ä½ å¯ä»¥é€šè¿‡å‘½åå‚æ•°æˆ–è€… rest å‚æ•°çš„å½¢å¼è®¿é—®å‚æ•°:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">nums</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>nums</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> nums<span class="token punctuation">;</span>
</code></pre></div><h2 id="symbol"><a href="#symbol" aria-hidden="true" class="header-anchor">#</a> Symbol</h2> <p>ES6 å¼•å…¥äº†ä¸€ç§æ–°çš„åŸå§‹æ•°æ®ç±»å‹ Symbolï¼Œè¡¨ç¤ºç‹¬ä¸€æ— äºŒçš„å€¼ã€‚</p> <h3 id="åŸºæœ¬ç”¨æ³•"><a href="#åŸºæœ¬ç”¨æ³•" aria-hidden="true" class="header-anchor">#</a> åŸºæœ¬ç”¨æ³•</h3> <h4 id="_1-symbol-å€¼é€šè¿‡-symbol-å‡½æ•°ç”Ÿæˆï¼Œä½¿ç”¨-typeofï¼Œç»“æœä¸º-symbol"><a href="#_1-symbol-å€¼é€šè¿‡-symbol-å‡½æ•°ç”Ÿæˆï¼Œä½¿ç”¨-typeofï¼Œç»“æœä¸º-symbol" aria-hidden="true" class="header-anchor">#</a> 1. Symbol å€¼é€šè¿‡ Symbol å‡½æ•°ç”Ÿæˆï¼Œä½¿ç”¨ typeofï¼Œç»“æœä¸º &quot;symbol&quot;</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;symbol&quot;</span>
</code></pre></div><h4 id="_2-symbol-å‡½æ•°å‰ä¸èƒ½ä½¿ç”¨-new-å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºç”Ÿæˆçš„-symbol-æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¸æ˜¯å¯¹è±¡ã€‚"><a href="#_2-symbol-å‡½æ•°å‰ä¸èƒ½ä½¿ç”¨-new-å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºç”Ÿæˆçš„-symbol-æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¸æ˜¯å¯¹è±¡ã€‚" aria-hidden="true" class="header-anchor">#</a> 2. Symbol å‡½æ•°å‰ä¸èƒ½ä½¿ç”¨ new å‘½ä»¤ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºç”Ÿæˆçš„ Symbol æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¸æ˜¯å¯¹è±¡ã€‚</h4> <h4 id="_3-instanceof-çš„ç»“æœä¸º-false"><a href="#_3-instanceof-çš„ç»“æœä¸º-false" aria-hidden="true" class="header-anchor">#</a> 3. instanceof çš„ç»“æœä¸º false</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>s <span class="token keyword">instanceof</span> <span class="token class-name">Symbol</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre></div><h4 id="_4-ç›¸åŒå‚æ•°çš„-symbol-å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸ç›¸ç­‰çš„ã€‚"><a href="#_4-ç›¸åŒå‚æ•°çš„-symbol-å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸ç›¸ç­‰çš„ã€‚" aria-hidden="true" class="header-anchor">#</a> 4. ç›¸åŒå‚æ•°çš„ Symbol å‡½æ•°çš„è¿”å›å€¼æ˜¯ä¸ç›¸ç­‰çš„ã€‚</h4> <h4 id="_5-symbol-å€¼ä¸èƒ½ä¸å…¶ä»–ç±»å‹çš„å€¼è¿›è¡Œè¿ç®—ï¼Œä¼šæŠ¥é”™ã€‚"><a href="#_5-symbol-å€¼ä¸èƒ½ä¸å…¶ä»–ç±»å‹çš„å€¼è¿›è¡Œè¿ç®—ï¼Œä¼šæŠ¥é”™ã€‚" aria-hidden="true" class="header-anchor">#</a> 5. Symbol å€¼ä¸èƒ½ä¸å…¶ä»–ç±»å‹çš„å€¼è¿›è¡Œè¿ç®—ï¼Œä¼šæŠ¥é”™ã€‚</h4> <h4 id="_6-symbol-prototype-description"><a href="#_6-symbol-prototype-description" aria-hidden="true" class="header-anchor">#</a> 6. Symbol.prototype.description</h4> <p>åˆ›å»º Symbol çš„æ—¶å€™ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªæè¿°;<code>const sym = Symbol('foo');</code>çš„æè¿°å°±æ˜¯'foo'</p> <h4 id="_7-å±æ€§åçš„éå†"><a href="#_7-å±æ€§åçš„éå†" aria-hidden="true" class="header-anchor">#</a> 7. å±æ€§åçš„éå†</h4> <p>Symbol ä½œä¸ºå±æ€§åï¼Œéå†å¯¹è±¡çš„æ—¶å€™ï¼Œè¯¥å±æ€§ä¸ä¼šå‡ºç°åœ¨<code>for...in</code>ã€<code>for...of</code>å¾ªç¯ä¸­ï¼Œä¹Ÿä¸ä¼šè¢«<code>Object.keys()</code>ã€<code>Object.getOwnPropertyNames()</code>ã€<code>JSON.stringify()</code>è¿”å›ã€‚</p> <p>ä½†æ˜¯ï¼Œå®ƒä¹Ÿä¸æ˜¯ç§æœ‰å±æ€§ï¼Œæœ‰ä¸€ä¸ª<code>Object.getOwnPropertySymbols()</code>æ–¹æ³•ï¼Œå¯ä»¥è·å–æŒ‡å®šå¯¹è±¡çš„æ‰€æœ‰ Symbol å±æ€§åã€‚</p> <p>è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæˆå‘˜æ˜¯å½“å‰å¯¹è±¡çš„æ‰€æœ‰ç”¨ä½œå±æ€§åçš„ Symbol å€¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

obj<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Hello'</span><span class="token punctuation">;</span>
obj<span class="token punctuation">[</span>b<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'World'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> objectSymbols <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertySymbols</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

objectSymbols
<span class="token comment">// [Symbol(a), Symbol(b)]</span>
</code></pre></div><h4 id="_8-symbol-for-symbol-keyfor"><a href="#_8-symbol-for-symbol-keyfor" aria-hidden="true" class="header-anchor">#</a> 8.  Symbol.for() Symbol.keyFor()</h4> <p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é‡æ–°ä½¿ç”¨åŒä¸€ä¸ª Symbol å€¼ï¼ŒSymbol.for()æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å®ƒæ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œç„¶åæœç´¢æœ‰æ²¡æœ‰ä»¥è¯¥å‚æ•°ä½œä¸ºåç§°çš„ Symbol å€¼ã€‚å¦‚æœæœ‰ï¼Œå°±è¿”å›è¿™ä¸ª Symbol å€¼ï¼Œå¦åˆ™å°±æ–°å»ºä¸€ä¸ªä»¥è¯¥å­—ç¬¦ä¸²ä¸ºåç§°çš„ Symbol å€¼ï¼Œå¹¶å°†å…¶æ³¨å†Œåˆ°å…¨å±€ã€‚</p> <p>Symbol.for()ä¸º Symbol å€¼ç™»è®°çš„åå­—ï¼Œæ˜¯å…¨å±€ç¯å¢ƒçš„ï¼Œä¸ç®¡æœ‰æ²¡æœ‰åœ¨å…¨å±€ç¯å¢ƒè¿è¡Œã€‚</p> <p>Symbol.keyFor()æ–¹æ³•è¿”å›ä¸€ä¸ªå·²ç™»è®°çš„ Symbol ç±»å‹å€¼çš„keyã€‚</p> <h3 id="å†…ç½®çš„symbolå€¼"><a href="#å†…ç½®çš„symbolå€¼" aria-hidden="true" class="header-anchor">#</a> å†…ç½®çš„Symbolå€¼</h3> <h4 id="symbol-hasinstance"><a href="#symbol-hasinstance" aria-hidden="true" class="header-anchor">#</a> Symbol.hasInstance</h4> <p>å¯¹è±¡çš„Symbol.hasInstanceå±æ€§ï¼ŒæŒ‡å‘ä¸€ä¸ªå†…éƒ¨æ–¹æ³•ã€‚å½“å…¶ä»–å¯¹è±¡ä½¿ç”¨instanceofè¿ç®—ç¬¦ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºè¯¥å¯¹è±¡çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ï¼Œfoo instanceof Fooåœ¨è¯­è¨€å†…éƒ¨ï¼Œå®é™…è°ƒç”¨çš„æ˜¯Foo<a href="foo">Symbol.hasInstance</a>ã€‚</p> <h4 id="symbol-isconcatspreadable"><a href="#symbol-isconcatspreadable" aria-hidden="true" class="header-anchor">#</a> Symbol.isConcatSpreadable</h4> <p>å¯¹è±¡çš„Symbol.isConcatSpreadableå±æ€§ç­‰äºä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡ç”¨äºArray.prototype.concat()æ—¶ï¼Œæ˜¯å¦å¯ä»¥å±•å¼€ã€‚</p> <p>æ•°ç»„çš„é»˜è®¤è¡Œä¸ºæ˜¯å¯ä»¥å±•å¼€ï¼ŒSymbol.isConcatSpreadableé»˜è®¤ç­‰äºundefinedã€‚è¯¥å±æ€§ç­‰äºtrueæ—¶ï¼Œä¹Ÿæœ‰å±•å¼€çš„æ•ˆæœã€‚</p> <p>ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡æ­£å¥½ç›¸åï¼Œé»˜è®¤ä¸å±•å¼€ã€‚å®ƒçš„Symbol.isConcatSpreadableå±æ€§è®¾ä¸ºtrueï¼Œæ‰å¯ä»¥å±•å¼€ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">let</span> arr1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr1<span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', 'c', 'd', 'e']</span>
arr1<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token comment">// undefined</span>

<span class="token keyword">let</span> arr2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
arr2<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>arr2<span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', ['c','d'], 'e']</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'d'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', obj, 'e']</span>

obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>isConcatSpreadable<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'e'</span><span class="token punctuation">)</span> <span class="token comment">// ['a', 'b', 'c', 'd', 'e']</span>
</code></pre></div><h4 id="ğŸ”¥-symbol-iterator"><a href="#ğŸ”¥-symbol-iterator" aria-hidden="true" class="header-anchor">#</a> ğŸ”¥ Symbol.iterator</h4> <p>å¯¹è±¡çš„Symbol.iteratorå±æ€§ï¼ŒæŒ‡å‘è¯¥å¯¹è±¡çš„é»˜è®¤éå†å™¨æ–¹æ³•ã€‚</p> <div class="language-javasript extra-class"><pre class="language-text"><code>const myIterable = {};
myIterable[Symbol.iterator] = function* () {
  yield 1;
  yield 2;
  yield 3;
};

[...myIterable] // [1, 2, 3]
</code></pre></div><h2 id="set-å’Œ-map"><a href="#set-å’Œ-map" aria-hidden="true" class="header-anchor">#</a> Set å’Œ Map</h2> <h3 id="set"><a href="#set" aria-hidden="true" class="header-anchor">#</a> Set</h3> <p>ES6 æä¾›äº†æ–°çš„æ•°æ®ç»“æ„ Setã€‚å®ƒç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚</p> <p>Set æœ¬èº«æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”ŸæˆSet æ•°æ®ç»“æ„</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="å±æ€§å’Œæ–¹æ³•"><a href="#å±æ€§å’Œæ–¹æ³•" aria-hidden="true" class="header-anchor">#</a> å±æ€§å’Œæ–¹æ³•</h4> <p>å±æ€§ï¼š</p> <ol><li>Set.Prototype.constructor æ„é€ å‡½æ•°ï¼Œé»˜è®¤Set å‡½æ•°</li> <li>Set.Prototype.size  å®ä¾‹çš„æˆå‘˜æ€»æ•°</li></ol> <p>æ–¹æ³•ï¼š</p> <ol><li>Set.Prototype.add(value) æ·»åŠ æŸä¸ªå€¼ è¿”å›Setç»“æ„æœ¬èº«</li> <li>Set.Prototype.delete(value) åˆ é€‰æŸä¸ªå€¼ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºåˆ é™¤æ˜¯å¦æˆåŠŸ</li> <li>Set.Prototype.has(value) åˆ¤æ–­æ˜¯å¦å…·æœ‰å¦å€¼</li> <li>Set.Prototype.clear() æ¸…æ¥šæ‰€æœ‰æˆå‘˜ æ²¡æœ‰è¿”å›å€¼</li></ol> <p>æ³¨æ„ åœ¨Set å†…éƒ¨è®¤ä¸ºNaN æ˜¯ç›¸ç­‰çš„</p> <p>éå†æ–¹æ³•æœ‰ï¼š</p> <p>keys()ï¼šè¿”å›é”®åçš„éå†å™¨</p> <p>values()ï¼šè¿”å›é”®å€¼çš„éå†å™¨</p> <p>entries()ï¼šè¿”å›é”®å€¼å¯¹çš„éå†å™¨</p> <p>forEach()ï¼šä½¿ç”¨å›è°ƒå‡½æ•°éå†æ¯ä¸ªæˆå‘˜ï¼Œæ— è¿”å›å€¼</p> <h4 id="ä½œç”¨"><a href="#ä½œç”¨" aria-hidden="true" class="header-anchor">#</a> ä½œç”¨</h4> <p>æ•°ç»„å»é‡</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>s<span class="token punctuation">]</span> <span class="token comment">// 1,2,3,4</span>
</code></pre></div><h3 id="weakset"><a href="#weakset" aria-hidden="true" class="header-anchor">#</a> WeakSet</h3> <p>WeakSet ç»“æ„ä¸ Setç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸é‡å¤çš„å€¼çš„é›†åˆã€‚ä½†æ˜¯å®ƒä¸Setæœ‰ä¸¤ä¸ªåŒºåˆ«ã€‚</p> <ol><li><p>WeakSet çš„æˆå‘˜åªèƒ½æ˜¯å¯¹è±¡ï¼Œè€Œä¸èƒ½æ˜¯å…¶ä»–ç±»å‹çš„å€¼ã€‚ï¼ˆå®é™…ä¸Šï¼Œä»»ä½•å…·æœ‰ Iterable æ¥å£çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥ä½œä¸º WeakSet çš„å‚æ•°ã€‚ï¼‰</p></li> <li><p>WeakSet ä¸­çš„å¯¹è±¡éƒ½æ˜¯å¼±å¼•ç”¨ï¼Œå³åƒåœ¾å›æ”¶æœºåˆ¶ä¸è€ƒè™‘ WeakSet å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚</p></li></ol> <p>è¯­æ³•ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeakSet</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// WeakSet {[1, 2], [3, 4]}</span>
</code></pre></div><p>WeakSet ç»“æ„æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹æ³•ã€‚</p> <ul><li>WeakSet.prototype.add(value)ï¼šå‘ WeakSet å®ä¾‹æ·»åŠ ä¸€ä¸ªæ–°æˆå‘˜ã€‚</li> <li>WeakSet.prototype.delete(value)ï¼šæ¸…é™¤ WeakSet å®ä¾‹çš„æŒ‡å®šæˆå‘˜ã€‚</li> <li>WeakSet.prototype.has(value)ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªå€¼æ˜¯å¦åœ¨ WeakSet å®ä¾‹ä¹‹ä¸­ã€‚</li></ul> <h3 id="map"><a href="#map" aria-hidden="true" class="header-anchor">#</a> Map</h3> <p>JavaScript çš„å¯¹è±¡ï¼ˆObjectï¼‰ï¼Œæœ¬è´¨ä¸Šæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼ˆHash ç»“æ„ï¼‰ï¼Œä½†æ˜¯ä¼ ç»Ÿä¸Šåªèƒ½ç”¨å­—ç¬¦ä¸²å½“ä½œé”®ã€‚è¿™ç»™å®ƒçš„ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„é™åˆ¶ã€‚</p> <p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒES6 æä¾›äº† Map æ•°æ®ç»“æ„ã€‚å®ƒç±»ä¼¼äºå¯¹è±¡ï¼Œä¹Ÿæ˜¯é”®å€¼å¯¹çš„é›†åˆï¼Œä½†æ˜¯â€œé”®â€çš„èŒƒå›´ä¸é™äºå­—ç¬¦ä¸²ï¼Œå„ç§ç±»å‹çš„å€¼ï¼ˆåŒ…æ‹¬å¯¹è±¡ï¼‰éƒ½å¯ä»¥å½“ä½œé”®ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'å¼ ä¸‰'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">,</span> <span class="token string">'Author'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

map<span class="token punctuation">.</span>size <span class="token comment">// 2</span>
map<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;å¼ ä¸‰&quot;</span>
map<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span> <span class="token comment">// &quot;Author&quot;</span>
</code></pre></div><h4 id="å±æ€§å’Œæ–¹æ³•-2"><a href="#å±æ€§å’Œæ–¹æ³•-2" aria-hidden="true" class="header-anchor">#</a> å±æ€§å’Œæ–¹æ³•</h4> <ol><li><p>sizeå±æ€§è¿”å› Map ç»“æ„çš„æˆå‘˜æ€»æ•°ã€‚</p></li> <li><p>Map.prototype.set(key, value)</p></li></ol> <p>setæ–¹æ³•è®¾ç½®é”®åkeyå¯¹åº”çš„é”®å€¼ä¸ºvalueï¼Œç„¶åè¿”å›æ•´ä¸ª Map ç»“æ„ã€‚å¦‚æœkeyå·²ç»æœ‰å€¼ï¼Œåˆ™é”®å€¼ä¼šè¢«æ›´æ–°ï¼Œå¦åˆ™å°±æ–°ç”Ÿæˆè¯¥é”®ã€‚</p> <ol start="3"><li>Map.prototype.get(key)</li></ol> <p>getæ–¹æ³•è¯»å–keyå¯¹åº”çš„é”®å€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°keyï¼Œè¿”å›undefinedã€‚</p> <ol start="4"><li><p>Map.prototype.has(key)
hasæ–¹æ³•è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæŸä¸ªé”®æ˜¯å¦åœ¨å½“å‰ Map å¯¹è±¡ä¹‹ä¸­ã€‚</p></li> <li><p>Map.prototype.delete(key)
deleteæ–¹æ³•åˆ é™¤æŸä¸ªé”®ï¼Œè¿”å›trueã€‚å¦‚æœåˆ é™¤å¤±è´¥ï¼Œè¿”å›falseã€‚</p></li> <li><p>Map.prototype.clear()</p></li></ol> <p>clearæ–¹æ³•æ¸…é™¤æ‰€æœ‰æˆå‘˜ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚</p> <h4 id="éå†"><a href="#éå†" aria-hidden="true" class="header-anchor">#</a> éå†</h4> <p>Map ç»“æ„åŸç”Ÿæä¾›ä¸‰ä¸ªéå†å™¨ç”Ÿæˆå‡½æ•°å’Œä¸€ä¸ªéå†æ–¹æ³•ã€‚</p> <p>Map.prototype.keys()ï¼šè¿”å›é”®åçš„éå†å™¨ã€‚</p> <p>Map.prototype.values()ï¼šè¿”å›é”®å€¼çš„éå†å™¨ã€‚</p> <p>Map.prototype.entries()ï¼šè¿”å›æ‰€æœ‰æˆå‘˜çš„éå†å™¨ã€‚</p> <p>Map.prototype.forEach()ï¼šéå† Map çš„æ‰€æœ‰æˆå‘˜ã€‚</p> <h3 id="weakmap"><a href="#weakmap" aria-hidden="true" class="header-anchor">#</a> WeakMap</h3> <p>WeakMapç»“æ„ä¸Mapç»“æ„ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ç”¨äºç”Ÿæˆé”®å€¼å¯¹çš„é›†åˆã€‚ä½†æ˜¯WeakMapä¸Mapçš„åŒºåˆ«æœ‰ä¸¤ç‚¹ã€‚</p> <ol><li><p>WeakMapåªæ¥å—å¯¹è±¡ä½œä¸ºé”®åï¼ˆnullé™¤å¤–ï¼‰ï¼Œä¸æ¥å—å…¶ä»–ç±»å‹çš„å€¼ä½œä¸ºé”®åã€‚</p></li> <li><p>WeakMapçš„é”®åæ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¸è®¡å…¥åƒåœ¾å›æ”¶æœºåˆ¶ã€‚</p></li></ol> <h2 id="proxy-å’Œ-defineproperty"><a href="#proxy-å’Œ-defineproperty" aria-hidden="true" class="header-anchor">#</a> Proxy å’Œ defineProperty</h2> <h3 id="defineproperty"><a href="#defineproperty" aria-hidden="true" class="header-anchor">#</a> defineProperty</h3> <p>ES5 æä¾›äº† Object.defineProperty æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥åœ¨ä¸€ä¸ªå¯¹è±¡ä¸Šå®šä¹‰ä¸€ä¸ªæ–°å±æ€§ï¼Œæˆ–è€…ä¿®æ”¹ä¸€ä¸ªå¯¹è±¡çš„ç°æœ‰å±æ€§ï¼Œå¹¶è¿”å›è¿™ä¸ªå¯¹è±¡</p> <p>è¯­æ³•ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> descriptor<span class="token punctuation">)</span>
</code></pre></div><p>å‚æ•°ï¼š</p> <ul><li>obj è¦å®šä¹‰å±æ€§çš„å¯¹è±¡ã€‚</li> <li>prop è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§çš„åç§°æˆ– Symbol ã€‚</li> <li>descriptor è¦å®šä¹‰æˆ–ä¿®æ”¹çš„å±æ€§æè¿°ç¬¦ã€‚</li></ul> <p>è¿”å›å€¼ï¼šè¢«ä¼ é€’ç»™å‡½æ•°çš„å¯¹è±¡</p> <p>ä¸¾ä¸ªä¾‹å­</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡</span>

<span class="token comment">// åœ¨å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå±æ€§ä¸æ•°æ®æè¿°ç¬¦çš„ç¤ºä¾‹</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value <span class="token punctuation">:</span> <span class="token number">37</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ä½ å¯èƒ½ä¼šè§‰å¾—ç»™ä¸€ä¸ªå¯¹è±¡å®šä¹‰ä¸€ä¸ªæ–°å±æ€§éœ€è¦è¿™ä¹ˆéº»çƒ¦å— æœ‰å¿…è¦å— ç›´æ¥èµ‹å€¼ä¸å°±è¡Œäº† é‚£æ¥ä¸‹æ¥æˆ‘ä»¬åšä¸ªå¯¹æ¯” çœ‹çœ‹å·®åˆ«ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
obj1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'obj1'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [&quot;name&quot;]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// obj1</span>
obj1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'obj3'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>num<span class="token punctuation">)</span> <span class="token comment">//  obj3</span>
<span class="token keyword">delete</span> obj1<span class="token punctuation">.</span>name
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// undefined</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  value<span class="token punctuation">:</span><span class="token string">'obj2'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// []</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// obj2</span>
obj2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'obj3'</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// obj2</span>
<span class="token keyword">delete</span> obj2<span class="token punctuation">.</span>name
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// obj2</span>
</code></pre></div><p>å¯¹æ¯”ä¼šå‘ç°é€šè¿‡definePropertyå®šä¹‰çš„å¯¹è±¡å±æ€§ç«Ÿç„¶ä¸èƒ½è¢«ä¿®æ”¹å’Œåˆ é™¤å’Œè¢«æšä¸¾ è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ã€‚é‚£å°±æ¥ä¸‹å¾€ä¸‹</p> <h4 id="descriptor"><a href="#descriptor" aria-hidden="true" class="header-anchor">#</a> descriptor</h4> <p>å¯¹è±¡é‡Œç›®å‰å­˜åœ¨çš„å±æ€§æè¿°ç¬¦ä¸»è¦æœ‰2ç§å½¢å¼ï¼š<strong>æ•°æ®æè¿°ç¬¦</strong> å’Œ <strong>å­˜å–æè¿°ç¬¦</strong></p> <p>æ•°æ®æè¿°ç¬¦æ˜¯ä¸€ä¸ªå…·æœ‰å€¼çš„å±æ€§ï¼Œè¯¥å€¼å¯ä»¥æ˜¯å¯å†™çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸å¯å†™çš„ã€‚</p> <p>å­˜å–æè¿°ç¬¦æ˜¯ç”± getter å‡½æ•°å’Œ setter å‡½æ•°æ‰€æè¿°çš„å±æ€§ã€‚</p> <h5 id="ä¸¤è€…å‡å…·æœ‰ä»¥ä¸‹ä¸¤ç§é”®å€¼ï¼š"><a href="#ä¸¤è€…å‡å…·æœ‰ä»¥ä¸‹ä¸¤ç§é”®å€¼ï¼š" aria-hidden="true" class="header-anchor">#</a> ä¸¤è€…å‡å…·æœ‰ä»¥ä¸‹ä¸¤ç§é”®å€¼ï¼š</h5> <p><strong>configurable</strong></p> <p><code>å½“ä¸”ä»…å½“è¯¥å±æ€§çš„ configurable é”®å€¼ä¸º true æ—¶ï¼Œè¯¥å±æ€§çš„**æè¿°ç¬¦**æ‰èƒ½å¤Ÿè¢«æ”¹å˜ï¼ŒåŒæ—¶è¯¥å±æ€§ä¹Ÿèƒ½ä»å¯¹åº”çš„å¯¹è±¡ä¸Šè¢«åˆ é™¤ã€‚ é»˜è®¤å€¼ false</code></p> <p><strong>enumerable</strong></p> <p><code>å½“ä¸”ä»…å½“è¯¥å±æ€§çš„ enumerable é”®å€¼ä¸º true æ—¶ï¼Œè¯¥å±æ€§æ‰ä¼šå‡ºç°åœ¨å¯¹è±¡çš„æšä¸¾å±æ€§ä¸­ é»˜è®¤å€¼ false</code></p> <h5 id="æ•°æ®æè¿°ç¬¦è¿˜å…·æœ‰ä»¥ä¸‹å¯é€‰é”®å€¼ï¼š"><a href="#æ•°æ®æè¿°ç¬¦è¿˜å…·æœ‰ä»¥ä¸‹å¯é€‰é”®å€¼ï¼š" aria-hidden="true" class="header-anchor">#</a> æ•°æ®æè¿°ç¬¦è¿˜å…·æœ‰ä»¥ä¸‹å¯é€‰é”®å€¼ï¼š</h5> <p><strong>value</strong></p> <p><code>è¯¥å±æ€§å¯¹åº”çš„å€¼ã€‚å¯ä»¥æ˜¯ä»»ä½•æœ‰æ•ˆçš„ JavaScript å€¼ï¼ˆæ•°å€¼ï¼Œå¯¹è±¡ï¼Œå‡½æ•°ç­‰ï¼‰ã€‚é»˜è®¤ä¸º undefined</code></p> <p><strong>writable</strong></p> <p><code>å½“ä¸”ä»…å½“è¯¥å±æ€§çš„ writable é”®å€¼ä¸º true æ—¶ï¼Œå±æ€§çš„å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„ valueï¼Œæ‰èƒ½è¢«èµ‹å€¼è¿ç®—ç¬¦æ”¹å˜ã€‚ é»˜è®¤ä¸º falseã€‚</code></p> <h4 id="å­˜å–æè¿°ç¬¦è¿˜å…·æœ‰ä»¥ä¸‹å¯é€‰é”®å€¼ï¼š"><a href="#å­˜å–æè¿°ç¬¦è¿˜å…·æœ‰ä»¥ä¸‹å¯é€‰é”®å€¼ï¼š" aria-hidden="true" class="header-anchor">#</a> å­˜å–æè¿°ç¬¦è¿˜å…·æœ‰ä»¥ä¸‹å¯é€‰é”®å€¼ï¼š</h4> <p><strong>get</strong></p> <p><code>å±æ€§çš„ getter å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ getterï¼Œåˆ™ä¸º undefinedã€‚å½“è®¿é—®è¯¥å±æ€§æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚æ‰§è¡Œæ—¶ä¸ä¼ å…¥ä»»ä½•å‚æ•°ï¼Œä½†æ˜¯ä¼šä¼ å…¥ this å¯¹è±¡ï¼ˆç”±äºç»§æ‰¿å…³ç³»ï¼Œè¿™é‡Œçš„thiså¹¶ä¸ä¸€å®šæ˜¯å®šä¹‰è¯¥å±æ€§çš„å¯¹è±¡ï¼‰ã€‚è¯¥å‡½æ•°çš„è¿”å›å€¼ä¼šè¢«ç”¨ä½œå±æ€§çš„å€¼ã€‚é»˜è®¤ä¸º undefinedã€‚</code></p> <p><strong>set</strong></p> <p><code>å±æ€§çš„ setter å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ setterï¼Œåˆ™ä¸º undefinedã€‚å½“å±æ€§å€¼è¢«ä¿®æ”¹æ—¶ï¼Œä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯è¢«èµ‹äºˆçš„æ–°å€¼ï¼‰ï¼Œä¼šä¼ å…¥èµ‹å€¼æ—¶çš„ this å¯¹è±¡ã€‚ é»˜è®¤ä¸º undefined</code></p> <p><strong>æ³¨æ„ç‚¹ï¼š ä¸€ä¸ªæè¿°ç¬¦åªèƒ½æ˜¯è¿™ä¸¤è€…å…¶ä¸­ä¹‹ä¸€ï¼›ä¸èƒ½åŒæ—¶æ˜¯ä¸¤è€…ã€‚</strong></p> <p>æ­¤å¤–ï¼Œæ‰€æœ‰çš„å±æ€§æè¿°ç¬¦éƒ½æ˜¯éå¿…é¡»çš„ï¼Œä½†æ˜¯ descriptor è¿™ä¸ªå­—æ®µæ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸è¿›è¡Œä»»ä½•é…ç½®ï¼Œä½ å¯ä»¥è¿™æ ·ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre></div><h3 id="setters-å’Œ-getters"><a href="#setters-å’Œ-getters" aria-hidden="true" class="header-anchor">#</a> Setters å’Œ Getters</h3> <p>å­˜å–æè¿°ç¬¦ä¸­çš„ get å’Œ setï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•åˆè¢«ç§°ä¸º getter å’Œ setterã€‚ç”± getter å’Œ setter å®šä¹‰çš„å±æ€§ç§°åšâ€å­˜å–å™¨å±æ€§â€œã€‚</p> <p>å½“ç¨‹åºæŸ¥è¯¢å­˜å–å™¨å±æ€§çš„å€¼æ—¶ï¼ŒJavaScript è°ƒç”¨ getteræ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼å°±æ˜¯å±æ€§å­˜å–è¡¨è¾¾å¼çš„å€¼ã€‚</p> <p>å½“ç¨‹åºè®¾ç½®ä¸€ä¸ªå­˜å–å™¨å±æ€§çš„å€¼æ—¶ï¼ŒJavaScript è°ƒç”¨ setter æ–¹æ³•ï¼Œå°†èµ‹å€¼è¡¨è¾¾å¼å³ä¾§çš„å€¼å½“åšå‚æ•°ä¼ å…¥ setterã€‚ä»æŸç§æ„ä¹‰ä¸Šè®²ï¼Œè¿™ä¸ªæ–¹æ³•è´Ÿè´£â€œè®¾ç½®â€å±æ€§å€¼ã€‚å¯ä»¥å¿½ç•¥ setter æ–¹æ³•çš„è¿”å›å€¼ã€‚</p> <p>ä¸¾ä¸ªä¾‹å­ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">&quot;num&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ‰§è¡Œäº† get æ“ä½œ'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">newValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'æ‰§è¡Œäº† set æ“ä½œ'</span><span class="token punctuation">)</span>
        value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

obj<span class="token punctuation">.</span>num <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment">// æ‰§è¡Œäº† set æ“ä½œ</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// æ‰§è¡Œäº† get æ“ä½œ // 1</span>
</code></pre></div><p>è¿™æ ·æ˜¯ä¸æ˜¯è¿›è¡Œäº†æ•°æ®ç›‘å¬ï¼Œæ•°æ®çš„æ”¹å˜å¯ä»¥æ„ŸçŸ¥åˆ°ã€‚</p> <h3 id="æ•°æ®ç›‘å¬"><a href="#æ•°æ®ç›‘å¬" aria-hidden="true" class="header-anchor">#</a> æ•°æ®ç›‘å¬</h3> <p>ç°åœ¨æœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œé¡µé¢ä¸­æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œæ¯ç‚¹å‡»ä¸€æ¬¡æŒ‰é’®æ•°å€¼éƒ½åŠ 1ï¼Œæ•°å€¼åœ¨é¡µé¢ä¸­æ˜¾ç¤ºã€‚è¿™æ”¹å¦‚ä½•å®ç°å‘¢ã€‚</p> <p>html ä¼ªä»£ç ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;number&quot;</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">&quot;button&quot;</span><span class="token operator">&gt;</span>ç‚¹å‡»<span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre></div><p>åŸç”Ÿjså®ç°ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> num <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  num<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>num<span class="token punctuation">.</span>innerHTML<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>é‚£ä¸Šé¢æ‰¯äº†é‚£ä¹ˆå¤šï¼Œæ˜¯ä¸æ˜¯è¯´æ˜ä½¿ç”¨defineProperty ä¹Ÿå¯ä»¥å®ç°å‘¢</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> num <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'number'</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  num<span class="token punctuation">:</span><span class="token number">1</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> value <span class="token operator">=</span> obj<span class="token punctuation">.</span>num<span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span><span class="token string">'num'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> value
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    value <span class="token operator">=</span> val<span class="token punctuation">;</span> <span class="token comment">// è¿™é‡Œä¸èƒ½ obj.num = newValue æ‰€ä»¥éœ€è¦æ–°è®¾ç½®ä¸€ä¸ªvalueå˜é‡æš‚å­˜ä¸‹å€¼</span>
    num<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  obj<span class="token punctuation">.</span>num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>æŸäº›åŒå­¦å¯èƒ½ä¼šè§‰å¾—ä»£ç åè€Œå˜å¤šäº†è€Œä¸”é€šç”¨æ€§ä¸æï¼Œé‚£å°±å°è£…ä¸€ä¸‹ã€‚</p> <h4 id="watch"><a href="#watch" aria-hidden="true" class="header-anchor">#</a> watch</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">watch</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span>name<span class="token punctuation">,</span>fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> value <span class="token operator">=</span> obj<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>name<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> name
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      value <span class="token operator">=</span> val
      <span class="token function">fn</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> obj<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value
<span class="token punctuation">}</span>
</code></pre></div><h3 id="proxy"><a href="#proxy" aria-hidden="true" class="header-anchor">#</a> Proxy</h3> <p>Proxy ç”¨äºä¿®æ”¹æŸäº›æ“ä½œçš„é»˜è®¤è¡Œä¸ºï¼Œç­‰åŒäºåœ¨è¯­è¨€å±‚é¢åšå‡ºä¿®æ”¹ï¼Œæ‰€ä»¥å±äºä¸€ç§â€œå…ƒç¼–ç¨‹â€ï¼ˆmeta programmingï¼‰ï¼Œå³å¯¹ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç¨‹ã€‚</p> <p>Proxy å¯ä»¥ç†è§£æˆï¼Œåœ¨ç›®æ ‡å¯¹è±¡ä¹‹å‰æ¶è®¾ä¸€å±‚â€œæ‹¦æˆªâ€ï¼Œå¤–ç•Œå¯¹è¯¥å¯¹è±¡çš„è®¿é—®ï¼Œéƒ½å¿…é¡»å…ˆé€šè¿‡è¿™å±‚æ‹¦æˆªï¼Œå› æ­¤æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¯ä»¥å¯¹å¤–ç•Œçš„è®¿é—®è¿›è¡Œè¿‡æ»¤å’Œæ”¹å†™ã€‚</p> <p>ES6 åŸç”Ÿæä¾› Proxy æ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”Ÿæˆ Proxy å®ä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>handler<span class="token punctuation">)</span>
</code></pre></div><p>Proxy å¯¹è±¡çš„æ‰€æœ‰ç”¨æ³•ï¼Œéƒ½æ˜¯ä¸Šé¢è¿™ç§å½¢å¼ï¼Œä¸åŒçš„åªæ˜¯handlerå‚æ•°çš„å†™æ³•ã€‚å…¶ä¸­ï¼Œnew Proxy()è¡¨ç¤ºç”Ÿæˆä¸€ä¸ªProxyå®ä¾‹ï¼Œtargetå‚æ•°è¡¨ç¤ºæ‰€è¦æ‹¦æˆªçš„ç›®æ ‡å¯¹è±¡ï¼Œhandlerå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œç”¨æ¥å®šåˆ¶æ‹¦æˆªè¡Œä¸ºã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> propKey</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">35</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>propKey<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    target<span class="token punctuation">[</span>propkey<span class="token punctuation">]</span> <span class="token operator">=</span> value
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

proxy<span class="token punctuation">.</span>time <span class="token comment">// 35</span>
proxy<span class="token punctuation">.</span>name <span class="token comment">// 35</span>
proxy<span class="token punctuation">.</span>title <span class="token comment">// 35</span>
</code></pre></div><p>æ³¨æ„ï¼Œè¦ä½¿å¾—Proxyèµ·ä½œç”¨ï¼Œå¿…é¡»é’ˆå¯¹Proxyå®ä¾‹ï¼ˆä¸Šä¾‹æ˜¯proxyå¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç›®æ ‡å¯¹è±¡ï¼ˆä¸Šä¾‹æ˜¯ç©ºå¯¹è±¡ï¼‰è¿›è¡Œæ“ä½œã€‚</p> <p>Proxyæ”¯æŒçš„æ‹¦æˆªæ“ä½œï¼Œå…± 13 ç§ï¼š</p> <ol><li><strong>get(target, propKey, receiver)</strong>ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è¯»å–ï¼Œæ¯”å¦‚proxy.fooå’Œproxy['foo']ã€‚</li> <li><strong>set(target, propKey, value, receiver)</strong>ï¼šæ‹¦æˆªå¯¹è±¡å±æ€§çš„è®¾ç½®ï¼Œæ¯”å¦‚proxy.foo = væˆ–proxy['foo'] = vï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li> <li><strong>has(target, propKey)</strong>ï¼šæ‹¦æˆªpropKey in proxyçš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li> <li><strong>deleteProperty(target, propKey)</strong>ï¼šæ‹¦æˆªdelete proxy[propKey]çš„æ“ä½œï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li> <li><strong>ownKeys(target)</strong>ï¼šæ‹¦æˆªObject.getOwnPropertyNames(proxy)ã€Object.getOwnPropertySymbols(proxy)ã€Object.keys(proxy)ã€for...inå¾ªç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚è¯¥æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡æ‰€æœ‰è‡ªèº«çš„å±æ€§çš„å±æ€§åï¼Œè€ŒObject.keys()çš„è¿”å›ç»“æœä»…åŒ…æ‹¬ç›®æ ‡å¯¹è±¡è‡ªèº«çš„å¯éå†å±æ€§ã€‚</li> <li><strong>getOwnPropertyDescriptor(target, propKey)</strong>ï¼šæ‹¦æˆªObject.getOwnPropertyDescriptor(proxy, propKey)ï¼Œè¿”å›å±æ€§çš„æè¿°å¯¹è±¡ã€‚</li> <li><strong>defineProperty(target, propKey, propDesc)</strong>ï¼šæ‹¦æˆªObject.defineProperty(proxy, propKey, propDescï¼‰ã€Object.defineProperties(proxy, propDescs)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li> <li><strong>preventExtensions(target)</strong>ï¼šæ‹¦æˆªObject.preventExtensions(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li> <li><strong>getPrototypeOf(target)</strong>ï¼šæ‹¦æˆªObject.getPrototypeOf(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</li> <li><strong>isExtensible(target)</strong>ï¼šæ‹¦æˆªObject.isExtensible(proxy)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚</li> <li><strong>setPrototypeOf(target, proto)</strong>ï¼šæ‹¦æˆªObject.setPrototypeOf(proxy, proto)ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚å¦‚æœç›®æ ‡å¯¹è±¡æ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆè¿˜æœ‰ä¸¤ç§é¢å¤–æ“ä½œå¯ä»¥æ‹¦æˆªã€‚</li> <li><strong>apply(target, object, args)</strong>ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºå‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚proxy(...args)ã€proxy.call(object, ...args)ã€proxy.apply(...)ã€‚</li> <li><strong>construct(target, args)</strong>ï¼šæ‹¦æˆª Proxy å®ä¾‹ä½œä¸ºæ„é€ å‡½æ•°è°ƒç”¨çš„æ“ä½œï¼Œæ¯”å¦‚new proxy(...args)ã€‚</li></ol> <p>æ‹¦æˆªçš„å…·ä½“ç»†èŠ‚å¯ä»¥æŸ¥çœ‹é˜®ä¸€å³°è€å¸ˆçš„ <a href="https://es6.ruanyifeng.com/#docs/proxy" target="_blank" rel="noopener noreferrer">ã€ŠECMAScript 6 å…¥é—¨ã€‹<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œproxy çš„æœ€å¤§é—®é¢˜åœ¨äºæµè§ˆå™¨æ”¯æŒåº¦ä¸å¤Ÿï¼Œè€Œä¸”å¾ˆå¤šæ•ˆæœæ— æ³•ä½¿ç”¨ poilyfill æ¥å¼¥è¡¥ã€‚</p> <h3 id="wacth-proxy-å®ç°"><a href="#wacth-proxy-å®ç°" aria-hidden="true" class="header-anchor">#</a> Wacth Proxy å®ç°</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">wacth</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>prokey</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> target<span class="token punctuation">[</span>prokey<span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">set</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">taget<span class="token punctuation">,</span>prokey<span class="token punctuation">,</span>value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      taget<span class="token punctuation">[</span>prokey<span class="token punctuation">]</span> <span class="token operator">=</span> value
      <span class="token function">fn</span><span class="token punctuation">(</span>prokey<span class="token punctuation">,</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> proxy
<span class="token punctuation">}</span>
</code></pre></div><h3 id="defineproperty-å’Œ-proxy-åŒºåˆ«"><a href="#defineproperty-å’Œ-proxy-åŒºåˆ«" aria-hidden="true" class="header-anchor">#</a> defineProperty å’Œ Proxy åŒºåˆ«</h3> <p>Proxy</p> <ul><li>ä»£ç†çš„æ˜¯ å¯¹è±¡</li> <li>å¯ä»¥æ‹¦æˆªåˆ°æ•°ç»„çš„å˜åŒ–</li> <li>æ‹¦æˆªçš„æ–¹æ³•å¤šè¾¾13ç§</li> <li>è¿”å›ä¸€ä¸ªæ‹¦æˆªåçš„æ•°æ®</li></ul> <p>Object.defineProperty</p> <ul><li>ä»£ç†çš„æ˜¯å±æ€§</li> <li>å¯¹æ•°ç»„æ•°æ®çš„å˜åŒ–æ— èƒ½ä¸ºåŠ›</li> <li>ç›´æ¥ä¿®æ”¹åŸå§‹æ•°æ®</li></ul> <h3 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" aria-hidden="true" class="header-anchor">#</a> åº”ç”¨åœºæ™¯</h3> <p>vue 2 ä½¿ç”¨ defineProperty é€š getter / setter è¿›è¡Œæ•°æ®åŠ«æŒ</p> <p>vue 3 æ¢æˆ Proxy, å­˜åœ¨å‘ä¸‹å…¼å®¹é—®é¢˜</p> <p>ä½¿ç”¨ Proxy å®ç°è§‚å¯Ÿè€…æ¨¡å¼</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> queuedObservers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">observe</span> <span class="token operator">=</span> <span class="token parameter">fn</span> <span class="token operator">=&gt;</span> queuedObservers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">observable</span> <span class="token operator">=</span> <span class="token parameter">obj</span> <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">set</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token keyword">set</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span><span class="token punctuation">;</span>
  queuedObservers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">observer</span> <span class="token operator">=&gt;</span> <span class="token function">observer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="reflect"><a href="#reflect" aria-hidden="true" class="header-anchor">#</a> Reflect</h2> <p>Reflectå¯¹è±¡ä¸Proxyå¯¹è±¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ ES6 ä¸ºäº†æ“ä½œå¯¹è±¡è€Œæä¾›çš„æ–° APIã€‚</p> <p>Reflectå¯¹è±¡çš„è®¾è®¡ç›®çš„æœ‰è¿™æ ·å‡ ä¸ª</p> <ol><li><p>å°†Objectå¯¹è±¡çš„ä¸€äº›æ˜æ˜¾å±äºè¯­è¨€å†…éƒ¨çš„æ–¹æ³•ï¼ˆæ¯”å¦‚Object.definePropertyï¼‰ï¼Œæ”¾åˆ°Reflectå¯¹è±¡ä¸Šã€‚ç°é˜¶æ®µï¼ŒæŸäº›æ–¹æ³•åŒæ—¶åœ¨Objectå’ŒReflectå¯¹è±¡ä¸Šéƒ¨ç½²ï¼Œæœªæ¥çš„æ–°æ–¹æ³•å°†åªéƒ¨ç½²åœ¨Reflectå¯¹è±¡ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»Reflectå¯¹è±¡ä¸Šå¯ä»¥æ‹¿åˆ°è¯­è¨€å†…éƒ¨çš„æ–¹æ³•ã€‚</p></li> <li><p>ä¿®æ”¹æŸäº›Objectæ–¹æ³•çš„è¿”å›ç»“æœï¼Œè®©å…¶å˜å¾—æ›´åˆç†ã€‚æ¯”å¦‚ï¼ŒObject.defineProperty(obj, name, desc)åœ¨æ— æ³•å®šä¹‰å±æ€§æ—¶ï¼Œä¼šæŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œè€ŒReflect.defineProperty(obj, name, desc)åˆ™ä¼šè¿”å›falseã€‚</p></li> <li><p>è®©Objectæ“ä½œéƒ½å˜æˆå‡½æ•°è¡Œä¸º</p></li> <li><p>Reflectå¯¹è±¡çš„æ–¹æ³•ä¸Proxyå¯¹è±¡çš„æ–¹æ³•ä¸€ä¸€å¯¹åº”ï¼Œåªè¦æ˜¯Proxyå¯¹è±¡çš„æ–¹æ³•ï¼Œå°±èƒ½åœ¨Reflectå¯¹è±¡ä¸Šæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ã€‚</p></li></ol> <p>Reflectå¯¹è±¡ä¸€å…±æœ‰ 13 ä¸ªé™æ€æ–¹æ³•ã€‚</p> <ul><li>Reflect.apply(target, thisArg, args)</li> <li>Reflect.construct(target, args)</li> <li>Reflect.get(target, name, receiver)</li> <li>Reflect.set(target, name, value, receiver)</li> <li>Reflect.defineProperty(target, name, desc)</li> <li>Reflect.deleteProperty(target, name)</li> <li>Reflect.has(target, name)</li> <li>Reflect.ownKeys(target)</li> <li>Reflect.isExtensible(target)</li> <li>Reflect.preventExtensions(target)</li> <li>Reflect.getOwnPropertyDescriptor(target, name)</li> <li>Reflect.getPrototypeOf(target)</li> <li>Reflect.setPrototypeOf(target, prototype)</li></ul> <p>é¢è¿™äº›æ–¹æ³•çš„ä½œç”¨ï¼Œå¤§éƒ¨åˆ†ä¸Objectå¯¹è±¡çš„åŒåæ–¹æ³•çš„ä½œç”¨éƒ½æ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”å®ƒä¸Proxyå¯¹è±¡çš„æ–¹æ³•æ˜¯ä¸€ä¸€å¯¹åº”çš„</p> <h2 id="promiseå¯¹è±¡"><a href="#promiseå¯¹è±¡" aria-hidden="true" class="header-anchor">#</a> Promiseå¯¹è±¡</h2> <h3 id="ä»‹ç»"><a href="#ä»‹ç»" aria-hidden="true" class="header-anchor">#</a> ä»‹ç»</h3> <p>Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ç›¸æ¯”ä¼ ç»Ÿçš„å›è°ƒå‡½æ•°æ¨¡å¼æ›´åŠ åˆç†å’Œå¼ºå¤§ã€‚</p> <p>Promiseå¯¹è±¡ å…·æœ‰3ä¸ªçŠ¶æ€ï¼š<code>pending(è¿›è¡Œä¸­)</code>ã€<code>fulfilled(å·²å®Œæˆ)</code>ã€<code>rejected(å·²å¤±è´¥)</code></p> <p>å«æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p> <ol><li>å¯¹è±¡çš„çŠ¶æ€ä¸å—å¤–ç•Œå½±å“</li> <li>ä¸€æ—¦çŠ¶æ€æ”¹å˜ï¼Œå°±ä¸ä¼šå†æ”¹å˜ï¼Œè€Œä¸”ä»»ä½•æ—¶å€™å¯ä»¥è·å–åˆ°</li></ol> <p>ç¼ºç‚¹ï¼š</p> <ol><li>Promise ä¸€æ—¦æ–°å»ºå®ƒå°±ä¼šç«‹å³æ‰§è¡Œï¼Œæ— æ³•ä¸­é€”å–æ¶ˆã€‚</li> <li>Promiseå†…éƒ¨æŠ›å‡ºçš„é”™è¯¯ï¼Œä¸ä¼šååº”åˆ°å¤–éƒ¨ã€‚</li> <li>å½“å¤„äºpendingçŠ¶æ€æ—¶ï¼Œæ— æ³•å¾—çŸ¥ç›®å‰è¿›å±•åˆ°å“ªä¸€ä¸ªé˜¶æ®µ</li></ol> <p>æ³¨æ„ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæœ¬ç« åé¢çš„resolvedç»Ÿä¸€åªæŒ‡fulfilledçŠ¶æ€ã€‚</p> <h3 id="åŸºæœ¬ç”¨æ³•-2"><a href="#åŸºæœ¬ç”¨æ³•-2" aria-hidden="true" class="header-anchor">#</a> åŸºæœ¬ç”¨æ³•</h3> <p>ES6 è§„å®šï¼ŒPromiseå¯¹è±¡æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œç”¨æ¥ç”ŸæˆPromiseå®ä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token comment">/* å¼‚æ­¥æ“ä½œæˆåŠŸ */</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// success</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// failure</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'å‘ç”Ÿé”™è¯¯ï¼'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Promiseæ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯resolveå’Œrejectã€‚å®ƒä»¬æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œç”± JavaScript å¼•æ“æä¾›ï¼Œä¸ç”¨è‡ªå·±éƒ¨ç½²ã€‚</p> <p>resolveå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œæˆåŠŸâ€ï¼ˆå³ä» pending å˜ä¸º resolvedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼›</p> <p>rejectå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜ä¸ºâ€œå¤±è´¥â€ï¼ˆå³ä» pending å˜ä¸º rejectedï¼‰ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚</p> <p>Promise å®ä¾‹å…·æœ‰thenã€catchã€finallyç­‰æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™äº›æ–¹æ³•æ˜¯å®šä¹‰åœ¨åŸå‹å¯¹è±¡ Promise.prototype ä¸Šçš„ã€‚</p> <p>thenæ–¹æ³• å®ƒçš„ä½œç”¨æ˜¯ä¸º Promise å®ä¾‹æ·»åŠ çŠ¶æ€æ”¹å˜æ—¶çš„å›è°ƒå‡½æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯resolvedçŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°ï¼ˆå¯é€‰ï¼‰æ˜¯rejectedçŠ¶æ€çš„å›è°ƒå‡½æ•°ã€‚ è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ï¼ˆæ³¨æ„ï¼Œä¸æ˜¯åŸæ¥é‚£ä¸ªPromiseå®ä¾‹ï¼‰ã€‚å› æ­¤å¯ä»¥é‡‡ç”¨é“¾å¼å†™æ³•ï¼Œå³thenæ–¹æ³•åé¢å†è°ƒç”¨å¦ä¸€ä¸ªthenæ–¹æ³•ã€‚</p> <p>catchæ–¹æ³• ç”¨äºæŒ‡å®šå‘ç”Ÿé”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°</p> <p>finallyæ–¹æ³•ç”¨äºæŒ‡å®šä¸ç®¡ Promise å¯¹è±¡æœ€åçŠ¶æ€å¦‚ä½•ï¼Œéƒ½ä¼šæ‰§è¡Œçš„æ“ä½œ</p> <h3 id="promise-all"><a href="#promise-all" aria-hidden="true" class="header-anchor">#</a> Promise.all()</h3> <p>Promise.all()æ–¹æ³•ç”¨äºå°†å¤šä¸ªPromiseå®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„Promiseå®ä¾‹ã€‚</p> <div class="language- extra-class"><pre class="language-text"><code>var p = Promise.all([p1,p2,p3])
</code></pre></div><p>Promise.all()æ–¹æ³•æ¥å—ä¸€ä¸ªæ•°ç»„ä½œä¸ºå‚æ•°ï¼Œå‚æ•°å¿…éœ€éƒ½æ˜¯ Promise å®ä¾‹ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±ä¼šå…ˆè°ƒç”¨ä¸‹é¢è®²åˆ°çš„Promise.resolveæ–¹æ³•ï¼Œå°†å‚æ•°è½¬ä¸º Promise å®ä¾‹ï¼Œå†è¿›ä¸€æ­¥å¤„ç†ã€‚å‚æ•°ä¹Ÿå¯ä»¥ä¸æ˜¯æ•°ç»„ï¼Œä½†å¿…é¡»å…·æœ‰ Iterator æ¥å£</p> <p>Promise.allçš„å®ä¾‹çŠ¶æ€ç”±å‚æ•°Promiseå®ä¾‹å†³å®šï¼Œåˆ†æˆä¸¤ç§æƒ…å†µã€‚</p> <p>ï¼ˆ1ï¼‰åªæœ‰å‚æ•°çš„çŠ¶æ€éƒ½å˜æˆresolveï¼ŒçŠ¶æ€æ‰ä¼šå˜æˆresolvedï¼Œæ­¤æ—¶å‚æ•°å®ä¾‹çš„è¿”å›å€¼ç»„æˆä¸€ä¸ªæ•°ç»„ï¼Œä¼ é€’ç»™å®ä¾‹çš„å›è°ƒå‡½æ•°ã€‚</p> <p>ï¼ˆ2ï¼‰åªè¦å‚æ•°ä¹‹ä¸­æœ‰ä¸€ä¸ªè¢«rejectedï¼ŒçŠ¶æ€å°±å˜æˆrejectedï¼Œæ­¤æ—¶ç¬¬ä¸€ä¸ªè¢«rejectçš„å®ä¾‹çš„è¿”å›å€¼ï¼Œä¼šä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚</p> <p>æ³¨æ„ï¼Œå¦‚æœä½œä¸ºå‚æ•°çš„ Promise å®ä¾‹ï¼Œè‡ªå·±å®šä¹‰äº†catchæ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒä¸€æ—¦è¢«rejectedï¼Œå¹¶ä¸ä¼šè§¦å‘Promise.all()çš„catchæ–¹æ³•ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>  <span class="token keyword">const</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'æŠ¥é”™äº†'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> result<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>

  Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// [&quot;hello&quot;, Error: æŠ¥é”™äº†]</span>
</code></pre></div><h3 id="promise-race-iterable"><a href="#promise-race-iterable" aria-hidden="true" class="header-anchor">#</a> Promise.race(iterable)</h3> <p>Promise.race()æ–¹æ³•åŒæ ·æ˜¯å°†å¤šä¸ª Promise å®ä¾‹ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>è™½ç„¶è¯¥æ–¹æ³•ä¸Promise.all()å‚æ•°ç›¸åŒï¼Œä½†æ˜¯ä¸åŒçš„åœ¨äºå‚æ•°å®ä¾‹ä¸­æœ‰ä¸€ä¸ªå®ä¾‹ç‡å…ˆæ”¹å˜çŠ¶æ€ï¼ŒçŠ¶æ€å°±ä¼šè·Ÿç€æ”¹å˜ã€‚é‚£ä¸ªç‡å…ˆæ”¹å˜çš„ Promise å®ä¾‹çš„è¿”å›å€¼ï¼Œå°±ä¼ é€’ç»™å›è°ƒå‡½æ•°ã€‚</p> <h3 id="promise-allsettled"><a href="#promise-allsettled" aria-hidden="true" class="header-anchor">#</a> Promise.allSettled()</h3> <p>Promise.allSettled()æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹ã€‚åªæœ‰ç­‰åˆ°æ‰€æœ‰è¿™äº›å‚æ•°å®ä¾‹éƒ½è¿”å›ç»“æœï¼Œä¸ç®¡æ˜¯fulfilledè¿˜æ˜¯rejectedï¼ŒåŒ…è£…å®ä¾‹æ‰ä¼šç»“æŸã€‚è¯¥æ–¹æ³•ç”± ES2020 å¼•å…¥ã€‚</p> <h3 id="promise-any"><a href="#promise-any" aria-hidden="true" class="header-anchor">#</a> Promise.any()</h3> <p>ES2021 å¼•å…¥äº†Promise.any()æ–¹æ³•ã€‚è¯¥æ–¹æ³•æ¥å—ä¸€ç»„ Promise å®ä¾‹ä½œä¸ºå‚æ•°ï¼ŒåŒ…è£…æˆä¸€ä¸ªæ–°çš„ Promise å®ä¾‹è¿”å›ã€‚åªè¦å‚æ•°å®ä¾‹æœ‰ä¸€ä¸ªå˜æˆfulfilledçŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆfulfilledçŠ¶æ€ï¼›å¦‚æœæ‰€æœ‰å‚æ•°å®ä¾‹éƒ½å˜æˆrejectedçŠ¶æ€ï¼ŒåŒ…è£…å®ä¾‹å°±ä¼šå˜æˆrejectedçŠ¶æ€ã€‚</p> <h3 id="promise-reject-reason"><a href="#promise-reject-reason" aria-hidden="true" class="header-anchor">#</a> Promise.reject(reason)</h3> <p>è¿”å›ä¸€ä¸ªçŠ¶æ€ä¸ºå¤±è´¥çš„Promiseå¯¹è±¡ï¼Œå¹¶å°†ç»™å®šçš„å¤±è´¥ä¿¡æ¯ä¼ é€’ç»™å¯¹åº”çš„å¤„ç†æ–¹æ³•</p> <h3 id="promise-resolve-value"><a href="#promise-resolve-value" aria-hidden="true" class="header-anchor">#</a> Promise.resolve(value)</h3> <p>è¿”å›ä¸€ä¸ªçŠ¶æ€ç”±ç»™å®švalueå†³å®šçš„Promiseå¯¹è±¡</p> <h3 id="æ¨¡æ‹Ÿå®ç°promise"><a href="#æ¨¡æ‹Ÿå®ç°promise" aria-hidden="true" class="header-anchor">#</a> æ¨¡æ‹Ÿå®ç°Promise</h3> <h4 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" aria-hidden="true" class="header-anchor">#</a> ç¬¬ä¸€æ­¥</h4> <p>è¦å®ç°çš„åŠŸèƒ½ï¼š</p> <ol><li>å…·æœ‰3ä¸ªçŠ¶æ€å€¼</li> <li>ä¸€ä¸ªthenæ–¹æ³•æŒ‚è½½åœ¨Promise.prototypeä¸Š</li> <li>å…·æœ‰resolveå’Œreject æ–¹æ³•</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">RESOLVED</span> <span class="token operator">=</span> <span class="token string">'resolved'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>

<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>staus <span class="token operator">=</span> <span class="token constant">PENDING</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> undefiend<span class="token punctuation">;</span>

  <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span>
  <span class="token function">fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>resolve<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
</code></pre></div><h4 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" aria-hidden="true" class="header-anchor">#</a> ç¬¬äºŒæ­¥</h4> <p>Promiseçš„çŠ¶æ€åªèƒ½ä»pending -&gt; resolved æˆ–è€… pending -&gt; rejected.æ·»åŠ ä»£ç </p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PEDNING</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>value <span class="token operator">=</span> value
    that<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">RESOLEVD</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    that<span class="token punctuation">.</span>reason <span class="token operator">=</span> error
    that<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" aria-hidden="true" class="header-anchor">#</a> ç¬¬ä¸‰æ­¥</h4> <p>then æ–¹æ³•æœ‰2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºonResolved æˆåŠŸæ—¶è°ƒç”¨ï¼Œç¬¬äºŒä¸ªä¸ºonRejected å¤±è´¥æ—¶è°ƒç”¨ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">RESOLVED</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ç¬¬å››æ­¥"><a href="#ç¬¬å››æ­¥" aria-hidden="true" class="header-anchor">#</a> ç¬¬å››æ­¥</h4> <p>å½“Promiseçš„æ‰§è¡Œé‡åˆ°é”™è¯¯æ—¶ï¼Œä¼šç›´æ¥å˜æˆrejectedçŠ¶æ€.æ·»åŠ ä¸€æ®µtry catch</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">try</span><span class="token punctuation">{</span>
  <span class="token function">fn</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ç¬¬äº”æ­¥"><a href="#ç¬¬äº”æ­¥" aria-hidden="true" class="header-anchor">#</a> ç¬¬äº”æ­¥</h4> <p>ç›®å‰åŸºæœ¬çš„åŠŸèƒ½éƒ½å·²ç»å®Œæˆï¼Œä½†æ˜¯ä¸èƒ½å¤„ç†å¼‚æ­¥çš„æƒ…å†µã€‚æ‰€ä»¥æˆ‘ä»¬æ·»åŠ 2ä¸ªæ•°ç»„æ¥ä¿å­˜å¼‚æ­¥æ–¹æ³•ã€‚å½“çŠ¶æ€æ”¹å˜æ—¶ï¼Œéå†æ‰§è¡Œæ•°ç»„ä¸­çš„æ–¹æ³•ã€‚</p> <p>æ‰€ä»¥ä»£ç å¦‚ä¸‹ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">RESOLVED</span> <span class="token operator">=</span> <span class="token string">'resolved'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>
<span class="token keyword">function</span> <span class="token function">Promise</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">PENDING</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">undefined</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> <span class="token keyword">undefined</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

  <span class="token keyword">function</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">RESOLVED</span>
      that<span class="token punctuation">.</span>value <span class="token operator">=</span> value
      that<span class="token punctuation">.</span>onResolvedStack<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      that<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
      that<span class="token punctuation">.</span>reason <span class="token operator">=</span> error
      that<span class="token punctuation">.</span>onRejectedStack<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">fn</span><span class="token punctuation">(</span>that<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span>resovle<span class="token punctuation">,</span>reject<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name">Promise</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">then</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">onResolved<span class="token punctuation">,</span>onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">RESOLVED</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">onResolved</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">onRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onResolvedStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onResolved<span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>onRejected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ok è¿™å·²ç»ç®—æ˜¯ä¸€ä¸ªåŸºç¡€çš„Promise å®ç°äº†,ä½†æ˜¯è¿˜éœ€è¦è¿›è¡Œä¸€äº›å®Œæˆã€‚æ¯”å¦‚thenæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„promiseå€¼ç­‰</p> <h4 id="æ·»åŠ promise-allæ–¹æ³•"><a href="#æ·»åŠ promise-allæ–¹æ³•" aria-hidden="true" class="header-anchor">#</a> æ·»åŠ Promise.allæ–¹æ³•</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function-variable function">all</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">promiseArrs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//åœ¨Promiseç±»ä¸Šæ·»åŠ ä¸€ä¸ªallæ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªä¼ è¿›æ¥çš„promiseæ•°ç»„</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> values <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> len <span class="token operator">=</span> promiseArrs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> 
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>lenï¼› i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>promiseArrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                values<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>
                count<span class="token operator">++</span><span class="token punctuation">;</span>
                 <span class="token comment">// æ‰€æœ‰çŠ¶æ€éƒ½å˜æˆfulfilledæ—¶è¿”å›çš„MyPromiseçŠ¶æ€å°±å˜æˆfulfilled</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">===</span> len<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            	<span class="token comment">// æœ‰ä¸€ä¸ªè¢«rejectedæ—¶è¿”å›çš„MyPromiseçŠ¶æ€å°±å˜æˆrejected</span>
                <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="æ·»åŠ promise-raceæ–¹æ³•"><a href="#æ·»åŠ promise-raceæ–¹æ³•" aria-hidden="true" class="header-anchor">#</a> æ·»åŠ Promise.raceæ–¹æ³•</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Promise<span class="token punctuation">.</span><span class="token function-variable function">race</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">promises</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> promises<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            promises<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="æ·»åŠ -promise-allsettled"><a href="#æ·»åŠ -promise-allsettled" aria-hidden="true" class="header-anchor">#</a> æ·»åŠ  Promise.allSettled</h4> <h3 id="promise-å®ç°è¶…æ—¶æœºåˆ¶"><a href="#promise-å®ç°è¶…æ—¶æœºåˆ¶" aria-hidden="true" class="header-anchor">#</a> Promise å®ç°è¶…æ—¶æœºåˆ¶</h3> <p>ä½¿ç”¨Promise.race()</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// http è¯·æ±‚</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'è¯·æ±‚è¶…æ—¶'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">30000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="promise-å¹¶è¡Œè°ƒåº¦å™¨"><a href="#promise-å¹¶è¡Œè°ƒåº¦å™¨" aria-hidden="true" class="header-anchor">#</a> Promise å¹¶è¡Œè°ƒåº¦å™¨</h3> <h2 id="iterator-å’Œ-for-of-å¾ªç¯"><a href="#iterator-å’Œ-for-of-å¾ªç¯" aria-hidden="true" class="header-anchor">#</a> Iterator å’Œ for...of å¾ªç¯</h2> <p>éå†å™¨ï¼ˆIteratorï¼‰æ˜¯ä¸€ç§æ¥å£ï¼Œä¸ºå„ç§ä¸åŒçš„æ•°æ®ç»“æ„æä¾›ç»Ÿä¸€çš„è®¿é—®æœºåˆ¶ã€‚ä»»ä½•æ•°æ®ç»“æ„åªè¦éƒ¨ç½² Iterator æ¥å£ï¼Œå°±å¯ä»¥å®Œæˆéå†æ“ä½œï¼ˆå³ä¾æ¬¡å¤„ç†è¯¥æ•°æ®ç»“æ„çš„æ‰€æœ‰æˆå‘˜ï¼‰ã€‚</p> <p>Iterator çš„ä½œç”¨æœ‰ä¸‰ä¸ªï¼š
ä¸€æ˜¯ä¸ºå„ç§æ•°æ®ç»“æ„ï¼Œæä¾›ä¸€ä¸ªç»Ÿä¸€çš„ã€ç®€ä¾¿çš„è®¿é—®æ¥å£ï¼›</p> <p>äºŒæ˜¯ä½¿å¾—æ•°æ®ç»“æ„çš„æˆå‘˜èƒ½å¤ŸæŒ‰æŸç§æ¬¡åºæ’åˆ—ï¼›</p> <p>ä¸‰æ˜¯ ES6 åˆ›é€ äº†ä¸€ç§æ–°çš„éå†å‘½ä»¤for...ofå¾ªç¯ï¼ŒIterator æ¥å£ä¸»è¦ä¾›for...ofæ¶ˆè´¹ã€‚</p> <p>å…¶å®æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå…·æœ‰ next() æ–¹æ³•çš„å¯¹è±¡ï¼Œæ¯æ¬¡è°ƒç”¨ next() éƒ½ä¼šè¿”å›ä¸€ä¸ªç»“æœå¯¹è±¡ï¼Œè¯¥ç»“æœå¯¹è±¡æœ‰ä¸¤ä¸ªå±æ€§ï¼Œvalue è¡¨ç¤ºå½“å‰çš„å€¼ï¼Œdone è¡¨ç¤ºéå†æ˜¯å¦ç»“æŸã€‚</p> <p>ç”¨ES5è¯­æ³•æ¨¡æ‹Ÿä¸€ä¸ªiterator:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">makeIterator</span><span class="token punctuation">(</span><span class="token parameter">items</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">{</span>
    <span class="token function-variable function">next</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">var</span> done <span class="token operator">=</span> index <span class="token operator">&gt;=</span> items<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
      <span class="token keyword">var</span> value <span class="token operator">=</span> done <span class="token operator">?</span> <span class="token keyword">undefined</span><span class="token punctuation">:</span>items<span class="token punctuation">[</span>index<span class="token operator">++</span><span class="token punctuation">]</span>
      <span class="token keyword">return</span><span class="token punctuation">{</span>
        done<span class="token punctuation">:</span>done<span class="token punctuation">,</span>
        value<span class="token punctuation">:</span>value
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">makeIterator</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { done: false, value: 1 }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { done: false, value: 2 }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { done: false, value: 3 }</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { done: true, value: undefined }</span>
</code></pre></div><p>åŸç”Ÿå…·å¤‡ Iterator æ¥å£çš„æ•°æ®ç»“æ„å¦‚ä¸‹ã€‚</p> <ul><li>Array</li> <li>Map</li> <li>Set</li> <li>String</li> <li>TypedArray</li> <li>å‡½æ•°çš„ arguments å¯¹è±¡</li> <li>NodeList å¯¹è±¡</li></ul> <h3 id="for-of"><a href="#for-of" aria-hidden="true" class="header-anchor">#</a> for ... of</h3> <p>ES6å¼•å…¥äº†for...ofå¾ªç¯ï¼Œä½œä¸ºéå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€çš„æ–¹æ³•ã€‚</p> <p>é‚£ä½¿ç”¨for...of éå†æˆ‘ä»¬æ¨¡æ‹Ÿç”Ÿæˆçš„iteratorå¯¹è±¡æ˜¯ä»€ä¹ˆç»“æœ</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">makeIterator</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token keyword">of</span> i<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// Uncaught TypeError: i is not iterable</span>
<span class="token punctuation">}</span>

</code></pre></div><p>ç»“æœæ˜¯æŠ¥é”™äº†ï¼Œé‚£æ€ä¹ˆæ‰èƒ½ä½¿ç”¨for ... oféå†å‘¢ã€‚</p> <p>ä¸€ä¸ªæ•°æ®ç»“æ„åªè¦éƒ¨ç½²äº†Symbol.iteratorå±æ€§ï¼Œå°±è¢«è§†ä¸ºå…·æœ‰ iterator æ¥å£ï¼Œå°±å¯ä»¥ç”¨for...ofå¾ªç¯éå†å®ƒçš„æˆå‘˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œfor...ofå¾ªç¯å†…éƒ¨è°ƒç”¨çš„æ˜¯æ•°æ®ç»“æ„çš„Symbol.iteratoræ–¹æ³•ã€‚</p> <p>ä¸¾ä¾‹è¯´æ˜ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">createIterator</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>value <span class="token keyword">of</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>for...ofå¾ªç¯å¯ä»¥ä½¿ç”¨çš„èŒƒå›´åŒ…æ‹¬æ•°ç»„ã€Set å’Œ Map ç»“æ„ã€æŸäº›ç±»ä¼¼æ•°ç»„çš„å¯¹è±¡ï¼ˆæ¯”å¦‚argumentså¯¹è±¡ã€DOM NodeList å¯¹è±¡ï¼‰ã€åæ–‡çš„ Generator å¯¹è±¡ï¼Œä»¥åŠå­—ç¬¦ä¸²ã€‚</p> <h2 id="generator-å‡½æ•°"><a href="#generator-å‡½æ•°" aria-hidden="true" class="header-anchor">#</a> Generator å‡½æ•°</h2> <p>Generator å‡½æ•°ä¹Ÿæ˜¯ES6æä¾›çš„ä¸€ç§å¼‚æ­¥ç¼–ç¨‹è§£å†³æ–¹æ¡ˆã€‚</p> <p>Generator å‡½æ•°æœ‰å¤šç§ç†è§£è§’åº¦ã€‚</p> <p>è¯­æ³•ä¸Šï¼Œé¦–å…ˆå¯ä»¥æŠŠå®ƒç†è§£æˆï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œå°è£…äº†å¤šä¸ªå†…éƒ¨çŠ¶æ€ã€‚æ‰§è¡Œ Generator å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªéå†å™¨å¯¹è±¡ã€‚</p> <p>å½¢å¼ä¸Šï¼ŒGenerator å‡½æ•°æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‰¹å¾ã€‚ä¸€æ˜¯ï¼Œfunctionå…³é”®å­—ä¸å‡½æ•°åä¹‹é—´æœ‰ä¸€ä¸ªæ˜Ÿå·ï¼›äºŒæ˜¯ï¼Œå‡½æ•°ä½“å†…éƒ¨ä½¿ç”¨yieldè¡¨è¾¾å¼ï¼Œå®šä¹‰ä¸åŒçš„å†…éƒ¨çŠ¶æ€ã€‚</p> <p>åŸºæœ¬ç”¨æ³•</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'world'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token string">'ending'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> hw <span class="token operator">=</span> <span class="token function">helloWorldGenerator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'hello', done: false }</span>

hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'world', done: false }</span>

hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 'ending', done: true }</span>

hw<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: undefined, done: true }</span>
</code></pre></div><p>ç”±äº Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œåªæœ‰è°ƒç”¨nextæ–¹æ³•æ‰ä¼šéå†ä¸‹ä¸€ä¸ªå†…éƒ¨çŠ¶æ€ï¼Œæ‰€ä»¥å…¶å®æä¾›äº†ä¸€ç§å¯ä»¥æš‚åœæ‰§è¡Œçš„å‡½æ•°ã€‚yieldè¡¨è¾¾å¼å°±æ˜¯æš‚åœæ ‡å¿—ã€‚</p> <p>éå†å™¨å¯¹è±¡çš„nextæ–¹æ³•çš„è¿è¡Œé€»è¾‘å¦‚ä¸‹ã€‚</p> <p>ï¼ˆ1ï¼‰é‡åˆ°yieldè¡¨è¾¾å¼ï¼Œå°±æš‚åœæ‰§è¡Œåé¢çš„æ“ä½œï¼Œå¹¶å°†ç´§è·Ÿåœ¨yieldåé¢çš„é‚£ä¸ªè¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„valueå±æ€§å€¼ã€‚</p> <p>ï¼ˆ2ï¼‰ä¸‹ä¸€æ¬¡è°ƒç”¨nextæ–¹æ³•æ—¶ï¼Œå†ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ªyieldè¡¨è¾¾å¼ã€‚</p> <p>ï¼ˆ3ï¼‰å¦‚æœæ²¡æœ‰å†é‡åˆ°æ–°çš„yieldè¡¨è¾¾å¼ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°å‡½æ•°ç»“æŸï¼Œç›´åˆ°returnè¯­å¥ä¸ºæ­¢ï¼Œå¹¶å°†returnè¯­å¥åé¢çš„è¡¨è¾¾å¼çš„å€¼ï¼Œä½œä¸ºè¿”å›çš„å¯¹è±¡çš„valueå±æ€§å€¼ã€‚</p> <p>ï¼ˆ4ï¼‰å¦‚æœè¯¥å‡½æ•°æ²¡æœ‰returnè¯­å¥ï¼Œåˆ™è¿”å›çš„å¯¹è±¡çš„valueå±æ€§å€¼ä¸ºundefinedã€‚</p> <p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œyieldè¡¨è¾¾å¼åé¢çš„è¡¨è¾¾å¼ï¼Œåªæœ‰å½“è°ƒç”¨nextæ–¹æ³•ã€å†…éƒ¨æŒ‡é’ˆæŒ‡å‘è¯¥è¯­å¥æ—¶æ‰ä¼šæ‰§è¡Œï¼Œå› æ­¤ç­‰äºä¸º JavaScript æä¾›äº†æ‰‹åŠ¨çš„â€œæƒ°æ€§æ±‚å€¼â€ï¼ˆLazy Evaluationï¼‰çš„è¯­æ³•åŠŸèƒ½ã€‚</p> <p>Generator å‡½æ•°è¿”å›çš„éå†å™¨å¯¹è±¡ï¼Œè¿˜æœ‰æœ‰ä¸€ä¸ªthrowå’Œreturnæ–¹æ³•ï¼Œthrowå¯ä»¥åœ¨å‡½æ•°ä½“å¤–æŠ›å‡ºé”™è¯¯ï¼Œç„¶ååœ¨ Generator å‡½æ•°ä½“å†…æ•è·ã€‚returnå¯ä»¥è¿”å›ç»™å®šçš„å€¼ï¼Œå¹¶ä¸”ç»ˆç»“éå† Generator å‡½æ•°ã€‚</p> <p>åœ¨ä¸€ä¸ª Generator å‡½æ•°é‡Œé¢æ‰§è¡Œå¦ä¸€ä¸ª Generator å‡½æ•°ï¼Œå¯ä»¥yield*è¡¨è¾¾å¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span><span class="token operator">*</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">yield</span> <span class="token string">'x'</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span><span class="token operator">*</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">yield</span> <span class="token string">'y'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Generator å‡½æ•°ä¹Ÿä¸èƒ½è·Ÿnewå‘½ä»¤ä¸€èµ·ç”¨ï¼Œä¼šæŠ¥é”™ã€‚</p> <h2 id="async-å‡½æ•°"><a href="#async-å‡½æ•°" aria-hidden="true" class="header-anchor">#</a> Async å‡½æ•°</h2> <p>async å‡½æ•°å…¶å®æ˜¯ Generator å‡½æ•°çš„è¯­æ³•ç³–ã€‚</p> <p>ç”¨æ³•ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">1</span>
  <span class="token keyword">const</span> m <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>æ¯”è¾ƒä¼šå‘ç°ï¼Œasyncå‡½æ•°å°±æ˜¯å°† Generator å‡½æ•°çš„æ˜Ÿå·ï¼ˆ*ï¼‰æ›¿æ¢æˆasyncï¼Œå°†yieldæ›¿æ¢æˆawaitï¼Œä»…æ­¤è€Œå·²ã€‚</p> <p>ä½†æ˜¯asyncå‡½æ•°å¯¹ Generator å‡½æ•°çš„æ”¹è¿›ï¼Œä½“ç°åœ¨ä»¥ä¸‹å››ç‚¹</p> <ol><li><p>å†…ç½®æ‰§è¡Œå™¨ã€‚
Generator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œæ‰€ä»¥æ‰æœ‰äº†coæ¨¡å—ï¼Œè€Œasyncå‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ã€‚</p></li> <li><p>æ›´å¥½çš„è¯­ä¹‰ã€‚
asyncå’Œawaitï¼Œæ¯”èµ·æ˜Ÿå·å’Œyieldï¼Œè¯­ä¹‰æ›´æ¸…æ¥šäº†ã€‚asyncè¡¨ç¤ºå‡½æ•°é‡Œæœ‰å¼‚æ­¥æ“ä½œï¼Œawaitè¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</p></li> <li><p>æ›´å¹¿çš„é€‚ç”¨æ€§ã€‚</p></li></ol> <p>coæ¨¡å—çº¦å®šï¼Œyieldå‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œasyncå‡½æ•°çš„awaitå‘½ä»¤åé¢ï¼Œå¯ä»¥æ˜¯ Promise å¯¹è±¡å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆæ•°å€¼ã€å­—ç¬¦ä¸²å’Œå¸ƒå°”å€¼ï¼Œä½†è¿™æ—¶ä¼šè‡ªåŠ¨è½¬æˆç«‹å³ resolved çš„ Promise å¯¹è±¡ï¼‰ã€‚</p> <ol start="4"><li>è¿”å›å€¼æ˜¯ Promiseã€‚</li></ol> <p>asyncå‡½æ•°çš„è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iterator å¯¹è±¡æ–¹ä¾¿å¤šäº†</p> <p>ä½¿ç”¨æ³¨æ„ç‚¹ï¼š</p> <ol><li><p>ç¬¬ä¸€ç‚¹ æŠŠawaitå‘½ä»¤æ”¾åœ¨try...catchä»£ç å—ä¸­  å› ä¸ºå­˜åœ¨rejectedçš„æƒ…å†µ</p></li> <li><p>å¤šä¸ªawaitå‘½ä»¤åé¢çš„å¼‚æ­¥æ“ä½œï¼Œå¦‚æœä¸å­˜åœ¨ç»§å‘å…³ç³»ï¼Œæœ€å¥½è®©å®ƒä»¬åŒæ—¶è§¦å‘ã€‚ ä½¿ç”¨Promise.all</p></li> <li><p>awaitå‘½ä»¤åªèƒ½ç”¨åœ¨asyncå‡½æ•°ä¹‹ä¸­ï¼Œå¦‚æœç”¨åœ¨æ™®é€šå‡½æ•°ï¼Œå°±ä¼šæŠ¥é”™ã€‚</p></li> <li><p>async å‡½æ•°å¯ä»¥ä¿ç•™è¿è¡Œå †æ ˆã€‚</p></li></ol> <h3 id="async-å‡½æ•°çš„å®ç°åŸç†"><a href="#async-å‡½æ•°çš„å®ç°åŸç†" aria-hidden="true" class="header-anchor">#</a> async å‡½æ•°çš„å®ç°åŸç†</h3> <p>async å‡½æ•°çš„å®ç°åŸç†ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">// ç­‰åŒäºã€‚ã€‚ã€‚</span>

<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ‰€æœ‰çš„asyncå‡½æ•°éƒ½å¯ä»¥å†™æˆä¸Šé¢çš„ç¬¬äºŒç§å½¢å¼ï¼Œå…¶ä¸­çš„spawnå‡½æ•°å°±æ˜¯è‡ªåŠ¨æ‰§è¡Œå™¨ã€‚</p> <p>spawnå‡½æ•°çš„å®ç°</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">spawn</span><span class="token punctuation">(</span><span class="token parameter">genF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> gen <span class="token operator">=</span> <span class="token function">genF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">step</span><span class="token punctuation">(</span><span class="token parameter">nextF</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> next<span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        next <span class="token operator">=</span> <span class="token function">nextF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>next<span class="token punctuation">.</span>done<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>next<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>next<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">step</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">step</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> gen<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">step</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> gen<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="es6-3ç§å¼‚æ­¥å¤„ç†æ–¹æ³•çš„æ¯”è¾ƒ"><a href="#es6-3ç§å¼‚æ­¥å¤„ç†æ–¹æ³•çš„æ¯”è¾ƒ" aria-hidden="true" class="header-anchor">#</a> ES6 3ç§å¼‚æ­¥å¤„ç†æ–¹æ³•çš„æ¯”è¾ƒ</h2> <p>ç”¨ä¸€ä¸ªä¾‹å­çš„ä½¿ç”¨æ¥æ¯”è¾ƒ async å‡½æ•°ä¸Promiseã€Generator å‡½æ•°çš„æ¯”è¾ƒ</p> <p>å‡è®¾æœ‰ä¸€ç³»åˆ—çš„å¼‚æ­¥è¯·æ±‚ï¼Œå‰ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ç»“æŸï¼Œæ‰èƒ½å¼€å§‹ä¸‹ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚ï¼Œå…¶ä¸­ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚å‡ºé”™ï¼Œå°±ä¸ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œè¿”å›ä¸Šä¸€æ¬¡çš„å€¼ã€‚</p> <p>1.<strong>Promise å†™æ³•</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">chainRequestPromise</span><span class="token punctuation">(</span><span class="token parameter">requests</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token comment">// è¿”å›å€¼</span>

  <span class="token keyword">let</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> req <span class="token keyword">of</span> requests<span class="token punctuation">)</span><span class="token punctuation">{</span>
    p <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      res <span class="token operator">=</span> val
      <span class="token keyword">return</span> <span class="token function">req</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> p<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token function">functiob</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Promise çš„å†™æ³•æ˜¯è§£å†³äº†å›è°ƒå‡½æ•°çš„å¤šå±‚åµŒå¥—é—®é¢˜ï¼Œæ”¹ç”¨thenæ–¹æ³•é“¾å¼è°ƒç”¨çš„å½¢å¼ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰å¤§é‡çš„ä»£ç å†—ä½™ï¼Œå…¨æ˜¯ä¸€äº›thenæ–¹æ³•ã€‚</p> <ol start="2"><li><strong>Generatorå†™æ³•</strong></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> co <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'co'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">chainRequestGenerator</span><span class="token punctuation">(</span><span class="token parameter">requests</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">co</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
      <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> req <span class="token keyword">of</span> request<span class="token punctuation">)</span><span class="token punctuation">{</span>
        res <span class="token operator">=</span> <span class="token keyword">yield</span> <span class="token function">req</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> res
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è¿™ç§å†™æ³•çš„é—®é¢˜åœ¨äºå¿…é¡»æœ‰ä¸€ä¸ªä»»åŠ¡è¿è¡Œå™¨ï¼Œè‡ªåŠ¨æ‰§è¡ŒGenerator å‡½æ•°;coå‡½æ•°å°±æ˜¯è‡ªåŠ¨æ‰§è¡Œå™¨ï¼Œå®ƒè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œä¸”å¿…é¡»ä¿è¯yieldè¯­å¥åé¢çš„è¡¨è¾¾å¼ï¼Œå¿…é¡»è¿”å›ä¸€ä¸ª Promiseã€‚</p> <ol start="3"><li><strong>asyncå‡½æ•°</strong></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">chainRequestAsync</span><span class="token punctuation">(</span><span class="token parameter">requests</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> req <span class="token keyword">of</span> requests<span class="token punctuation">)</span><span class="token punctuation">{</span>
      res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">req</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res
<span class="token punctuation">}</span>
</code></pre></div><p>async å‡½æ•°çš„å®ç°æœ€ç®€æ´ï¼Œæœ€ç¬¦åˆè¯­ä¹‰ï¼Œè€Œä¸”å°†Generator å†™æ³•ä¸­çš„è‡ªåŠ¨æ‰§è¡Œå™¨å†…éƒ¨å®ç°å•¦ã€‚</p> <h2 id="class-ç±»"><a href="#class-ç±»" aria-hidden="true" class="header-anchor">#</a> Class ç±»</h2> <h3 id="åŸºæœ¬è¯­æ³•-2"><a href="#åŸºæœ¬è¯­æ³•-2" aria-hidden="true" class="header-anchor">#</a> åŸºæœ¬è¯­æ³•</h3> <p>ES6 å¼•å…¥äº†Classï¼ˆç±»ï¼‰è¿™ä¸ªæ¦‚å¿µï¼Œé€šè¿‡class å…³é”®å­—å¯ä»¥å®šä¹‰ç±»ã€‚å…¶å® class  åªæ˜¯ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå¯ä»¥ä½¿ç”¨ES5å†™æ³•å®ç°ç»å¤§éƒ¨åˆ†åŠŸèƒ½ã€‚åªæ˜¯è¯´classå†™æ³•è®©å¯¹è±¡åŸå‹çš„å†™æ³•æ›´åŠ æ¸…æ™°ã€æ›´åƒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•ã€‚è®©å†™æ³•æ›´åŠ ä¸ä¼ ç»Ÿçš„é¢å‘å¯¹é¢è¯­éŸ³å·®å¼‚ä¸å¤§ã€‚</p> <p>classå†™æ³•ä¸¾ä¾‹ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)`</span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¦‚æœæ”¹æˆES5å†™æ³•ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Ponit</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y
<span class="token punctuation">}</span>

<span class="token class-name">Ponint</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">toString</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'('</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>x<span class="token operator">+</span><span class="token string">','</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token operator">+</span><span class="token string">')'</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="constructor"><a href="#constructor" aria-hidden="true" class="header-anchor">#</a> constructor</h3> <p>constructor æ–¹æ³•æ˜¯ç±»çš„é»˜è®¤æ–¹æ³•ï¼Œé€šè¿‡newå‘½ä»¤ç”Ÿæˆå¯¹è±¡å®ä¾‹æ—¶ï¼Œè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³•ã€‚</p> <p>ä¸€ä¸ªç±»å¿…é¡»æœ‰constructoræ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ˜¾å¼å®šä¹‰ï¼Œä¸€ä¸ªç©ºçš„constructoræ–¹æ³•ä¼šè¢«é»˜è®¤æ·»åŠ ï¼Œconstructoræ–¹æ³•é»˜è®¤è¿”å›å®ä¾‹å¯¹è±¡ï¼ˆå³thisï¼‰</p> <h3 id="ç±»çš„å®ä¾‹"><a href="#ç±»çš„å®ä¾‹" aria-hidden="true" class="header-anchor">#</a> ç±»çš„å®ä¾‹</h3> <ol><li>é€šè¿‡ new å‘½ä»¤ç”Ÿæˆå®ä¾‹ï¼Œè€Œä¸”ç±»å¿…é¡»ä½¿ç”¨ new è°ƒç”¨ç”Ÿæˆå®ä¾‹ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// æŠ¥é”™</span>
<span class="token keyword">var</span> point <span class="token operator">=</span> <span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ­£ç¡®</span>
<span class="token keyword">var</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>å®ä¾‹çš„å±æ€§é™¤éæ˜¾å¼å®šä¹‰åœ¨å…¶æœ¬èº«ï¼ˆå³å®šä¹‰åœ¨thiså¯¹è±¡ä¸Šï¼‰ï¼Œå¦åˆ™éƒ½æ˜¯å®šä¹‰åœ¨åŸå‹ä¸Šï¼ˆå³å®šä¹‰åœ¨classä¸Šï¼‰ã€‚</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//å®šä¹‰ç±»</span>
<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>

  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'('</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">', '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token string">')'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

point<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// (2, 3)</span>

point<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
point<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
point<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span> <span class="token comment">// false</span>
point<span class="token punctuation">.</span>__proto__<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">'toString'</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><ol start="3"><li>ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ä¸€ä¸ªåŸå‹å¯¹è±¡ã€‚</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

p1<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> p2<span class="token punctuation">.</span>__proto__
<span class="token comment">//true</span>
</code></pre></div><h3 id="é™æ€æ–¹æ³•"><a href="#é™æ€æ–¹æ³•" aria-hidden="true" class="header-anchor">#</a> é™æ€æ–¹æ³•</h3> <p>å¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•å‰ï¼ŒåŠ ä¸Šstaticå…³é”®å­—ï¼Œå°±è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ä¼šè¢«å®ä¾‹ç»§æ‰¿ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨ï¼Œè¿™å°±ç§°ä¸ºâ€œé™æ€æ–¹æ³•â€ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token function">classMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Foo<span class="token punctuation">.</span><span class="token function">classMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 'hello'</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span><span class="token function">classMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// TypeError: foo.classMethod is not a function</span>
</code></pre></div><p>æ³¨æ„ï¼Œå¦‚æœé™æ€æ–¹æ³•åŒ…å«thiså…³é”®å­—ï¼Œè¿™ä¸ªthisæŒ‡çš„æ˜¯ç±»ï¼Œè€Œä¸æ˜¯å®ä¾‹ã€‚</p> <p>çˆ¶ç±»çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥è¢«å­ç±»ç»§æ‰¿ã€‚</p> <h3 id="é™æ€å±æ€§"><a href="#é™æ€å±æ€§" aria-hidden="true" class="header-anchor">#</a> é™æ€å±æ€§</h3> <p>é™æ€å±æ€§æŒ‡çš„æ˜¯ Class æœ¬èº«çš„å±æ€§ï¼Œå³Class.propNameï¼Œè€Œä¸æ˜¯å®šä¹‰åœ¨å®ä¾‹å¯¹è±¡ï¼ˆthisï¼‰ä¸Šçš„å±æ€§ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// è€å†™æ³•</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
Foo<span class="token punctuation">.</span>prop <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// æ–°å†™æ³•</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> prop <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="ä½¿ç”¨æ³¨æ„ç‚¹-2"><a href="#ä½¿ç”¨æ³¨æ„ç‚¹-2" aria-hidden="true" class="header-anchor">#</a> ä½¿ç”¨æ³¨æ„ç‚¹</h4> <ol><li>ä¸¥æ ¼æ¨¡å¼</li></ol> <p>ç±»å’Œæ¨¡å—çš„å†…éƒ¨ï¼Œé»˜è®¤å°±æ˜¯ä¸¥æ ¼æ¨¡å¼ï¼Œæ‰€ä»¥ä¸éœ€è¦ä½¿ç”¨use strictæŒ‡å®šè¿è¡Œæ¨¡å¼ã€‚</p> <ol start="2"><li>ä¸å­˜åœ¨æå‡</li></ol> <p>ç±»ä¸å­˜åœ¨å˜é‡æå‡ï¼ˆhoistï¼‰ï¼Œè¿™ä¸€ç‚¹ä¸ ES5 å®Œå…¨ä¸åŒã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
<span class="token keyword">class</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>this çš„æŒ‡å‘</li></ol> <p>ç±»çš„æ–¹æ³•å†…éƒ¨å¦‚æœå«æœ‰thisï¼Œå®ƒé»˜è®¤æŒ‡å‘ç±»çš„å®ä¾‹ã€‚ä½†æ˜¯ï¼Œå¿…é¡»éå¸¸å°å¿ƒï¼Œä¸€æ—¦å•ç‹¬ä½¿ç”¨è¯¥æ–¹æ³•ï¼Œå¾ˆå¯èƒ½æŠ¥é”™ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
  <span class="token function">printName</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">'there'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">print</span><span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> printName <span class="token punctuation">}</span> <span class="token operator">=</span> logger<span class="token punctuation">;</span>
<span class="token function">printName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: Cannot read property 'print' of undefined</span>
</code></pre></div><ol start="4"><li>ç±»çš„å†…éƒ¨æ‰€æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œéƒ½æ˜¯ä¸å¯æšä¸¾çš„</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
<span class="token comment">// []</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
<span class="token comment">// [&quot;constructor&quot;,&quot;toString&quot;]</span>
</code></pre></div><h3 id="extends-ç»§æ‰¿"><a href="#extends-ç»§æ‰¿" aria-hidden="true" class="header-anchor">#</a> extends ç»§æ‰¿</h3> <p>Class å¯ä»¥é€šè¿‡ extends å…³é”®å­—å®ç°ç»§æ‰¿ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">ColorPoint</span> <span class="token keyword">extends</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨çˆ¶ç±»çš„constructor(x, y)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨çˆ¶ç±»çš„toString()</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å­ç±»å¿…é¡»åœ¨constructoræ–¹æ³•ä¸­è°ƒç”¨superæ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹æ—¶ä¼šæŠ¥é”™ã€‚</p> <p>åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œåªæœ‰è°ƒç”¨superä¹‹åï¼Œæ‰å¯ä»¥ä½¿ç”¨thiså…³é”®å­—ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p> <p>çˆ¶ç±»çš„é™æ€æ–¹æ³•ï¼Œä¹Ÿä¼šè¢«å­ç±»ç»§æ‰¿ã€‚</p> <h3 id="super-å…³é”®å­—"><a href="#super-å…³é”®å­—" aria-hidden="true" class="header-anchor">#</a> super å…³é”®å­—</h3> <p>super å…³é”®å­— å³å¯ä»¥å½“ä½œå‡½æ•°ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¯¹è±¡ä½¿ç”¨ã€‚</p> <p><strong>ä½œä¸ºå‡½æ•°æ—¶</strong></p> <p>superä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œä»£è¡¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚ES6 è¦æ±‚ï¼Œå­ç±»çš„æ„é€ å‡½æ•°å¿…é¡»æ‰§è¡Œä¸€æ¬¡superå‡½æ•°ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æ³¨æ„</p> <ol><li>superè™½ç„¶ä»£è¡¨äº†çˆ¶ç±»Açš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯å­ç±»Bçš„å®ä¾‹ï¼Œå³superå†…éƒ¨çš„thisæŒ‡çš„æ˜¯Bçš„å®ä¾‹ï¼Œå› æ­¤super()åœ¨è¿™é‡Œç›¸å½“äºA.prototype.constructor.call(this)ã€‚</li> <li>ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œåªèƒ½åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­ä½¿ç”¨ï¼Œåœ¨å…¶ä»–åœ°æ–¹ä¼šæŠ¥é”™ã€‚</li></ol> <p><strong>ä½œä¸ºå¯¹è±¡æ—¶</strong></p> <p>superä½œä¸ºå¯¹è±¡æ—¶ï¼Œåœ¨æ™®é€šæ–¹æ³•ä¸­ï¼ŒæŒ‡å‘çˆ¶ç±»çš„åŸå‹å¯¹è±¡ï¼›åœ¨é™æ€æ–¹æ³•ä¸­ï¼ŒæŒ‡å‘çˆ¶ç±»ã€‚</p> <p>åœ¨å­ç±»æ™®é€šæ–¹æ³•ä¸­é€šè¿‡superè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨çš„thisæŒ‡å‘å½“å‰çš„å­ç±»å®ä¾‹ã€‚
åœ¨å­ç±»çš„é™æ€æ–¹æ³•ä¸­é€šè¿‡superè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ—¶ï¼Œæ–¹æ³•å†…éƒ¨çš„thisæŒ‡å‘å½“å‰çš„å­ç±»ï¼Œè€Œä¸æ˜¯å­ç±»çš„å®ä¾‹ã€‚</p> <h3 id="ç±»çš„-prototype-å±æ€§å’Œ-proto-å±æ€§"><a href="#ç±»çš„-prototype-å±æ€§å’Œ-proto-å±æ€§" aria-hidden="true" class="header-anchor">#</a> ç±»çš„ prototype å±æ€§å’Œ__proto__å±æ€§</h3> <p>Class ä½œä¸ºæ„é€ å‡½æ•°çš„è¯­æ³•ç³–ï¼ŒåŒæ—¶æœ‰prototypeå±æ€§å’Œ__proto__å±æ€§ï¼Œå› æ­¤åŒæ—¶å­˜åœ¨ä¸¤æ¡ç»§æ‰¿é“¾ã€‚</p> <ol><li>å­ç±»çš„__proto__å±æ€§ï¼Œè¡¨ç¤ºæ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»ã€‚</li> <li>å­ç±»prototypeå±æ€§çš„__proto__å±æ€§ï¼Œè¡¨ç¤ºæ–¹æ³•çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»çš„prototypeå±æ€§ã€‚</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token keyword">extends</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

Child<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Parent <span class="token comment">// true</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
</code></pre></div><p>è¿™æ ·çš„ç»“æœæ˜¯å› ä¸ºï¼Œç±»çš„ç»§æ‰¿æ˜¯æŒ‰ç…§ä¸‹é¢çš„æ¨¡å¼å®ç°çš„ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">Parent</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Child</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>

<span class="token comment">// Child çš„å®ä¾‹ç»§æ‰¿ Parent çš„å®ä¾‹</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Child ç»§æ‰¿ Parent çš„é™æ€å±æ€§</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span>Child<span class="token punctuation">,</span> Parent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> child <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>ES6 çš„åŸå‹é“¾ç¤ºæ„å›¾ä¸ºï¼š
<img src="/assets/img/class-prototype.f28e4d0c.png" alt="An image"></p> <p>æˆ‘ä»¬ä¼šå‘ç°ï¼Œç›¸æ¯”å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼ŒES6 çš„ class å¤šäº†ä¸€ä¸ª Object.setPrototypeOf(Child, Parent) çš„æ­¥éª¤ã€‚</p> <h4 id="ç»§æ‰¿ç›®æ ‡"><a href="#ç»§æ‰¿ç›®æ ‡" aria-hidden="true" class="header-anchor">#</a> ç»§æ‰¿ç›®æ ‡</h4> <p>extendså…³é”®å­—åé¢å¯ä»¥è·Ÿå¤šç§ç±»å‹çš„å€¼ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">B</span> <span class="token keyword">extends</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢ä»£ç çš„ Aï¼Œåªè¦æ˜¯ä¸€ä¸ªæœ‰ prototype å±æ€§çš„å‡½æ•°ï¼Œå°±èƒ½è¢« B ç»§æ‰¿ã€‚ç”±äºå‡½æ•°éƒ½æœ‰ prototype å±æ€§ï¼ˆé™¤äº† Function.prototype å‡½æ•°ï¼‰ï¼Œå› æ­¤ A å¯ä»¥æ˜¯ä»»æ„å‡½æ•°ã€‚</p> <p>ä¸å­˜åœ¨ä»»ä½•ç»§æ‰¿ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><h2 id="module"><a href="#module" aria-hidden="true" class="header-anchor">#</a> Module</h2> <p>æ¨¡å—åŠŸèƒ½ä¸»è¦ç”±ä¸¤ä¸ªå‘½ä»¤æ„æˆï¼šexportå’Œimportã€‚exportå‘½ä»¤ç”¨äºè§„å®šæ¨¡å—çš„å¯¹å¤–æ¥å£ï¼Œimportå‘½ä»¤ç”¨äºè¾“å…¥å…¶ä»–æ¨¡å—æä¾›çš„åŠŸèƒ½ã€‚</p> <h3 id="export"><a href="#export" aria-hidden="true" class="header-anchor">#</a> export</h3> <p>exportå‘½ä»¤é™¤äº†è¾“å‡ºå˜é‡ï¼Œè¿˜å¯ä»¥è¾“å‡ºå‡½æ•°æˆ–ç±»ï¼ˆclassï¼‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œexportè¾“å‡ºçš„å˜é‡å°±æ˜¯æœ¬æ¥çš„åå­—ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨aså…³é”®å­—é‡å‘½åã€‚</p> <p>exportå‘½ä»¤å¯ä»¥å‡ºç°åœ¨æ¨¡å—çš„ä»»ä½•ä½ç½®ï¼Œåªè¦å¤„äºæ¨¡å—é¡¶å±‚å°±å¯ä»¥ã€‚</p> <p>ä½¿ç”¨è¯­æ³•</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// å†™æ³•ä¸€</span>
<span class="token keyword">export</span> <span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">// å†™æ³•äºŒ</span>
<span class="token keyword">var</span> m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>m<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// å†™æ³•ä¸‰</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>n <span class="token keyword">as</span> m<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>f<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="import"><a href="#import" aria-hidden="true" class="header-anchor">#</a> import</h3> <p>importå‘½ä»¤æ¥å—ä¸€å¯¹å¤§æ‹¬å·ï¼Œé‡Œé¢æŒ‡å®šè¦ä»å…¶ä»–æ¨¡å—å¯¼å…¥çš„å˜é‡åã€‚å¤§æ‹¬å·é‡Œé¢çš„å˜é‡åï¼Œå¿…é¡»ä¸è¢«å¯¼å…¥æ¨¡å—ï¼ˆprofile.jsï¼‰å¯¹å¤–æ¥å£çš„åç§°ç›¸åŒã€‚</p> <p>å¦‚æœæƒ³ä¸ºè¾“å…¥çš„å˜é‡é‡æ–°å–ä¸€ä¸ªåå­—ï¼Œimportå‘½ä»¤è¦ä½¿ç”¨aså…³é”®å­—ï¼Œå°†è¾“å…¥çš„å˜é‡é‡å‘½åã€‚</p> <p>importå‘½ä»¤è¾“å…¥çš„å˜é‡éƒ½æ˜¯åªè¯»çš„ï¼Œå› ä¸ºå®ƒçš„æœ¬è´¨æ˜¯è¾“å…¥æ¥å£ã€‚</p> <p>importå‘½ä»¤å…·æœ‰æå‡æ•ˆæœï¼Œä¼šæå‡åˆ°æ•´ä¸ªæ¨¡å—çš„å¤´éƒ¨ï¼Œé¦–å…ˆæ‰§è¡Œã€‚</p> <p>å¦‚æœå¤šæ¬¡é‡å¤æ‰§è¡ŒåŒä¸€å¥importè¯­å¥ï¼Œé‚£ä¹ˆåªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œä¸ä¼šæ‰§è¡Œå¤šæ¬¡ã€‚</p> <p>ä½¿ç”¨è¯­æ³•</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>a <span class="token keyword">as</span> b<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./xxx.js'</span>

</code></pre></div><p>é™¤äº†æŒ‡å®šåŠ è½½æŸä¸ªè¾“å‡ºå€¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨æ•´ä½“åŠ è½½ï¼Œå³ç”¨æ˜Ÿå·ï¼ˆ*ï¼‰æŒ‡å®šä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€æœ‰è¾“å‡ºå€¼éƒ½åŠ è½½åœ¨è¿™ä¸ªå¯¹è±¡ä¸Šé¢ã€‚</p> <p>æ¨¡å—æ•´ä½“åŠ è½½æ‰€åœ¨çš„é‚£ä¸ªå¯¹è±¡ï¼ˆå°±æ˜¯ä¾‹å­ä¸­çš„aï¼‰ï¼Œåº”è¯¥æ˜¯å¯ä»¥é™æ€åˆ†æçš„ï¼Œæ‰€ä»¥ä¸å…è®¸è¿è¡Œæ—¶æ”¹å˜</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> a <span class="token keyword">from</span> <span class="token string">'./xxx.js'</span><span class="token punctuation">;</span>

<span class="token comment">// ä¸‹é¢ä¸¤è¡Œéƒ½æ˜¯ä¸å…è®¸çš„</span>
circle<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
circle<span class="token punctuation">.</span><span class="token function-variable function">area</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="export-default"><a href="#export-default" aria-hidden="true" class="header-anchor">#</a> export default</h3> <p>ä½¿ç”¨export defaultå‘½ä»¤ï¼Œä¸ºæ¨¡å—æŒ‡å®šé»˜è®¤è¾“å‡ºã€‚ä¸€ä¸ªæ–‡ä»¶ä¸­ export defaultå‘½ä»¤åªèƒ½ä½¿ç”¨ä¸€æ¬¡ è€Œä¸” å¼•ç”¨çš„æ—¶å€™importå‘½ä»¤åé¢ä¸ç”¨åŠ å¤§æ‹¬å·</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// æˆ–è€…å†™æˆ</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> foo<span class="token punctuation">;</span>
</code></pre></div><h3 id="import-2"><a href="#import-2" aria-hidden="true" class="header-anchor">#</a> import()</h3> <p>importå‘½ä»¤ä¼šè¢« JavaScript å¼•æ“é™æ€åˆ†æï¼Œå…ˆäºæ¨¡å—å†…çš„å…¶ä»–è¯­å¥æ‰§è¡Œã€‚ä¸æ”¯æŒæ— æ³•åœ¨è¿è¡Œæ—¶åŠ è½½æ¨¡å—ã€‚ES2020ææ¡ˆ å¼•å…¥import()å‡½æ•°ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½æ¨¡å—ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span><span class="token punctuation">(</span>specifier<span class="token punctuation">)</span>
</code></pre></div><p>importå‡½æ•°çš„å‚æ•°specifierï¼ŒæŒ‡å®šæ‰€è¦åŠ è½½çš„æ¨¡å—çš„ä½ç½®ã€‚importå‘½ä»¤èƒ½å¤Ÿæ¥å—ä»€ä¹ˆå‚æ•°ï¼Œimport()å‡½æ•°å°±èƒ½æ¥å—ä»€ä¹ˆå‚æ•°ï¼Œä¸¤è€…åŒºåˆ«ä¸»è¦æ˜¯åè€…ä¸ºåŠ¨æ€åŠ è½½ã€‚</p> <p>import()è¿”å›ä¸€ä¸ª Promise å¯¹è±¡</p> <h3 id="ä¸common-jså·®å¼‚"><a href="#ä¸common-jså·®å¼‚" aria-hidden="true" class="header-anchor">#</a> ä¸common.jså·®å¼‚</h3> <p>CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ã€‚</p> <p>CommonJS æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ã€‚</p> <h2 id="deorator-è£…é¥°å™¨"><a href="#deorator-è£…é¥°å™¨" aria-hidden="true" class="header-anchor">#</a> Deorator è£…é¥°å™¨</h2> <p>è£…é¥°å™¨æ˜¯ä¸€ç§å‡½æ•°ï¼Œå†™æˆ@ + å‡½æ•°åã€‚å®ƒå¯ä»¥æ”¾åœ¨ç±»å’Œç±»æ–¹æ³•çš„å®šä¹‰å‰é¢ã€‚</p> <p><strong>è£…é¥°ç±»</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>@test
<span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token parameter">target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   target<span class="token punctuation">.</span>test <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>è£…é¥°æ–¹æ³•</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MyClass</span> <span class="token punctuation">{</span>
  @readonly
  <span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">readonly</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> name<span class="token punctuation">,</span> descriptor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  descriptor<span class="token punctuation">.</span>writable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> descriptor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>è£…é¥°å™¨çš„åŸç†åŸºæœ¬æ˜¯è¿™æ ·ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>@decorator
<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// ç­‰åŒäº</span>

<span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token constant">A</span> <span class="token operator">=</span> <span class="token function">decorator</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token constant">A</span><span class="token punctuation">;</span>
</code></pre></div><p>è£…é¥°å™¨æ˜¯ä¸€ä¸ªå¯¹ç±»è¿›è¡Œå¤„ç†çš„å‡½æ•°ã€‚è£…é¥°å™¨å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå°±æ˜¯æ‰€è¦è£…é¥°çš„ç›®æ ‡ç±»ã€‚</p> <p>æ³¨æ„ï¼Œè£…é¥°å™¨å¯¹ç±»çš„è¡Œä¸ºçš„æ”¹å˜ï¼Œæ˜¯ä»£ç ç¼–è¯‘æ—¶å‘ç”Ÿçš„ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œæ—¶ã€‚è¿™æ„å‘³ç€ï¼Œè£…é¥°å™¨èƒ½åœ¨ç¼–è¯‘é˜¶æ®µè¿è¡Œä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè£…é¥°å™¨æœ¬è´¨å°±æ˜¯ç¼–è¯‘æ—¶æ‰§è¡Œçš„å‡½æ•°ã€‚</p> <p>å®é™…å¼€å‘ä¸­ï¼ŒReact ä¸ Redux åº“ç»“åˆä½¿ç”¨æ—¶ï¼Œå¸¸å¸¸éœ€è¦å†™æˆä¸‹é¢è¿™æ ·ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>@<span class="token function">connect</span><span class="token punctuation">(</span>mapStateToProps<span class="token punctuation">,</span> mapDispatchToProps<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">MyReactComponent</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        â†
        <a href="/js_advanced.html" class="prev">
          æ‰‹å†™JS
        </a></span> <span class="next"><a href="/browser.html">
          æµè§ˆå™¨ç³»åˆ—
        </a>
        â†’
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.94b2f3ef.js" defer></script><script src="/assets/js/2.d467c8ee.js" defer></script><script src="/assets/js/12.a146812a.js" defer></script>
  </body>
</html>
